import{aA as e,aS as t,d as s,k as a,a as r,Z as l,E as i,u as o,v as n,x as u,C as c,B as d,N as m,f as p,D as f,A as _,P as k,aT as v,e as y}from"./index.CT88Sm32.js";import{_ as h}from"./Content.vue_vue_type_script_setup_true_lang.Dbg-RI-4.js";import{a as g,L as w,s as T,M as C,_ as x,N as j,h as b,O as $}from"./Layout.vue_vue_type_script_setup_true_lang.CVCKf7J5.js";import{_ as P}from"./DataTable.vue_vue_type_script_setup_true_lang.CdustvT4.js";import{P as W}from"./PlusOutlined.CzjfLxJT.js";import{u as L}from"./composables.DHPbJdtC.js";import"./Checkbox.B8MxR3xo.js";import"./Ellipsis.Bs9t3VhK.js";const U=e("ticket",(()=>({closeTicket:async function(e,s,a,r,l={}){return new Promise((i=>{const o=a.warning({title:r("Close Ticket"),content:r("Once closed, you cannot reply to the ticket. Are you sure you want to close this ticket?"),positiveText:r("Confirm"),negativeText:r("Cancel"),onPositiveClick:()=>(o.loading=!0,new Promise((a=>{t({path:{issue_no:e}}).then((()=>{s.success(r("Closed successfully")),a(!0)})).finally((()=>{o.loading=!1,i(!0)}))}))),...l})}))}}))),A={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},D={class:"grow md:grow-0 md:basis-1/2"},E=s({__name:"IndexView",setup(e){const t=U(),s=o(),{t:E}=a(),M=g(),S=L(),z=r(),K=[{title:E("Ticket Number"),key:"issue_no",minWidth:250},{title:E("Ticket Title"),key:"title",minWidth:300},{title:E("Ticket Level"),key:"level",minWidth:120,sorter:!0,align:"center",render(e){const t={low:E("Low"),medium:E("Medium"),high:E("High")},s=e.level;return l(w,{type:{low:"info",medium:"warning",high:"danger"}[s]},{default:()=>t[s]||E("Unknown")})}},{title:E("Ticket Status"),key:"status",minWidth:100,sorter:!0,align:"center",render(e){const t={in_progress:E("Processing"),completed:E("Completed")},s=e.status;return l(w,{type:{in_progress:"warning",completed:"success"}[s]},{default:()=>t[s]??E("Unknown")})}},{title:E("Creation Time"),minWidth:200,key:"created_at",sorter:!0,align:"center",render:e=>T(e.created_at).format("L")},{title:E("Actions"),key:"actions",minWidth:170,fixed:"right",align:"center",render:e=>l(C,{vertical:!1,size:5,justify:"center"},{default:()=>[l(i,{size:"small",onClick:()=>{s.push(`/user/tickets/${e.issue_no}`)}},{default:()=>E("Details")}),l(i,{disabled:"completed"===e.status,size:"small",type:"error",onClick:()=>{t.closeTicket(e.issue_no,M,S,E).finally((()=>{var e;q.value=[],null==(e=z.value)||e.refresh()}))}},{default:()=>E("Close Ticket")})]})}],N=r(""),O=r("sort:latest"),q=r([]),B=e=>v({query:{page:e,per_page:40,q:`${N.value} ${O.value}`.trim()}});function R(e){var t;e.order?O.value=`sort:${e.columnKey}:${e.order}`:O.value="sort:latest",null==(t=z.value)||t.refresh()}function H(){var e;null==(e=z.value)||e.refresh()}return(e,t)=>(y(),n(x,{"header-title":e.$t("My Tickets"),"toggle-header":!1,"show-footer":!1},{default:u((()=>[c(h,{class:"mx-auto p-4 md:p-10 space-y-10"},{default:u((()=>[c(d(m),null,{default:u((()=>[c(d(C),{vertical:""},{default:u((()=>[p("div",A,[p("div",null,[c(d(i),{tertiary:"",onClick:t[0]||(t[0]=()=>{d(s).push("/user/tickets/create")})},{icon:u((()=>[c(d(j),{component:d(W)},null,8,["component"])])),default:u((()=>[f(" "+_(e.$t("Create Ticket")),1)])),_:1})]),p("div",D,[c(d(b),{value:N.value,"onUpdate:value":t[1]||(t[1]=e=>N.value=e),placeholder:e.$t("Enter keywords to search..."),onKeyup:k(H,["enter","native"])},{prefix:u((()=>[c(d(j),{component:d($)},null,8,["component"])])),_:1},8,["value","placeholder"])])]),c(P,{striped:"",ref_key:"tableRef",ref:z,bordered:!1,fetch:B,columns:K,"row-key":e=>e.id,"checked-row-keys":q.value,"onUpdate:checkedRowKeys":t[2]||(t[2]=e=>q.value=e),onUpdateSorter:R},null,8,["row-key","checked-row-keys"])])),_:1})])),_:1})])),_:1})])),_:1},8,["header-title"]))}});export{E as default};
