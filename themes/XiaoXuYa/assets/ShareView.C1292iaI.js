import{d as a,b as e,e as l,f as s,h as t,k as r,a as u,J as o,o as n,z as i,q as d,F as v,M as c,O as p,x as m,y as f,B as w,A as h,N as g,P as x,u as _}from"./index.BWoVohGl.js";import{_ as y,E as k}from"./ExploreImage.Btq7OVkr.js";import{W as $}from"./WaterfallLayout.C_HKNJik.js";import{_ as b}from"./Content.vue_vue_type_script_setup_true_lang.CtSpbWEg.js";import{a as j,_ as z,d as S,f as C,N as q,g as A,h as I}from"./Layout.vue_vue_type_script_setup_true_lang.wctogJXG.js";const O={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},T=[s("path",{d:"M256 48C141.31 48 48 141.31 48 256s93.31 208 208 208s208-93.31 208-208S370.69 48 256 48zm0 319.91a20 20 0 1 1 20-20a20 20 0 0 1-20 20zm21.72-201.15l-5.74 122a16 16 0 0 1-32 0l-5.74-121.94v-.05a21.74 21.74 0 1 1 43.44 0z",fill:"currentColor"},null,-1)],B=a({name:"AlertCircle",render:function(a,s){return l(),e("svg",O,T)}}),E={key:0,class:"container mx-auto p-4 sm:p-8 w-full"},H={class:"flex flex-col justify-center items-center mt-20"},L={key:1,class:"w-full"},M={class:"container mx-auto p-4 sm:p-8"},N={class:"flex flex-col sm:flex-row sm:justify-between mb-10 w-full"},P={class:"flex flex-col"},R={class:"text-2xl mb-4 font-bold"},U={class:"flex items-center w-full"},V={class:"mt-4"},W={class:"flex justify-end mt-2 sm:mt-0"},D={class:"my-4"},F={style:{"padding-left":"6px","padding-right":"6px"}},J={key:2,class:"container mx-auto p-4 sm:p-8 w-full"},K={class:"flex flex-col justify-center items-center mt-20"},G={class:"w-[300px] md:w-[400px]"},Q={class:"flex items-center space-x-1 text-gray-500 mb-2"},X=a({__name:"ShareView",setup(a){const O=o(),T=_(),X=j(),Y=t(),{t:Z}=r(),aa=u(String(O.query.p||"")),ea=u(null),la=u({}),sa=u(0),ta=u([]),ra=u(""),ua=u(1),oa=u(!1),na=u(!0),ia=u(!1);async function da(){var a,e,l,s;const t=await c({path:{slug:O.params.slug.toString()},query:{password:aa.value}});return"error"===(null==(a=t.data)?void 0:a.status)?X.error(null==(e=t.data)?void 0:e.message):(!(null==(l=t.data)?void 0:l.data.is_valid)&&aa.value&&X.error(Z("Incorrect password")),null==(s=t.data)?void 0:s.data)}async function va(a={}){var e,l,s,t,r,u,o;if(!oa.value&&!ia.value){oa.value=!0;try{if(la.value.is_valid){const n=await p({path:{slug:la.value.slug},query:{q:ra.value,page:ua.value,password:aa.value,per_page:20,...a}});if("error"===(null==(e=n.data)?void 0:e.status))return void X.error(null==(l=n.data)?void 0:l.message);if(!(null==(s=n.data)?void 0:s.data.is_valid)&&aa.value)X.error(Z("Incorrect password"));else{const a=(null==(t=n.data)?void 0:t.data.data)||[];ta.value.push(...a),sa.value=(null==(r=n.data)?void 0:r.data.meta.total)||0,ia.value=(null==(u=n.data)?void 0:u.data.meta.last_page)===(null==(o=n.data)?void 0:o.data.meta.current_page),a.length>0&&ua.value++}}}catch(n){X.error("加载失败，请重试")}finally{oa.value=!1}}}function ca(a){const e=a.target;100+e.scrollTop+e.clientHeight>=e.scrollHeight&&(oa.value||ia.value||va())}function pa(){var a;null==(a=ea.value)||a.open({path:{slug:O.params.slug.toString()}})}async function ma(){la.value=await da(),await va(),la.value.is_valid&&await T.replace(`/shares/${O.params.slug}?p=${aa.value}`)}function fa(){T.push(`/explore/@${la.value.user.username}`).then((()=>Y.setSidebarOpen(!1)))}return n((async()=>{na.value=!0,la.value=await da(),na.value=!1,await va()})),(a,t)=>(l(),e(v,null,[i(y,{ref_key:"reportRef",ref:ea,type:"share"},null,512),i(z,{"toggle-header":!1,"show-footer":!0,"header-title":a.$t("Share Details"),"on-scroll":ca},{default:d((()=>[i(b,null,{default:d((()=>{var r,u,o,n,v,c;return[na.value?(l(),e("div",E,[s("div",H,m(a.$t("Verifying...")),1)])):la.value.is_valid?(l(),e("div",L,[s("div",M,[s("div",N,[s("div",P,[s("p",R,m((null==(u=null==(r=la.value)?void 0:r.album)?void 0:u.name)||la.value.content),1),s("div",U,[i(f(S),{class:"shrink-0",round:"",size:"medium",src:f(C).getUserAvatar((null==(o=la.value.user)?void 0:o.avatar_url)||"")},null,8,["src"]),s("div",{class:"flex flex-col ml-2 w-full overflow-hidden cursor-pointer",onClick:fa},m(null==(n=la.value.user)?void 0:n.name),1)]),s("p",V,m(null==(c=null==(v=la.value)?void 0:v.album)?void 0:c.intro),1)]),s("div",W,[i(f(w),{secondary:"",strong:"",size:"small",onClick:pa},{default:d((()=>[h(m(a.$t("Report")),1)])),_:1})])]),s("p",D,m(a.$t("Total {count} photos",{count:sa.value})),1)]),s("div",F,[i($,{items:ta.value.map((a=>({...a,id:a.id}))),"column-width":200,gap:6},{default:d((({item:a})=>[i(k,{"show-user-info":!1,"show-like":!1,"show-report":!1,photo:a,photos:ta.value},null,8,["photo","photos"])])),_:1},8,["items"])])])):(l(),e("div",J,[s("div",K,[s("div",G,[i(f(g),{size:"small"},{default:d((()=>[s("p",Q,[i(f(q),{component:f(B),size:16},null,8,["component"]),s("span",null,m(a.$t("This content requires a password to access")),1)]),i(f(A),null,{default:d((()=>[i(f(I),{type:"password",onKeyup:x(ma,["enter"]),value:aa.value,"onUpdate:value":t[0]||(t[0]=a=>aa.value=a),placeholder:a.$t("Please enter the access password"),"show-password-on":"click"},null,8,["value","placeholder"]),i(f(w),{onClick:ma},{default:d((()=>[h(m(a.$t("Open Share")),1)])),_:1})])),_:1})])),_:1})])])]))]})),_:1})])),_:1},8,["header-title"])],64))}});export{X as default};
