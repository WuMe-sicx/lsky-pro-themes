import{aA as e,aS as t,d as s,k as a,a as r,Z as l,B as i,u as o,p as n,q as u,z as c,y as d,N as p,f as m,A as f,x as _,P as k,aT as y,e as v}from"./index.BWoVohGl.js";import{_ as h}from"./Content.vue_vue_type_script_setup_true_lang.CtSpbWEg.js";import{a as g,L as w,s as T,M as x,_ as C,N as j,h as b,O as $}from"./Layout.vue_vue_type_script_setup_true_lang.wctogJXG.js";import{_ as P}from"./DataTable.vue_vue_type_script_setup_true_lang.Bx5MBQqs.js";import{P as W}from"./PlusOutlined.C7hLo8eW.js";import{u as L}from"./composables.DRZoD034.js";import"./Checkbox.DY81qQ2Y.js";import"./Ellipsis.CyjgnfYS.js";const U=e("ticket",(()=>({closeTicket:async function(e,s,a,r,l={}){return new Promise((i=>{const o=a.warning({title:r("Close Ticket"),content:r("Once closed, you cannot reply to the ticket. Are you sure you want to close this ticket?"),positiveText:r("Confirm"),negativeText:r("Cancel"),onPositiveClick:()=>(o.loading=!0,new Promise((a=>{t({path:{issue_no:e}}).then((()=>{s.success(r("Closed successfully")),a(!0)})).finally((()=>{o.loading=!1,i(!0)}))}))),...l})}))}}))),z={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},A={class:"grow md:grow-0 md:basis-1/2"},M=s({__name:"IndexView",setup(e){const t=U(),s=o(),{t:M}=a(),S=g(),q=L(),D=r(),E=[{title:M("Ticket Number"),key:"issue_no",minWidth:250},{title:M("Ticket Title"),key:"title",minWidth:300},{title:M("Ticket Level"),key:"level",minWidth:120,sorter:!0,align:"center",render(e){const t={low:M("Low"),medium:M("Medium"),high:M("High")},s=e.level;return l(w,{type:{low:"info",medium:"warning",high:"danger"}[s]},{default:()=>t[s]||M("Unknown")})}},{title:M("Ticket Status"),key:"status",minWidth:100,sorter:!0,align:"center",render(e){const t={in_progress:M("Processing"),completed:M("Completed")},s=e.status;return l(w,{type:{in_progress:"warning",completed:"success"}[s]},{default:()=>t[s]??M("Unknown")})}},{title:M("Creation Time"),minWidth:200,key:"created_at",sorter:!0,align:"center",render:e=>T(e.created_at).format("L")},{title:M("Actions"),key:"actions",minWidth:170,fixed:"right",align:"center",render:e=>l(x,{vertical:!1,size:5,justify:"center"},{default:()=>[l(i,{size:"small",onClick:()=>{s.push(`/user/tickets/${e.issue_no}`)}},{default:()=>M("Details")}),l(i,{disabled:"completed"===e.status,size:"small",type:"error",onClick:()=>{t.closeTicket(e.issue_no,S,q,M).finally((()=>{var e;O.value=[],null==(e=D.value)||e.refresh()}))}},{default:()=>M("Close Ticket")})]})}],K=r(""),N=r("sort:latest"),O=r([]),B=e=>y({query:{page:e,per_page:40,q:`${K.value} ${N.value}`.trim()}});function R(e){var t;e.order?N.value=`sort:${e.columnKey}:${e.order}`:N.value="sort:latest",null==(t=D.value)||t.refresh()}function H(){var e;null==(e=D.value)||e.refresh()}return(e,t)=>(v(),n(C,{"header-title":e.$t("My Tickets"),"toggle-header":!1,"show-footer":!1},{default:u((()=>[c(h,{class:"mx-auto p-4 md:p-10 space-y-10"},{default:u((()=>[c(d(p),null,{default:u((()=>[c(d(x),{vertical:""},{default:u((()=>[m("div",z,[m("div",null,[c(d(i),{tertiary:"",onClick:t[0]||(t[0]=()=>{d(s).push("/user/tickets/create")})},{icon:u((()=>[c(d(j),{component:d(W)},null,8,["component"])])),default:u((()=>[f(" "+_(e.$t("Create Ticket")),1)])),_:1})]),m("div",A,[c(d(b),{value:K.value,"onUpdate:value":t[1]||(t[1]=e=>K.value=e),placeholder:e.$t("Enter keywords to search..."),onKeyup:k(H,["enter","native"])},{prefix:u((()=>[c(d(j),{component:d($)},null,8,["component"])])),_:1},8,["value","placeholder"])])]),c(P,{striped:"",ref_key:"tableRef",ref:D,bordered:!1,fetch:B,columns:E,"row-key":e=>e.id,"checked-row-keys":O.value,"onUpdate:checkedRowKeys":t[2]||(t[2]=e=>O.value=e),onUpdateSorter:R},null,8,["row-key","checked-row-keys"])])),_:1})])),_:1})])),_:1})])),_:1},8,["header-title"]))}});export{M as default};
