import{_ as e}from"./Content.vue_vue_type_script_setup_true_lang.BvqggnOA.js";import{U as a,V as l,b4 as r,b5 as t,Y as o,b6 as n,d,Z as i,$ as u,aG as s,bO as c,a1 as v,c as p,b2 as f,aI as b,j as m,k as h,a as g,l as y,o as _,p as w,y as $,C as k,q as C,z as x,b as P,s as U,A as q,x as S,f as z,aj as E,E as R,F as j,B as I,e as V,bP as B,bQ as N,i as T,bR as A,J as L,bS as O,u as M,bT as D,S as F,bU as W,bV as Y,bW as K,bX as H,N as J}from"./index.DilSbsx1.js";import{a as Q,k as G,l as X,o as Z,d as ee,f as ae,h as le,K as re,w as te,s as oe,N as ne,_ as de,i as ie,ab as ue}from"./Layout.vue_vue_type_script_setup_true_lang.CBef50rk.js";import{N as se}from"./Upload.b-LM5zHt.js";import{N as ce}from"./Alert.2xDRCqae.js";import{N as ve}from"./Popconfirm.Dqi7zF2U.js";import{b as pe,a as fe,_ as be}from"./PhoneVerifyInput.vue_vue_type_script_setup_true_lang.B_2VepUq.js";const me=a([l("table","\n font-size: var(--n-font-size);\n font-variant-numeric: tabular-nums;\n line-height: var(--n-line-height);\n width: 100%;\n border-radius: var(--n-border-radius) var(--n-border-radius) 0 0;\n text-align: left;\n border-collapse: separate;\n border-spacing: 0;\n overflow: hidden;\n background-color: var(--n-td-color);\n border-color: var(--n-merged-border-color);\n transition:\n background-color .3s var(--n-bezier),\n border-color .3s var(--n-bezier),\n color .3s var(--n-bezier);\n --n-merged-border-color: var(--n-border-color);\n ",[a("th","\n white-space: nowrap;\n transition:\n background-color .3s var(--n-bezier),\n border-color .3s var(--n-bezier),\n color .3s var(--n-bezier);\n text-align: inherit;\n padding: var(--n-th-padding);\n vertical-align: inherit;\n text-transform: none;\n border: 0px solid var(--n-merged-border-color);\n font-weight: var(--n-th-font-weight);\n color: var(--n-th-text-color);\n background-color: var(--n-th-color);\n border-bottom: 1px solid var(--n-merged-border-color);\n border-right: 1px solid var(--n-merged-border-color);\n ",[a("&:last-child","\n border-right: 0px solid var(--n-merged-border-color);\n ")]),a("td","\n transition:\n background-color .3s var(--n-bezier),\n border-color .3s var(--n-bezier),\n color .3s var(--n-bezier);\n padding: var(--n-td-padding);\n color: var(--n-td-text-color);\n background-color: var(--n-td-color);\n border: 0px solid var(--n-merged-border-color);\n border-right: 1px solid var(--n-merged-border-color);\n border-bottom: 1px solid var(--n-merged-border-color);\n ",[a("&:last-child","\n border-right: 0px solid var(--n-merged-border-color);\n ")]),o("bordered","\n border: 1px solid var(--n-merged-border-color);\n border-radius: var(--n-border-radius);\n ",[a("tr",[a("&:last-child",[a("td","\n border-bottom: 0 solid var(--n-merged-border-color);\n ")])])]),o("single-line",[a("th","\n border-right: 0px solid var(--n-merged-border-color);\n "),a("td","\n border-right: 0px solid var(--n-merged-border-color);\n ")]),o("single-column",[a("tr",[a("&:not(:last-child)",[a("td","\n border-bottom: 0px solid var(--n-merged-border-color);\n ")])])]),o("striped",[a("tr:nth-of-type(even)",[a("td","background-color: var(--n-td-color-striped)")])]),n("bottom-bordered",[a("tr",[a("&:last-child",[a("td","\n border-bottom: 0px solid var(--n-merged-border-color);\n ")])])])]),r(l("table","\n background-color: var(--n-td-color-modal);\n --n-merged-border-color: var(--n-border-color-modal);\n ",[a("th","\n background-color: var(--n-th-color-modal);\n "),a("td","\n background-color: var(--n-td-color-modal);\n ")])),t(l("table","\n background-color: var(--n-td-color-popover);\n --n-merged-border-color: var(--n-border-color-popover);\n ",[a("th","\n background-color: var(--n-th-color-popover);\n "),a("td","\n background-color: var(--n-td-color-popover);\n ")]))]),he=d({name:"Table",props:Object.assign(Object.assign({},s.props),{bordered:{type:Boolean,default:!0},bottomBordered:{type:Boolean,default:!0},singleLine:{type:Boolean,default:!0},striped:Boolean,singleColumn:Boolean,size:{type:String,default:"medium"}}),setup(e){const{mergedClsPrefixRef:a,inlineThemeDisabled:l,mergedRtlRef:r}=u(e),t=s("Table","-table",me,c,e,a),o=v("Table",r,a),n=p((()=>{const{size:a}=e,{self:{borderColor:l,tdColor:r,tdColorModal:o,tdColorPopover:n,thColor:d,thColorModal:i,thColorPopover:u,thTextColor:s,tdTextColor:c,borderRadius:v,thFontWeight:p,lineHeight:b,borderColorModal:m,borderColorPopover:h,tdColorStriped:g,tdColorStripedModal:y,tdColorStripedPopover:_,[f("fontSize",a)]:w,[f("tdPadding",a)]:$,[f("thPadding",a)]:k},common:{cubicBezierEaseInOut:C}}=t.value;return{"--n-bezier":C,"--n-td-color":r,"--n-td-color-modal":o,"--n-td-color-popover":n,"--n-td-text-color":c,"--n-border-color":l,"--n-border-color-modal":m,"--n-border-color-popover":h,"--n-border-radius":v,"--n-font-size":w,"--n-th-color":d,"--n-th-color-modal":i,"--n-th-color-popover":u,"--n-th-font-weight":p,"--n-th-text-color":s,"--n-line-height":b,"--n-td-padding":$,"--n-th-padding":k,"--n-td-color-striped":g,"--n-td-color-striped-modal":y,"--n-td-color-striped-popover":_}})),d=l?b("table",p((()=>e.size[0])),n,e):void 0;return{rtlEnabled:o,mergedClsPrefix:a,cssVars:l?void 0:n,themeClass:null==d?void 0:d.themeClass,onRender:null==d?void 0:d.onRender}},render(){var e;const{mergedClsPrefix:a}=this;return null===(e=this.onRender)||void 0===e||e.call(this),i("table",{class:[`${a}-table`,this.themeClass,{[`${a}-table--rtl`]:this.rtlEnabled,[`${a}-table--bottom-bordered`]:this.bottomBordered,[`${a}-table--bordered`]:this.bordered,[`${a}-table--single-line`]:this.singleLine,[`${a}-table--single-column`]:this.singleColumn,[`${a}-table--striped`]:this.striped}],style:this.cssVars},this.$slots)}}),ge={class:"relative"},ye={class:"absolute bottom-1 right-0 rounded-full bg-white w-7 h-7 flex justify-center items-center border"},_e=d({__name:"Info",setup(e){var a,l;const r=Q(),t=m(),{t:o}=h(),n=g(!1),d=g({}),i=g(null),u=g(null),s={username:{type:"string",required:!0,trigger:["blur","input"],message:o("Please enter your username")},name:{type:"string",required:!0,trigger:["blur","input"],message:o("Please enter a nickname")}},c=async e=>{var a;e.preventDefault(),null==(a=i.value)||a.validate((async e=>{var a,l,i;if(!e){n.value=!0;const e=await B({body:d.value}).finally((()=>n.value=!1));return"error"===(null==(a=e.data)?void 0:a.status)?r.error(null==(l=e.data)?void 0:l.message):(null==(i=u.value)||i.clear(),await t.fetchUserProfile(),n.value=!1,r.success(o("Successfully updated")))}}))},v=e=>{let a;e.fileList.length>0&&(a=e.fileList[0].file),d.value&&(a?d.value.avatar=a:delete d.value.avatar)},p=e=>{for(const a in e)d.value[`interests[${a}]`]=e[a]},f=e=>{for(const a in e)d.value[`socials[${a}]`]=e[a]},b=g((null==(a=t.profile)?void 0:a.interests)||[]),N=g((null==(l=t.profile)?void 0:l.socials)||[]);y(b,(e=>p(e)),{deep:!0}),y(N,(e=>f(e)),{deep:!0});return _((()=>{var e,a,l,r,o,n,i,u;d.value={name:null==(e=t.profile)?void 0:e.name,username:null==(a=t.profile)?void 0:a.username,tagline:null==(l=t.profile)?void 0:l.tagline,bio:(null==(r=t.profile)?void 0:r.bio)||"",url:(null==(o=t.profile)?void 0:o.url)||"",company:(null==(n=t.profile)?void 0:n.company)||"",company_title:(null==(i=t.profile)?void 0:i.company_title)||"",location:null==(u=t.profile)?void 0:u.location},p(b.value),f(N.value)})),(e,a)=>(V(),w($(G),{ref_key:"formRef",ref:i,"label-placement":"left","label-width":100,"label-align":"left",model:d.value,rules:s,onSubmit:k(c,["prevent"])},{default:C((()=>[x($(X),{label:e.$t("Avatar"),path:"avatar"},{default:C((()=>[x($(se),{ref_key:"uploadRef",ref:u,"list-type":"image","default-upload":!1,accept:".png,.jpg,.jpeg,.gif",max:1,name:"avatar",onChange:v,"with-credentials":""},{default:C((()=>{var a;return[x($(Z),{trigger:"hover",placement:"right",disabled:Boolean(null==(a=d.value)?void 0:a.avatar)},{trigger:C((()=>{var e;return[z("div",ge,[x($(ee),{round:"",src:$(ae).getUserAvatar(null==(e=$(t).profile)?void 0:e.avatar_url),class:"w-20 h-20 cursor-pointer"},null,8,["src"]),z("div",ye,[x($(E),{icon:"fa-pen"})])])]})),default:C((()=>[q(S(e.$t("Click to upload a new avatar. It will take effect after saving."))+" ",1)])),_:1},8,["disabled"])]})),_:1},512)])),_:1},8,["label"]),x($(X),{label:e.$t("Username"),path:"username"},{default:C((()=>[x($(le),{value:d.value.username,"onUpdate:value":a[0]||(a[0]=e=>d.value.username=e),maxlength:20,placeholder:e.$t("Please enter your username")},null,8,["value","placeholder"])])),_:1},8,["label"]),x($(X),{label:e.$t("Nickname"),path:"name"},{default:C((()=>[x($(le),{value:d.value.name,"onUpdate:value":a[1]||(a[1]=e=>d.value.name=e),maxlength:20,placeholder:e.$t("Please enter a nickname within 20 characters")},null,8,["value","placeholder"])])),_:1},8,["label"]),x($(X),{label:e.$t("Personal Signature"),path:"tagline"},{default:C((()=>[x($(le),{value:d.value.tagline,"onUpdate:value":a[2]||(a[2]=e=>d.value.tagline=e),maxlength:100,placeholder:e.$t("This person is diligent and has written a personal signature")},null,8,["value","placeholder"])])),_:1},8,["label"]),x($(X),{label:e.$t("Personal Introduction"),path:"bio"},{default:C((()=>[x($(le),{type:"textarea",value:d.value.bio,"onUpdate:value":a[3]||(a[3]=e=>d.value.bio=e),maxlength:200,placeholder:e.$t("Introduce yourself within 200 characters~")},null,8,["value","placeholder"])])),_:1},8,["label"]),x($(X),{label:e.$t("Personal Website"),path:"url"},{default:C((()=>[x($(le),{"input-props":{type:"url"},value:d.value.url,"onUpdate:value":a[4]||(a[4]=e=>d.value.url=e),maxlength:200,placeholder:e.$t("Enter personal website URL")},null,8,["value","placeholder"])])),_:1},8,["label"]),x($(X),{label:e.$t("Company"),path:"company"},{default:C((()=>[x($(le),{value:d.value.company,"onUpdate:value":a[5]||(a[5]=e=>d.value.company=e),maxlength:80,placeholder:e.$t("Enter company name")},null,8,["value","placeholder"])])),_:1},8,["label"]),x($(X),{label:e.$t("Position at Company"),path:"company_title"},{default:C((()=>[x($(le),{value:d.value.company_title,"onUpdate:value":a[6]||(a[6]=e=>d.value.company_title=e),maxlength:20,placeholder:e.$t("Enter your position at the company")},null,8,["value","placeholder"])])),_:1},8,["label"]),x($(X),{label:e.$t("Location"),path:"location"},{default:C((()=>[x($(le),{value:d.value.location,"onUpdate:value":a[7]||(a[7]=e=>d.value.location=e),maxlength:80,placeholder:e.$t("Enter location")},null,8,["value","placeholder"])])),_:1},8,["label"]),x($(X),{label:e.$t("Hobbies")},{default:C((()=>[x($(re),{value:b.value,"onUpdate:value":a[8]||(a[8]=e=>b.value=e),max:9},null,8,["value"])])),_:1},8,["label"]),N.value.length>0?(V(!0),P(j,{key:0},R(N.value,((a,l)=>(V(),w($(X),{label:0===l?e.$t("Social Accounts"):" ",path:`socials[${l}]`,rule:{required:!0,message:e.$t("Please enter the link address"),trigger:["input","blur"]}},{default:C((()=>[x($(le),{"input-props":{type:"url",required:!0},value:N.value[l],"onUpdate:value":e=>N.value[l]=e,maxlength:60,placeholder:e.$t("Link to social profile"),clearable:""},{prefix:C((()=>[x($(E),{icon:"fa-link",class:"text-gray-500"})])),_:2},1032,["value","onUpdate:value","placeholder"]),x($(I),{class:"ml-2",onClick:e=>(e=>{N.value.splice(e,1)})(l)},{default:C((()=>[q(S(e.$t("Delete")),1)])),_:2},1032,["onClick"])])),_:2},1032,["label","path","rule"])))),256)):U("",!0),x($(X),{label:" "},{default:C((()=>[N.value.length<6?(V(),w($(I),{key:0,onClick:a[9]||(a[9]=e=>{N.value.push("")})},{default:C((()=>[q(S(e.$t("Add")),1)])),_:1})):U("",!0)])),_:1}),x($(X),{"show-feedback":!1},{default:C((()=>[x($(I),{"attr-type":"submit",type:"primary",loading:n.value},{default:C((()=>[q(S(e.$t("Confirm Save")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"]))}}),we=d({__name:"Password",setup(e){const a=Q(),{t:l}=h(),r=g(!1),t=g({current_password:"",password:"",password_confirmation:""}),o=g(null),n={current_password:{type:"string",required:!0,trigger:["blur","input"],message:l("Please enter your old password")},password:{type:"string",required:!0,trigger:["blur","change"],message:l("Please enter a new password")},password_confirmation:{type:"string",required:!0,trigger:["blur","input"],validator:(e,a)=>new Promise(((e,r)=>{a||r(new Error(l("Please confirm your new password"))),a!==t.value.password?r(new Error(l("New password and confirmation do not match"))):e()}))}},d=async e=>{var n;e.preventDefault(),null==(n=o.value)||n.validate((async e=>{var o,n;if(!e){r.value=!0;const e=await N({body:t.value}).finally((()=>r.value=!1));if("error"===(null==(o=e.data)?void 0:o.status))return a.error(null==(n=e.data)?void 0:n.message);a.success(l("Successfully updated. It will take effect next login.")),Object.keys(t.value).forEach((e=>t.value[e]=""))}r.value=!1}))};return(e,a)=>(V(),w($(G),{ref_key:"formRef",ref:o,"label-placement":"left","label-width":100,"label-align":"left",model:t.value,rules:n,onSubmit:k(d,["prevent"])},{default:C((()=>[x($(X),{label:e.$t("Old Password"),path:"current_password"},{default:C((()=>[x($(le),{type:"password","input-props":{type:"password",required:!0},value:t.value.current_password,"onUpdate:value":a[0]||(a[0]=e=>t.value.current_password=e),placeholder:e.$t("Please enter your old password")},null,8,["value","placeholder"])])),_:1},8,["label"]),x($(X),{label:e.$t("New Password"),path:"password"},{default:C((()=>[x($(le),{type:"password",minlength:8,"input-props":{type:"password",required:!0},value:t.value.password,"onUpdate:value":a[1]||(a[1]=e=>t.value.password=e),placeholder:e.$t("Please enter a new password, at least 8 characters")},null,8,["value","placeholder"])])),_:1},8,["label"]),x($(X),{label:e.$t("Confirm New Password"),path:"password_confirmation"},{default:C((()=>[x($(le),{type:"password",minlength:8,"input-props":{type:"password",required:!0},value:t.value.password_confirmation,"onUpdate:value":a[2]||(a[2]=e=>t.value.password_confirmation=e),placeholder:e.$t("Please confirm your new password, at least 8 characters")},null,8,["value","placeholder"])])),_:1},8,["label"]),x($(X),{"show-feedback":!1},{default:C((()=>[x($(I),{"attr-type":"submit",type:"primary",loading:r.value},{default:C((()=>[q(S(e.$t("Confirm Changes")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"]))}}),$e={class:"space-y-4"},ke={class:"flex space-x-1 items-center"},Ce=["src"],xe={key:1},Pe={class:"flex space-x-6 mt-2"},Ue=d({__name:"Social",setup(e){const a=L(),l=M(),r=Q(),t=T(),{t:o}=h(),n=g([]),d=p((()=>{var e;return((null==(e=t.configs)?void 0:e.app.socialites)||[]).filter((e=>-1===n.value.map((e=>e.driver.id)).indexOf(e.id)))}));return _((()=>{A({query:{page:1,per_page:999}}).then((e=>{var a;n.value=(null==(a=e.data)?void 0:a.data.data)||[]})),a.query.driver_id&&a.query.code&&O({path:{id:a.query.driver_id.toString()},body:{code:a.query.code.toString()}}).then((e=>{var a,t;if("error"===(null==(a=e.data)?void 0:a.status))return r.error(null==(t=e.data)?void 0:t.message);A({query:{page:1,per_page:999}}).then((e=>{var a;n.value=(null==(a=e.data)?void 0:a.data.data)||[]})),l.replace("/user/profile?tab=social"),r.success(o("Bound successfully"))}))})),(e,a)=>(V(),P("div",$e,[x($(ce),{"show-icon":!1},{default:C((()=>[q(S(e.$t("Bind a third-party account to log in directly with it in the future.")),1)])),_:1}),x($(he),{bordered:!1},{default:C((()=>[z("thead",null,[z("tr",null,[z("th",null,S(e.$t("Name")),1),z("th",null,S(e.$t("User Information")),1),z("th",null,S(e.$t("Binding Time")),1),a[0]||(a[0]=z("th",null,null,-1))])]),z("tbody",null,[(V(!0),P(j,null,R(n.value,(a=>(V(),P("tr",null,[z("td",null,S(a.driver.name),1),z("td",null,[z("div",ke,[a.avatar?(V(),P("img",{key:0,class:"w-8 rounded-full",src:a.avatar,alt:"avatar"},null,8,Ce)):U("",!0),z("span",null,S(a.name||a.nickname),1)])]),z("td",null,S($(oe)(a.created_at).format("LLL")),1),z("td",null,[x($(ve),{onPositiveClick:e=>{return l=a.driver.id,void D({path:{id:l.toString()}}).then((e=>{var a,l;if("error"===(null==(a=e.data)?void 0:a.status))return r.error(null==(l=e.data)?void 0:l.message);A().then((e=>{var a;n.value=(null==(a=e.data)?void 0:a.data.data)||[]})),r.success(o("Unbound successfully"))}));var l}},{trigger:C((()=>[x($(I),{type:"primary",text:""},{default:C((()=>[q(S(e.$t("Unbind")),1)])),_:1})])),default:C((()=>[q(S(e.$t("Are you sure you want to unbind this account?"))+" ",1)])),_:2},1032,["onPositiveClick"])])])))),256))])])),_:1}),n.value.length<=0?(V(),w($(te),{key:0},{default:C((()=>[q(S(e.$t("No third-party accounts bound yet")),1)])),_:1})):U("",!0),d.value.length>0?(V(),P("div",xe,[z("p",null,S(e.$t("You can also bind the following accounts:")),1),z("div",Pe,[(V(!0),P(j,null,R(d.value,(e=>(V(),w($(I),{text:"",onClick:a=>(async e=>{var a,l;const t=await F({path:{id:e.id.toString()},query:{redirect_url:`${ae.getWithoutQueryUrl()}?tab=social&driver_id=${e.id}`}});if("error"===(null==(a=t.data)?void 0:a.status))return r.error(null==(l=t.data)?void 0:l.message);window.location.replace(t.data.data.redirect_url)})(e)},{icon:C((()=>[x($(ne),{component:$(ae).getSocialiteIcon(e.provider)},null,8,["component"])])),default:C((()=>[q(" "+S(e.name),1)])),_:2},1032,["onClick"])))),256))])])):U("",!0)]))}}),qe={key:0},Se={key:0},ze={key:1},Ee=d({__name:"Phone",setup(e){const a=Q(),l=m(),r=T(),{t:t}=h(),o=g(!1),n=g(!1),d=g({country_code:"cn",phone:"",code:""}),i=g({code:""}),u=g(""),s=g(""),c=g(null),v=g(null),p={phone:{type:"string",required:!0,trigger:["blur","change"],message:t("Please enter a new mobile number")},code:{type:"string",required:!0,trigger:["blur","change"],message:t("Please enter the mobile verification code")}},f={code:{type:"string",required:!0,trigger:["blur","change"],message:t("Please enter the mobile verification code")}},b=g(t("Send SMS Verification Code")),y=g(!1),_=async()=>{var e,r,o;if(!u.value)return a.error(t("Please enter captcha"));if(!s.value)return a.error(t("Captcha key is missing, please refresh the captcha"));const n=await W({body:{event:"bind",country_code:(null==(e=l.profile)?void 0:e.country_code)||"cn",phone:(null==(r=l.profile)?void 0:r.phone)||"",captcha:u.value,captcha_key:s.value}});"success"===(null==(o=n.data)?void 0:o.status)?(()=>{let e=60;y.value=!0;const a=setInterval((()=>{e--,b.value=t("Resend after {seconds} seconds",{seconds:e}),e<=0&&(y.value=!1,b.value=t("Send SMS Verification Code"),clearInterval(a))}),1e3)})():a.error(n.data.message)},k=async e=>{var r;e.preventDefault(),null==(r=c.value)||r.validate((async e=>{var r,t;if(!e){o.value=!0;const e=await Y({body:d.value}).finally((()=>o.value=!1));if("error"===(null==(r=e.data)?void 0:r.status))return a.error(null==(t=e.data)?void 0:t.message);await l.fetchUserProfile(),Object.keys(d.value).forEach((e=>d.value[e]=""))}o.value=!1}))},z=async e=>{var r;e.preventDefault(),null==(r=v.value)||r.validate((async e=>{var r,o,d,u;if(!e){n.value=!0;const e=await Y({body:{country_code:(null==(r=l.profile)?void 0:r.country_code)||"cn",phone:(null==(o=l.profile)?void 0:o.phone)||"",code:i.value.code}}).finally((()=>n.value=!1));if("error"===(null==(d=e.data)?void 0:d.status))return a.error(null==(u=e.data)?void 0:u.message);await l.fetchUserProfile(),a.success(t("Phone verified successfully")),i.value.code=""}n.value=!1}))};return(e,a)=>{var t,m,h;return(null==(t=$(r).configs)?void 0:t.app.user_phone_verify)&&(null==(m=$(l).profile)?void 0:m.phone)&&!(null==(h=$(l).profile)?void 0:h.phone_verified_at)?(V(),P("div",qe,[x($(G),{ref_key:"verifyFormRef",ref:v,"label-placement":"left","label-width":100,"label-align":"left",model:i.value,rules:f},{default:C((()=>[x($(X),null,{default:C((()=>[x($(ce),{type:"warning","show-icon":!1},{default:C((()=>[q(S(e.$t("Your phone number has not been verified. Please verify your phone number for account security and to access all features. Click the button below to send a verification code to your current phone number.")),1)])),_:1})])),_:1}),x($(X),{label:e.$t("Current Mobile Number")},{default:C((()=>{var e;return[x($(le),{"default-value":null==(e=$(l).profile)?void 0:e.phone,disabled:""},null,8,["default-value"])]})),_:1},8,["label"]),x($(X),{label:e.$t("Captcha"),"show-require-mark":""},{default:C((()=>[x(pe,{captcha:u.value,"onUpdate:captcha":a[0]||(a[0]=e=>u.value=e),"captcha-key":s.value,"onUpdate:captchaKey":a[1]||(a[1]=e=>s.value=e)},null,8,["captcha","captcha-key"])])),_:1},8,["label"]),x($(X),{label:e.$t("Verification Code"),"show-require-mark":""},{default:C((()=>[x($(le),{value:i.value.code,"onUpdate:value":a[2]||(a[2]=e=>i.value.code=e),"input-props":{required:!0},placeholder:e.$t("Please enter the SMS verification code")},{suffix:C((()=>[x($(I),{text:"",type:"info",onClick:_,disabled:y.value||!u.value},{default:C((()=>[q(S(b.value),1)])),_:1},8,["disabled"])])),_:1},8,["value","placeholder"])])),_:1},8,["label"]),x($(X),{"show-feedback":!1},{default:C((()=>[x($(I),{type:"primary",loading:n.value,onClick:z},{default:C((()=>[q(S(e.$t("Verify Phone")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])])):(V(),w($(G),{key:1,ref_key:"formRef",ref:c,"label-placement":"left","label-width":100,"label-align":"left",model:d.value,rules:p},{default:C((()=>{var r;return[(null==(r=$(l).profile)?void 0:r.phone)?(V(),w($(X),{key:0,label:e.$t("Current Mobile Number")},{default:C((()=>{var e;return[x($(le),{"default-value":null==(e=$(l).profile)?void 0:e.phone,disabled:""},null,8,["default-value"])]})),_:1},8,["label"])):U("",!0),x($(X),null,{default:C((()=>[x($(ce),{"show-icon":!1},{default:C((()=>{var a;return[(null==(a=$(l).profile)?void 0:a.phone)?(V(),P("p",Se,S(e.$t("To change your mobile number, please enter the new number in the form below. A verification code will be sent to the new number. Once verified, you can update your mobile number.")),1)):(V(),P("p",ze,S(e.$t("According to national laws and regulations, the account must be bound to at least one mobile number.")),1))]})),_:1})])),_:1}),x(fe,{event:"bind","country-code":d.value.country_code,"onUpdate:countryCode":a[3]||(a[3]=e=>d.value.country_code=e),phone:d.value.phone,"onUpdate:phone":a[4]||(a[4]=e=>d.value.phone=e),code:d.value.code,"onUpdate:code":a[5]||(a[5]=e=>d.value.code=e),size:"medium"},null,8,["country-code","phone","code"]),x($(X),{"show-feedback":!1},{default:C((()=>[x($(I),{type:"primary",loading:o.value,onClick:k},{default:C((()=>{var a;return[q(S(e.$t("Confirm"))+S((null==(a=$(l).profile)?void 0:a.phone)?e.$t("Change"):e.$t("Bind")),1)]})),_:1},8,["loading"])])),_:1})]})),_:1},8,["model"]))}}}),Re={key:0},je=d({__name:"Email",setup(e){const a=Q(),l=m(),r=T(),{t:t}=h(),o=g(!1),n=g(!1),d=g({email:"",code:""}),i=g({code:""}),u=g(""),s=g(""),c=g(null),v=g(null),p={email:{type:"string",required:!0,trigger:["blur","input"],message:t("Please enter a new email")},code:{type:"string",required:!0,trigger:["blur","input"],message:t("Please enter the email verification code")}},f={code:{type:"string",required:!0,trigger:["blur","input"],message:t("Please enter the email verification code")}},b=async e=>{var r;e.preventDefault(),null==(r=c.value)||r.validate((async e=>{var r,t;if(!e){o.value=!0;const e=await K({body:d.value}).finally((()=>o.value=!1));if("error"===(null==(r=e.data)?void 0:r.status))return a.error(null==(t=e.data)?void 0:t.message);await l.fetchUserProfile(),Object.keys(d.value).forEach((e=>d.value[e]=""))}o.value=!1}))},y=async e=>{var r;e.preventDefault(),null==(r=v.value)||r.validate((async e=>{var r,o,d;if(!e){n.value=!0;const e=await K({body:{email:(null==(r=l.profile)?void 0:r.email)||"",code:i.value.code}}).finally((()=>n.value=!1));if("error"===(null==(o=e.data)?void 0:o.status))return a.error(null==(d=e.data)?void 0:d.message);await l.fetchUserProfile(),a.success(t("Email verified successfully")),i.value.code=""}n.value=!1}))},_=g(t("Send Email Verification Code")),k=g(!1),U=async()=>{var e,r;if(!u.value)return a.error(t("Please enter captcha"));if(!s.value)return a.error(t("Captcha key is missing, please refresh the captcha"));const o=await H({body:{event:"bind",email:(null==(e=l.profile)?void 0:e.email)||"",captcha:u.value,captcha_key:s.value}});"success"===(null==(r=o.data)?void 0:r.status)?(()=>{let e=60;k.value=!0;const a=setInterval((()=>{e--,_.value=t("Resend after {seconds} seconds",{seconds:e}),e<=0&&(k.value=!1,_.value=t("Send Email Verification Code"),clearInterval(a))}),1e3)})():a.error(o.data.message)};return(e,a)=>{var t,m,h;return(null==(t=$(r).configs)?void 0:t.app.user_email_verify)&&!(null==(m=$(l).profile)?void 0:m.email_verified_at)&&(null==(h=$(l).profile)?void 0:h.email)?(V(),P("div",Re,[x($(G),{ref_key:"verifyFormRef",ref:v,"label-placement":"left","label-width":100,"label-align":"left",model:i.value,rules:f},{default:C((()=>[x($(X),null,{default:C((()=>[x($(ce),{type:"warning","show-icon":!1},{default:C((()=>[q(S(e.$t("Your email has not been verified. Please verify your email for account security and to access all features. Click the button below to send a verification code to your current email.")),1)])),_:1})])),_:1}),x($(X),{label:e.$t("Current Email")},{default:C((()=>{var e;return[x($(le),{"default-value":null==(e=$(l).profile)?void 0:e.email,disabled:""},null,8,["default-value"])]})),_:1},8,["label"]),x($(X),{label:e.$t("Captcha"),"show-require-mark":""},{default:C((()=>[x(pe,{captcha:u.value,"onUpdate:captcha":a[0]||(a[0]=e=>u.value=e),"captcha-key":s.value,"onUpdate:captchaKey":a[1]||(a[1]=e=>s.value=e)},null,8,["captcha","captcha-key"])])),_:1},8,["label"]),x($(X),{label:e.$t("Verification Code"),"show-require-mark":""},{default:C((()=>[x($(le),{value:i.value.code,"onUpdate:value":a[2]||(a[2]=e=>i.value.code=e),"input-props":{required:!0},placeholder:e.$t("Please enter the email verification code")},{suffix:C((()=>[x($(I),{text:"",type:"info",onClick:U,disabled:k.value||!u.value},{default:C((()=>[q(S(_.value),1)])),_:1},8,["disabled"])])),_:1},8,["value","placeholder"])])),_:1},8,["label"]),x($(X),{"show-feedback":!1},{default:C((()=>[x($(I),{type:"primary",loading:n.value,onClick:y},{default:C((()=>[q(S(e.$t("Verify Email")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])])):(V(),w($(G),{key:1,ref_key:"formRef",ref:c,"label-placement":"left","label-width":100,"label-align":"left",model:d.value,rules:p},{default:C((()=>[x($(X),{label:e.$t("Current Email")},{default:C((()=>{var e;return[x($(le),{"default-value":null==(e=$(l).profile)?void 0:e.email,disabled:""},null,8,["default-value"])]})),_:1},8,["label"]),x($(X),null,{default:C((()=>[x($(ce),{"show-icon":!1},{default:C((()=>[q(S(e.$t("To change your email address, please enter the new email in the form below. A verification code will be sent to the new email. Once verified, you can update your email.")),1)])),_:1})])),_:1}),x(be,{event:"bind",email:d.value.email,"onUpdate:email":a[3]||(a[3]=e=>d.value.email=e),code:d.value.code,"onUpdate:code":a[4]||(a[4]=e=>d.value.code=e),size:"medium"},null,8,["email","code"]),x($(X),{"show-feedback":!1},{default:C((()=>[x($(I),{type:"primary",loading:o.value,onClick:b},{default:C((()=>[q(S(e.$t("Confirm Change")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"]))}}}),Ie=d({__name:"IndexView",setup(a){const l=L(),r=M(),t=T(),o=g(l.query.tab?l.query.tab.toString():"basic"),n=e=>{r.replace(`/user/profile?tab=${e}`)};return(a,l)=>(V(),w(de,{"header-title":a.$t("Profile"),"toggle-header":!1,"show-footer":!1},{default:C((()=>[x(e,{class:"mx-auto p-4 md:p-10 space-y-10"},{default:C((()=>[x($(ie),{type:"line","default-value":o.value,"on-update-value":n,animated:""},{default:C((()=>{var e;return[x($(ue),{name:"basic",tab:a.$t("Personal Information")},{default:C((()=>[x($(J),null,{default:C((()=>[x(_e)])),_:1})])),_:1},8,["tab"]),x($(ue),{name:"email",tab:a.$t("Email")},{default:C((()=>[x($(J),null,{default:C((()=>[x(je)])),_:1})])),_:1},8,["tab"]),(null==(e=$(t).configs)?void 0:e.app.user_phone_verify)?(V(),w($(ue),{key:0,name:"phone",tab:a.$t("Mobile Number")},{default:C((()=>[x($(J),null,{default:C((()=>[x(Ee)])),_:1})])),_:1},8,["tab"])):U("",!0),x($(ue),{name:"social",tab:a.$t("Third-Party Accounts")},{default:C((()=>[x($(J),null,{default:C((()=>[x(Ue)])),_:1})])),_:1},8,["tab"]),x($(ue),{name:"password",tab:a.$t("Change Password")},{default:C((()=>[x($(J),null,{default:C((()=>[x(we)])),_:1})])),_:1},8,["tab"])]})),_:1},8,["default-value"])])),_:1})])),_:1},8,["header-title"]))}});export{Ie as default};
