import{B as e,s as a,w as t,D as l,F as s,n as o,x as r,a as i,_ as u,N as n,h as c,G as d,k as p,l as v,y as f,z as h}from"./Layout.vue_vue_type_script_setup_true_lang.CBef50rk.js";import{_ as m}from"./Content.vue_vue_type_script_setup_true_lang.BvqggnOA.js";import{l as y}from"./album.CjPM5VcP.js";import{d as _,c as g,b,e as x,y as k,f as w,z as S,aj as P,C as $,D as j,ae as z,k as C,x as L,q as A,p as D,s as T,F as U,E as q,a as N,B,A as R,j as F,ar as G,l as I,as as M,o as H,at as O,J as E,an as W,ap as J,u as K,au as V}from"./index.DilSbsx1.js";import{P as Q,_ as X,a as Y,b as Z,c as ee,d as ae,e as te,f as le}from"./PhotoSelect.vue_vue_type_script_setup_true_lang.y7lh5usm.js";import{W as se}from"./WaterfallLayout.Dq3ly8v-.js";import{N as oe}from"./Spin.Cs730TL7.js";import{_ as re,a as ie}from"./Share.vue_vue_type_script_setup_true_lang.BJwignTn.js";import{N as ue}from"./Popconfirm.Dqi7zF2U.js";import{_ as ne}from"./Back.vue_vue_type_script_setup_true_lang.BtVLX_rz.js";import"./DeleteOutlined.mKb66yfq.js";import"./composables.DH0Md89b.js";const ce={class:"absolute inset-0 flex justify-between z-[2] select-none"},de=_({__name:"PhotoBox",props:{photo:{}},emits:["onToggleSelect"],setup(a,{emit:t}){const l=a,s=g((()=>l.photo)),{toggleSelect:o}=e();return(e,a)=>(x(),b("div",{class:"relative group bg-gray-200 dark:bg-gray-700",onClick:a[1]||(a[1]=()=>k(o)(s.value.key))},[a[2]||(a[2]=w("div",{class:"transition-all absolute w-full top-0 h-1/2 bg-gradient-to-b from-black/30 opacity-0 group-hover:opacity-100"},null,-1)),w("div",ce,[S(k(P),{class:j(["rounded-full cursor-pointer absolute top-2 left-2",s.value.selected?"text-violet-500 bg-white outline outline-1 outline-white dark:outline-gray-500":"hidden group-hover:block text-white/70 hover:text-white"]),icon:"fa-solid fa-circle-check",size:"xl",onClick:a[0]||(a[0]=$((()=>k(o)(s.value.key)),["prevent","stop"]))},null,8,["class"])]),w("div",{class:j(["overflow-hidden transition-all",s.value.selected?"scale-90 rounded-lg":""])},[z(e.$slots,"default")],2)]))}}),pe={class:"flex flex-col space-y-2"},ve={class:"sticky top-0 z-[3] py-2 bg-gray-50 dark:bg-[var(--n-color)] flex space-x-2 items-center overflow-hidden group text-md"},fe={class:"font-bold"},he=_({__name:"PhotoSelectorGroup",props:{group:{type:Object,default:()=>{},required:!0}},setup(t){const l=t,{toggleSelectAllByGroup:s}=e(),{t:o}=C(),r=[o("Sunday"),o("Monday"),o("Tuesday"),o("Wednesday"),o("Thursday"),o("Friday"),o("Saturday")],i=g((()=>l.group.photos.map((e=>({...e,id:e.key})))));return(e,t)=>(x(),b("div",pe,[w("div",ve,[S(k(P),{icon:l.group.selected?"fa-solid fa-circle-check":"fa-regular fa-circle",size:"xl",class:j(["transition-all select-none",l.group.selected?"text-violet-500 ml-0.5":"-ml-6 group-hover:ml-0.5 text-gray-500/70"]),onClick:t[0]||(t[0]=()=>k(s)(l.group.date))},null,8,["icon","class"]),w("p",fe,L(k(a)(l.group.date).format("L"))+" "+L(r[k(a)(l.group.date).day()]),1)]),S(se,{items:i.value,"column-width":150,gap:6},{default:A((({item:e})=>[S(de,{photo:e},{default:A((()=>[S(Q,{src:e.src,alt:e.name||"","placeholder-text":"拼命加载中..."},null,8,["src","alt"])])),_:2},1032,["photo"])])),_:1},8,["items"])]))}}),me={key:1,class:"space-y-4"},ye={key:2,class:"flex justify-center py-10"},_e=_({__name:"PhotoSelectorList",setup(a){const l=e();return(e,a)=>(x(),b(U,null,[k(l).isLoading||0!==k(l).groups.length?(x(),b("div",me,[(x(!0),b(U,null,q(k(l).groups,(e=>(x(),D(he,{group:e},null,8,["group"])))),256))])):(x(),D(k(t),{key:0,class:"my-10",description:e.$t("No photos available")},null,8,["description"])),k(l).isLoading?(x(),b("div",ye,[S(k(oe),{size:25})])):T("",!0)],64))}}),ge=_({__name:"PhotoSelector",props:{title:{type:String,required:!1,default:"Select Photos"}},emits:["onSelect"],setup(a,{expose:t,emit:r}){const{t:i}=C(),u=e();function n(e){const a=e.target;100+a.scrollTop+a.clientHeight>=a.scrollHeight&&!u.isLoading&&u.hasMore&&(u.setPage(u.page+1),u.fetchPhotos())}const c=a,d=r,p=N(!1);function v(){p.value=!1}function f(){d("onSelect",u.selections),v()}return t({open:function(){u.resetPhotos({q:"sort:latest"}),p.value=!0},close:v}),(e,a)=>(x(),D(k(l),{show:p.value,"onUpdate:show":a[0]||(a[0]=e=>p.value=e),placement:"bottom",height:"90%"},{default:A((()=>[S(k(s),{title:e.$t(c.title),"body-content-class":"!py-0 !px-2",closable:""},{footer:A((()=>[S(k(B),{secondary:"",strong:"",onClick:f},{default:A((()=>[R(L(e.$t("Selection Complete ({count})",{count:k(o).format(k(u).selections.length)})),1)])),_:1})])),default:A((()=>[w("div",{class:"h-full overflow-y-auto",onScroll:n},[S(_e)],32)])),_:1},8,["title"])])),_:1},8,["show"]))}}),be=_({__name:"PhotoRemove",props:{albumId:{type:Number,required:!0}},setup(e){const a=r(),t=F(),l=i(),{t:s}=C(),o=e;function u(){G({path:{id:o.albumId},body:a.selections.map((e=>e.id))}).then((()=>{l.success(s("Removed successfully")),a.deletePhotos(a.selections.map((e=>e.key))),t.isLoggedIn&&t.fetchUserProfile()}))}return(e,t)=>(x(),D(k(ue),{placement:"left-start",onPositiveClick:u},{trigger:A((()=>[S(k(B),{quaternary:"",circle:"",size:"small",type:"error",title:e.$t("Remove selected items from album")},{icon:A((()=>[S(k(P),{icon:"fa-regular fa-square-minus"})])),_:1},8,["title"])])),default:A((()=>[R(" "+L(e.$t("Are you sure you want to remove the selected {count} photos from the album?",{count:k(a).selections.length})),1)])),_:1}))}}),xe={class:"flex items-center justify-between sticky top-0 z-[4] bg-gray-50 border-b border-transparent dark:bg-[var(--n-color)] dark:border-b-gray-800 p-2 w-full"},ke={class:"space-x-2"},we={class:"space-x-2"},Se={class:"flex flex-col"},Pe={class:"space-y-2 p-2 border-b dark:border-b-gray-600"},$e={class:"flex items-center p-2"},je={class:"space-y-4 p-2"},ze={class:"flex flex-col space-y-4"},Ce={key:0,class:"flex justify-end"},Le={key:1,class:"flex justify-between space-x-2"},Ae=_({__name:"DetailView",setup(e){const t=E(),l=K(),s=i(),{t:o}=C(),_=N(!1),g=N(),$=N(),j=N(),z=N({}),T=r(),U=N(""),q=N({type:"photo",ids:[],content:"",password:"",expired_at:null}),F={},G=e=>{const a=e.target;100+a.scrollTop+a.clientHeight>=a.scrollHeight&&(T.isLoading||(T.setPage(T.page+1),T.fetchPhotos()))};function Q(){if(0===T.selections.length)return void s.warning(o("Please select photos first"));const e={...q.value};if(e.ids=T.selections.map((e=>e.id)),e.expired_at){const a=new Date(e.expired_at);e.expired_at=a.toISOString().slice(0,19).replace("T"," ")}J({body:e}).then((e=>{var a,t,l;if("error"===(null==(a=e.data)?void 0:a.status))return s.error(null==(t=e.data)?void 0:t.message);U.value=`${window.location.origin}/shares/${null==(l=e.data)?void 0:l.data.slug}`})).catch((()=>{s.error(o("Failed to create share"))}))}function se(){h.copyText(U.value).then((()=>{s.success(o("Copy successful"))})).catch((()=>{s.error(o("Copy failed"))}))}I((()=>T.shareModalActive),(e=>{e&&(U.value="",q.value={type:"photo",ids:[],content:"",password:"",expired_at:null})}));const oe=y.debounce((()=>{M({path:{id:z.value.id},body:{name:z.value.name,intro:z.value.intro,is_public:z.value.is_public}})}),500);function ue(){var e;null==(e=g.value)||e.open()}function ce(){T.resetPhotos({q:"sort:latest",album_id:z.value.id})}function de(e){V({path:{id:z.value.id},body:e.map((e=>e.id))}).then((()=>{s.success(o("Added successfully")),ce()}))}return I((()=>z.value),(()=>{_.value&&oe()}),{deep:!0}),H((()=>{var e;T.clearGroups(),O({path:{id:Number(null==(e=t.params)?void 0:e.id)}}).then((e=>{var a;z.value=null==(a=e.data)?void 0:a.data,setTimeout((()=>{_.value=!0,ce()}),50)}))})),(e,r)=>(x(),D(u,{"toggle-header":!1,"show-footer":!1,"header-title":e.$t("Album Details"),"content-class":"bg-white dark:bg-[var(--n-color)]","on-scroll":G},{default:A((()=>[S(ge,{ref_key:"photoSelectorRef",ref:g,onOnSelect:de},null,512),S(re,{ref_key:"deleteRef",ref:$},null,512),S(ie,{ref_key:"shareRef",ref:j},null,512),S(m,{class:"max-w-full"},{default:A((()=>[w("div",xe,[w("div",ke,[S(ne)]),w("div",we,[S(k(B),{tertiary:"",type:"error",onClick:r[0]||(r[0]=()=>{return e=z.value,void(null==(a=$.value)||a.open(e,(()=>{l.back(),s.success(o("Deleted successfully"))})));var e,a})},{icon:A((()=>[S(k(P),{icon:"fa-solid fa-trash",size:"sm"})])),_:1}),S(k(B),{tertiary:"",type:"default",onClick:r[1]||(r[1]=()=>{return e=z.value,void(null==(a=j.value)||a.open(e));var e,a})},{icon:A((()=>[S(k(P),{icon:"fa-solid fa-share",size:"sm"})])),_:1}),S(k(B),{secondary:"",onClick:ue},{icon:A((()=>[S(k(n),null,{default:A((()=>[S(k(P),{icon:"fa-solid fa-plus",size:"sm"})])),_:1})])),default:A((()=>[R(" "+L(e.$t("Add Photos")),1)])),_:1})])]),w("div",Se,[w("div",Pe,[S(k(c),{size:"large",value:z.value.name,"onUpdate:value":r[2]||(r[2]=e=>z.value.name=e),placeholder:e.$t("Add Title")},null,8,["value","placeholder"]),S(k(c),{resizable:"",type:"textarea",value:z.value.intro,"onUpdate:value":r[3]||(r[3]=e=>z.value.intro=e),placeholder:e.$t("Add Description")},null,8,["value","placeholder"]),w("div",$e,L(k(a)(z.value.created_at).format("L"))+" - "+L(e.$t("{count} items",{count:z.value.photo_count})),1),S(k(d),{value:z.value.is_public,"onUpdate:value":r[4]||(r[4]=e=>z.value.is_public=e),size:"large"},{checked:A((()=>[R(L(e.$t("Public")),1)])),unchecked:A((()=>[R(L(e.$t("Private")),1)])),_:1},8,["value"])]),w("div",je,[S(X)]),S(Y,null,{default:A((()=>{var e;return[S(Z),S(ee),S(ae),S(te),S(ie),S(be,{"album-id":Number(null==(e=k(t).params)?void 0:e.id)},null,8,["album-id"]),S(le)]})),_:1})])])),_:1}),S(k(W),{show:k(T).shareModalActive,"onUpdate:show":r[8]||(r[8]=e=>k(T).shareModalActive=e),title:e.$t("Share Photos"),preset:"card",size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto z-50"},{action:A((()=>[U.value?(x(),b("div",Le,[S(k(c),{class:"grow select-all","default-value":U.value,readonly:""},null,8,["default-value"]),S(k(B),{tertiary:"",type:"primary",class:"shrink-0",onClick:se},{icon:A((()=>[S(k(P),{icon:"fa-solid fa-copy"})])),_:1})])):(x(),b("div",Ce,[S(k(B),{tertiary:"",onClick:Q},{default:A((()=>[R(L(e.$t("Create Share Link")),1)])),_:1})]))])),default:A((()=>[w("div",ze,[S(k(p),{model:q.value,rules:F,disabled:Boolean(U.value)},{default:A((()=>[S(k(v),{label:e.$t("Share Description"),path:"content"},{default:A((()=>[S(k(c),{resizable:"",type:"textarea",value:q.value.content,"onUpdate:value":r[5]||(r[5]=e=>q.value.content=e)},null,8,["value"])])),_:1},8,["label"]),S(k(v),{label:e.$t("Password"),path:"password"},{default:A((()=>[S(k(c),{type:"password",value:q.value.password,"onUpdate:value":r[6]||(r[6]=e=>q.value.password=e)},null,8,["value"])])),_:1},8,["label"]),S(k(v),{label:e.$t("Expiration Time"),path:"expired_at"},{default:A((()=>[S(k(f),{value:q.value.expired_at,"onUpdate:value":r[7]||(r[7]=e=>q.value.expired_at=e),type:"datetime",class:"w-full",placeholder:e.$t("Select Expiration Time"),"is-date-disabled":e=>e<Date.now(),clearable:""},null,8,["value","placeholder","is-date-disabled"])])),_:1},8,["label"])])),_:1},8,["model","disabled"])])])),_:1},8,["show","title"])])),_:1},8,["header-title"]))}});export{Ae as default};
