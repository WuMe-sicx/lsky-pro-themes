import{d as e,b as a,e as l,f as t,k as s,a as u,c as n,o,l as r,s as d,z as i,y as v,P as c,q as p,B as g,A as m,x as f,F as h,E as y,N as _,J as x,u as w,c7 as k,p as q,_ as b,i as $,c8 as j}from"./index.BwdMlFEt.js";import{E as C}from"./ExploreImage.DBwEgo9n.js";import{a as L,h as z,N as A,O as E,m as S,ad as U,_ as H,w as N}from"./Layout.vue_vue_type_script_setup_true_lang.CmpyqK56.js";import{N as B}from"./Checkbox.B-glgVrI.js";import{W as F}from"./WaterfallLayout.CRdKSUiM.js";import{_ as I}from"./Content.vue_vue_type_script_setup_true_lang.DOatZPr-.js";const M={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},O=[t("path",{d:"M35.4 87.12l168.65 196.44A16.07 16.07 0 0 1 208 294v119.32a7.93 7.93 0 0 0 5.39 7.59l80.15 26.67A7.94 7.94 0 0 0 304 440V294a16.07 16.07 0 0 1 4-10.44L476.6 87.12A14 14 0 0 0 466 64H46.05A14 14 0 0 0 35.4 87.12z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)],P=e({name:"FunnelOutline",render:function(e,t){return l(),a("svg",M,O)}}),T={class:"w-full"},V={class:"flex flex-col items-center space-y-4"},W={class:"flex w-full max-w-4xl items-center gap-3"},J={class:"flex-1"},K={key:0,class:"flex flex-wrap items-center gap-2 text-sm"},R={class:"text-gray-500"},D={key:0,class:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full"},G={key:1,class:"bg-purple-100 text-purple-800 px-2 py-1 rounded-full"},Q={key:1,class:"w-full max-w-4xl"},X={class:"space-y-4"},Y={class:"block text-sm font-medium mb-2"},Z={class:"block text-sm font-medium mb-2"},ee={class:"space-y-2"},ae={class:"text-sm text-gray-500"},le={class:"flex flex-wrap gap-2"},te={class:"space-y-2"},se=b(e({__name:"AdvancedExploreSearch",setup(e){const{t:b}=s(),$=x(),j=w();L();const C=u({q:"",order:"newest",tags:"",has_tags:!1}),H=[{label:b("Latest"),value:"newest"},{label:b("Oldest"),value:"oldest"},{label:b("Most Liked"),value:"most_liked"},{label:b("Least Liked"),value:"least_liked"}],N=u(!1),F=u([]);function I(){C.value.q=$.query.q||"",C.value.order=$.query.order||"newest",C.value.tags=$.query.tags||"",C.value.has_tags="1"===$.query.has_tags}const M=n((()=>{const e=new URLSearchParams;return C.value.q&&e.set("q",C.value.q),C.value.order&&"newest"!==C.value.order&&e.set("order",C.value.order),C.value.tags&&e.set("tags",C.value.tags),C.value.has_tags&&e.set("has_tags","1"),e.toString()})),O=n((()=>"newest"!==C.value.order||C.value.tags||C.value.has_tags));function se(){const e=M.value;j.push("/explore"+(e?"?"+e:""))}function ue(){C.value.order="newest",C.value.tags="",C.value.has_tags=!1,se()}function ne(e){const a=C.value.tags.split(",").filter((a=>a.trim()&&a!==e));C.value.tags=a.join(",")}const oe=n((()=>C.value.tags.split(",").filter((e=>e.trim()))));return I(),o((()=>{!async function(){var e;try{const a=await k({query:{limit:8}});"success"===(null==(e=a.data)?void 0:e.status)&&(F.value=a.data.data||[])}catch(a){F.value=[{id:1,name:"风景"},{id:2,name:"人像"},{id:3,name:"动物"},{id:4,name:"建筑"},{id:5,name:"美食"},{id:6,name:"旅行"},{id:7,name:"艺术"},{id:8,name:"自然"}]}}()})),r((()=>$.query),(()=>{I()})),r((()=>[C.value.order,C.value.tags,C.value.has_tags]),(()=>{se()}),{deep:!0}),(e,s)=>{var u;return l(),a("div",T,[t("div",V,[t("div",W,[t("div",J,[i(v(z),{value:C.value.q,"onUpdate:value":s[0]||(s[0]=e=>C.value.q=e),round:"",size:"large",placeholder:e.$t("Enter keywords and press Enter to search..."),onKeyup:c(se,["enter"])},{prefix:p((()=>[i(v(A),{component:v(E)},null,8,["component"])])),_:1},8,["value","placeholder"])]),i(v(g),{size:"large",type:N.value?"primary":"default",round:"",onClick:s[1]||(s[1]=e=>N.value=!N.value)},{icon:p((()=>[i(v(A),{component:v(P)},null,8,["component"])])),default:p((()=>[m(" "+f(e.$t("Filter")),1)])),_:1},8,["type"])]),O.value?(l(),a("div",K,[t("span",R,f(e.$t("Active filters"))+":",1),"newest"!==C.value.order?(l(),a("span",D,f(null==(u=H.find((e=>e.value===C.value.order)))?void 0:u.label),1)):d("",!0),(l(!0),a(h,null,y(oe.value,(e=>(l(),a("span",{key:e,class:"bg-green-100 text-green-800 px-2 py-1 rounded-full flex items-center gap-1"},[m(f(e)+" ",1),i(v(g),{text:"",size:"tiny",onClick:a=>ne(e)},{default:p((()=>[i(v(A),{component:v(U)},null,8,["component"])])),_:2},1032,["onClick"])])))),128)),C.value.has_tags?(l(),a("span",G,f(e.$t("Has tags only")),1)):d("",!0),i(v(g),{text:"",size:"small",onClick:ue,class:"text-gray-500"},{default:p((()=>[m(f(e.$t("Clear all")),1)])),_:1})])):d("",!0),N.value?(l(),a("div",Q,[i(v(_),null,{default:p((()=>[t("div",X,[t("div",null,[t("label",Y,f(e.$t("Sort by")),1),i(v(S),{value:C.value.order,"onUpdate:value":s[2]||(s[2]=e=>C.value.order=e),options:H,class:"w-full"},null,8,["value"])]),t("div",null,[t("label",Z,f(e.$t("Tags")),1),i(v(z),{value:C.value.tags,"onUpdate:value":s[3]||(s[3]=e=>C.value.tags=e),placeholder:e.$t("Enter tags separated by commas"),class:"mb-2"},null,8,["value","placeholder"]),t("div",ee,[t("div",ae,f(e.$t("Popular tags"))+":",1),t("div",le,[(l(!0),a(h,null,y(F.value,(e=>(l(),q(v(g),{key:e.id,size:"small",type:oe.value.includes(e.name)?"primary":"default",round:"",onClick:a=>oe.value.includes(e.name)?ne(e.name):function(e){const a=C.value.tags.split(",").filter((e=>e.trim()));a.includes(e)||(a.push(e),C.value.tags=a.join(","))}(e.name)},{default:p((()=>[m(f(e.name),1)])),_:2},1032,["type","onClick"])))),128))])])]),t("div",te,[i(v(B),{checked:C.value.has_tags,"onUpdate:checked":s[4]||(s[4]=e=>C.value.has_tags=e)},{default:p((()=>[m(f(e.$t("Show only photos with tags")),1)])),_:1},8,["checked"])])])])),_:1})])):d("",!0)])])}}}),[["__scopeId","data-v-6e5f4bef"]]),ue={class:"w-full"},ne={class:"container mx-auto p-4 sm:p-8"},oe={key:0,style:{"padding-left":"6px","padding-right":"6px"}},re={key:1,class:"flex justify-center mt-20 container mx-auto"},de=e({__name:"IndexView",setup(e){var s,n;const d=x(),c=w(),g=L(),m=$();m.configs&&!(null==(n=null==(s=m.configs)?void 0:s.app)?void 0:n.enable_explore)&&c.replace("/404");const f=u([]),h=u({q:"",order:"newest",tags:"",has_tags:!1}),y=u(1),_=u(!1),k=u(!1);async function b(){var e,a,l,t,s;if(!_.value&&!k.value){_.value=!0;try{const u={page:y.value,per_page:40};h.value.q&&(u.q=h.value.q),h.value.order&&"newest"!==h.value.order&&(u.order=h.value.order),h.value.tags&&(u.tags=h.value.tags),h.value.has_tags&&(u.has_tags=1);const n=await j({query:u});if("error"===(null==(e=n.data)?void 0:e.status))return void g.error(null==(a=n.data)?void 0:a.message);const o=(null==(l=n.data)?void 0:l.data.data)||[];f.value.push(...o),o.length>0&&y.value++,k.value=(null==(t=n.data)?void 0:t.data.meta.last_page)===(null==(s=n.data)?void 0:s.data.meta.current_page)}catch(u){g.error("加载失败，请重试")}finally{_.value=!1}}}function z(e){const a=e.target;100+a.scrollTop+a.clientHeight>=a.scrollHeight&&(_.value||k.value||b())}function A(){h.value.q=d.query.q||"",h.value.order=d.query.order||"newest",h.value.tags=d.query.tags||"",h.value.has_tags="1"===d.query.has_tags}return o((()=>{A(),b()})),r((()=>d.query),(()=>{f.value=[],y.value=1,_.value=!1,k.value=!1,A(),b(),window.scrollTo(0,0)}),{deep:!0}),(e,s)=>(l(),q(H,{"toggle-header":!1,"show-footer":!0,"header-title":e.$t("Square"),"on-scroll":z},{default:p((()=>[i(I,null,{default:p((()=>[t("div",ue,[t("div",ne,[i(se)]),f.value.length>0?(l(),a("div",oe,[i(F,{items:f.value.map((e=>({...e,id:e.id}))),"column-width":200,gap:6,loading:_.value,"show-load-more":!k.value,onLoadMore:b},{default:p((({item:e})=>[i(C,{photo:e,photos:f.value},null,8,["photo","photos"])])),_:1},8,["items","loading","show-load-more"])])):(l(),a("div",re,[i(v(N),{description:e.$t("No data available"),size:"large"},null,8,["description"])]))])])),_:1})])),_:1},8,["header-title"]))}});export{de as default};
