import{x as e,a as t,A as l,N as a,H as o,J as s,s as n,w as i,k as r,G as c,l as u,h as d,K as p}from"./Layout.vue_vue_type_script_setup_true_lang.CmpyqK56.js";import{d as v,b as h,e as m,f,j as y,c as g,k as b,J as k,a as w,F as x,z as _,y as C,aj as S,C as A,D as P,p as M,s as j,ae as z,q as D,Z as E,ar as I,av as L,l as T,_ as U,v as B,x as $,E as N,B as O,A as K,o as F,aw as H,an as R,ax as W}from"./index.BwdMlFEt.js";import{P as q,W as G}from"./WaterfallLayout.CRdKSUiM.js";import{E as J}from"./album.iaKGDHY4.js";import{D as V}from"./DeleteOutlined.D4JLK8TR.js";import{u as X}from"./composables.CSWeWDlK.js";import{N as Y}from"./Spin.tqDYaYhL.js";import{N as Z}from"./Popconfirm.C2gxRyC4.js";const Q={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ee=[f("path",{d:"M384 224v184a40 40 0 0 1-40 40H104a40 40 0 0 1-40-40V168a40 40 0 0 1 40-40h167.48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),f("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M336 64h112v112"},null,-1),f("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M224 288L440 72"},null,-1)],te=v({name:"OpenOutline",render:function(e,t){return m(),h("svg",Q,ee)}}),le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ae=[f("path",{d:"M336 192h40a40 40 0 0 1 40 40v192a40 40 0 0 1-40 40H136a40 40 0 0 1-40-40V232a40 40 0 0 1 40-40h40",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),f("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M336 128l-80-80l-80 80"},null,-1),f("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 321V48"},null,-1)],oe=v({name:"ShareOutline",render:function(e,t){return m(),h("svg",le,ae)}}),se={class:"relative group bg-gray-200 dark:bg-gray-700"},ne={class:"absolute inset-0 flex justify-between z-[2] select-none"},ie={class:"absolute top-2 right-2"},re={class:"flex gap-2"},ce=["onClick"],ue=["onClick"],de=U(v({__name:"Photo",props:{photo:{}},emits:["onToggleSelect"],setup(n,{emit:i}){const r=n;y();const c=g((()=>r.photo)),u=e(),{t:d}=b(),p=t(),v=X(),U=k(),B=g((()=>U.path.includes("/user/albums/"))),$=w(null),N=w(!1),O=w(),K={showThumbnails:!0,showDrawer:!0,drawerConfig:{defaultOpen:!0,title:"图片信息"},controls:{showClose:!0,showInfo:!0,showNavigation:!0}},F=g((()=>u.groups.flatMap((e=>e.photos)).map((e=>({id:e.key,src:e.public_url||e.src,thumbnail:e.thumbnail_url||e.src,name:e.name,width:e.width,height:e.height,size:e.size,extension:e.extension,created_at:e.created_at||void 0,is_public:e.is_public,tags:e.tags||[]})))));function H(e){e&&(e.preventDefault(),e.stopPropagation());const t=c.value.key;if(e&&(e.ctrlKey||e.metaKey))return u.toggleSelect(t),void($.value=t);e&&e.shiftKey&&$.value?function(e,t){let l=-1,a=-1,o=-1,s=-1;const n=u.groups;for(let i=0;i<n.length;i++){const r=n[i];for(let n=0;n<r.photos.length;n++)r.photos[n].key===e&&(l=i,a=n),r.photos[n].key===t&&(o=i,s=n)}if(-1===l||-1===o)return;(l>o||l===o&&a>s)&&([l,o]=[o,l],[a,s]=[s,a]);for(let i=l;i<=o;i++){const e=n[i],t=i===l?a:0,r=i===o?s:e.photos.length-1;for(let l=t;l<=r;l++){const t=e.photos[l].key;e.photos[l].selected||u.toggleSelect(t)}}}($.value,t):(u.toggleSelect(t),$.value=t)}function R(e){e.ctrlKey||e.metaKey||e.shiftKey?H(e):(e.preventDefault(),O.value=c.value.key,N.value=!0)}function W(e){return()=>E(a,null,{default:()=>E(e)})}const G=g((()=>[{label:d("Copy Image"),key:"copy",disabled:u.selections.length>1,icon:W(o)},{label:d("Copy Link"),key:"copy-urls",icon:W(o),children:[{label:"Url",key:"copy-url"},{label:"Html",key:"copy-html"},{label:"BBCode",key:"copy-bbcode"},{label:"Markdown",key:"copy-markdown"},{label:"Markdown with link",key:"copy-markdown_with_link"},{label:"Thumbnail url",key:"copy-thumbnail_url"}]},{label:d("Open in New Window"),key:"open",disabled:u.selections.length>1,icon:W(te)},{label:d("Edit Information"),key:"edit",icon:W(J)},{label:d("Share"),key:"share",icon:W(oe)},...B.value?[{label:d("Remove from Album"),key:"remove-from-album",icon:W(s)}]:[{label:d("Add to Album"),key:"to-album",icon:W(s)}],{type:"divider",key:"d1"},{label:d("Delete"),key:"delete",icon:W(V)}])),Y=w(!1),Z=w(0),Q=w(0);function ee(e){var t;Y.value=!1;const l=String(e);switch(l){case"copy":u.copyImage(c.value.src).then((()=>{p.success(d("Copy successful"))})).catch((e=>{p.error(d("Copy failed"))}));break;case"copy-url":case"copy-html":case"copy-bbcode":case"copy-markdown":case"copy-markdown_with_link":case"copy-thumbnail_url":u.copyLink(l.replace("copy-","")).then((()=>{p.success(d("Copy successful"))})).catch((()=>{p.error(d("Copy failed"))}));break;case"open":u.openPhoto(c.value);break;case"edit":u.setEditModalActive(!0);break;case"share":u.setShareModalActive(!0);break;case"to-album":null==(t=u.albumSelectorRef)||t.open();break;case"remove-from-album":const e=Number(U.params.id);if(e){const t=v.warning({title:d("Warning"),content:d("Are you sure you want to remove the selected {count} photos from the album?",{count:u.selections.length}),positiveText:d("Confirm"),negativeText:d("Cancel"),onPositiveClick:()=>(t.loading=!0,I({path:{id:e},body:u.selections.map((e=>e.id))}).then((()=>{p.success(d("Removed successfully")),u.deletePhotos(u.selections.map((e=>e.key)));const e=y();e.isLoggedIn&&e.fetchUserProfile()})))})}break;case"delete":const a=v.warning({title:d("Warning"),content:d("Are you sure you want to delete the selected {count} photos?",{count:u.selections.length}),positiveText:d("Confirm"),negativeText:d("Cancel"),onPositiveClick:()=>(a.loading=!0,u.deleteSelectedPhotos().then((()=>{p.success(d("Deleted successfully"))})))})}}function le(e){e.preventDefault(),Y.value=!1,L().then((()=>{Y.value=!0,Z.value=e.clientX,Q.value=e.clientY})),c.value.selected||(u.unselectAll(),setTimeout((()=>{u.toggleSelect(c.value.key)}),10))}function ae(){Y.value=!1}return(e,t)=>(m(),h(x,null,[f("a",{href:"javascript:void(0)",onContextmenu:le,onClick:R},[_(C(l),{placement:"bottom-start",trigger:"manual",x:Z.value,y:Q.value,options:G.value,show:Y.value,"on-clickoutside":ae,onSelect:ee},null,8,["x","y","options","show"]),f("div",se,[t[3]||(t[3]=f("div",{class:"transition-all absolute w-full top-0 h-1/2 bg-gradient-to-b from-black/30 opacity-0 group-hover:opacity-100"},null,-1)),f("div",ne,[_(C(S),{class:P(["rounded-full cursor-pointer absolute top-2 left-2",c.value.selected?"text-violet-500 bg-white outline outline-1 outline-white dark:outline-gray-500":"hidden group-hover:block text-white/70 hover:text-white"]),icon:"fa-solid fa-circle-check",size:"xl",onClick:A(H,["prevent","stop"])},null,8,["class"]),f("div",ie,[c.value.is_public?(m(),M(C(S),{key:0,class:"text-red-500",icon:"fa-solid fa-eye",title:e.$t("Public")},null,8,["title"])):j("",!0)])]),f("div",{class:P(["overflow-hidden transition-all",c.value.selected?"scale-90 rounded-lg":""])},[z(e.$slots,"default",{},void 0,!0)],2)])],32),_(C(q),{show:N.value,"onUpdate:show":t[0]||(t[0]=e=>N.value=e),"current-photo-id":O.value,"onUpdate:currentPhotoId":t[1]||(t[1]=e=>O.value=e),photos:F.value,config:K,"onPhoto:change":t[2]||(t[2]=e=>{})},{"top-right":D((({photo:e})=>[f("div",re,[f("button",{class:"viewer-button",onClick:t=>function(e){const t=u.groups.flatMap((e=>e.photos)).find((t=>t.key===e.id));if(t){const e=u.selections.slice();u.unselectAll(),u.toggleSelect(t.key),u.setEditModalActive(!0);const l=T((()=>u.editModalActive),(t=>{t||(u.unselectAll(),e.forEach((e=>{u.toggleSelect(e.key)})),l())}))}}(e)},[_(C(S),{icon:"fa-solid fa-edit",class:"text-sm text-white"})],8,ce),f("button",{class:"viewer-button",onClick:t=>function(e){const t=u.groups.flatMap((e=>e.photos)).find((t=>t.key===e.id));if(t){const e=u.selections.slice();u.unselectAll(),u.toggleSelect(t.key),u.setShareModalActive(!0);const l=T((()=>u.shareModalActive),(t=>{t||(u.unselectAll(),e.forEach((e=>{u.toggleSelect(e.key)})),l())}))}}(e)},[_(C(S),{icon:"fa-solid fa-share",class:"text-sm text-white"})],8,ue)])])),"drawer-content":D((({photo:e})=>t[4]||(t[4]=[]))),_:1},8,["show","current-photo-id","photos"])],64))}}),[["__scopeId","data-v-70120bdd"]]),pe={class:"photo-image-container relative w-full"},ve={key:0,class:"text-gray-500 dark:text-gray-400 text-xs text-center px-2"},he={key:1,class:"text-gray-500 dark:text-gray-400 text-xs text-center px-2"},me=["src","alt"],fe=U(v({__name:"PhotoImage",props:{src:{type:String,required:!0},alt:{type:String,default:""},placeholderText:{type:String,default:"努力加载中..."},aspectRatio:{type:String,default:"auto"}},setup(e){const t=w(!0),l=w(!1),a=w();function o(){t.value=!1,l.value=!1}function s(){t.value=!1,l.value=!0}return(n,i)=>(m(),h("div",pe,[t.value||l.value?(m(),h("div",{key:0,class:"absolute inset-0 bg-gray-100 dark:bg-gray-700 rounded-sm flex items-center justify-center",style:B({minHeight:"200px"})},[t.value?(m(),h("div",ve,$(e.placeholderText),1)):l.value?(m(),h("div",he," 加载失败 ")):j("",!0)],4)):j("",!0),f("img",{ref_key:"imageRef",ref:a,src:e.src,alt:e.alt,class:P(["w-full h-auto object-cover rounded-sm transition-opacity duration-300",{"opacity-0":t.value||l.value,"opacity-100":!t.value&&!l.value}]),loading:"lazy",onLoad:o,onError:s},null,42,me)]))}}),[["__scopeId","data-v-04ab47bf"]]),ye={class:"flex flex-col space-y-2"},ge={class:"sticky top-12 z-[3] py-2 bg-white dark:bg-[var(--n-color)] flex space-x-2 items-center overflow-hidden group text-md"},be={class:"font-bold"},ke=v({__name:"PhotoGroup",props:{group:{type:Object,default:()=>{},required:!0}},setup(t){const l=t,{toggleSelectAllByGroup:a}=e(),{t:o}=b(),s=[o("Sunday"),o("Monday"),o("Tuesday"),o("Wednesday"),o("Thursday"),o("Friday"),o("Saturday")],i=g((()=>l.group.photos.map((e=>({...e,id:e.key})))));return(e,t)=>(m(),h("div",ye,[f("div",ge,[_(C(S),{icon:l.group.selected?"fa-solid fa-circle-check":"fa-regular fa-circle",size:"xl",class:P(["cursor-pointer transition-all select-none",l.group.selected?"text-violet-500 ml-0.5":"-ml-6 group-hover:ml-0.5 text-gray-500/70"]),onClick:t[0]||(t[0]=()=>C(a)(l.group.date))},null,8,["icon","class"]),f("p",be,$(C(n)(l.group.date).format("L"))+" "+$(s[C(n)(l.group.date).day()]),1)]),_(G,{items:i.value,"column-width":220,gap:8,showLoadMore:!1},{default:D((({item:e})=>[_(de,{photo:e},{default:D((()=>[_(fe,{src:e.src,alt:e.name||"","placeholder-text":"拼命加载中..."},null,8,["src","alt"])])),_:2},1032,["photo"])])),_:1},8,["items"])]))}}),we={key:2,class:"flex justify-center py-10"},xe=v({__name:"PhotoList",setup(t){const l=e();return(e,t)=>(m(),h(x,null,[C(l).isLoading||0!==C(l).groups.length?(m(!0),h(x,{key:1},N(C(l).groups,(e=>(m(),M(ke,{group:e,key:e.date},null,8,["group"])))),128)):(m(),M(C(i),{key:0,class:"my-10",description:e.$t("No photos available")},null,8,["description"])),C(l).isLoading?(m(),h("div",we,[_(C(Y),{size:25})])):j("",!0)],64))}}),_e=v({__name:"PhotoOperates",setup(t){const l=e();return(e,t)=>(m(),h("div",{class:P(["flex flex-col items-center absolute p-2 md:p-3 my-2 z-[3] bg-white/95 dark:bg-black/80 border border-transparent dark:border-slate-400 transition-all rounded-2xl shadow-md space-y-2 md:space-y-3",C(l).selections.length>0?"right-2 md:right-6":"-right-20"])},[z(e.$slots,"default")],2))}}),Ce=v({__name:"PhotoCopyLink",setup(a){const o=e(),s=t(),{t:n}=b(),i=[{label:"Url",key:"url"},{label:"Html",key:"html"},{label:"BBCode",key:"bbcode"},{label:"Markdown",key:"markdown"},{label:"Markdown with link",key:"markdown_with_link"},{label:"Thumbnail url",key:"thumbnail_url"}];function r(e){0!==o.selections.length?o.copyLink(e).then((()=>{s.success(n("Copy successful"))})).catch((()=>{s.error(n("Copy failed"))})):s.warning(n("Please select photos first"))}return(e,t)=>(m(),M(C(l),{placement:"left-start",trigger:"hover",size:"small","show-arrow":"",options:i,onSelect:r},{default:D((()=>[_(C(O),{tertiary:"",circle:"",size:"small",type:"default",title:e.$t("Copy Link")},{icon:D((()=>[_(C(S),{icon:"fa-solid fa-copy"})])),_:1},8,["title"])])),_:1}))}}),Se=v({__name:"PhotoCancel",setup(t){const l=e();return(e,t)=>(m(),M(C(O),{tertiary:"",circle:"",size:"small",type:"default",title:e.$t("Deselect")},{icon:D((()=>[_(C(S),{icon:"fa-solid fa-times",onClick:t[0]||(t[0]=e=>C(l).unselectAll())})])),_:1},8,["title"]))}}),Ae=v({__name:"PhotoDelete",setup(l){const a=e(),o=t(),{t:s}=b();function n(){a.deleteSelectedPhotos().then((()=>{o.success(s("Deleted successfully"))}))}return(e,t)=>(m(),M(C(Z),{placement:"left-start",onPositiveClick:n},{trigger:D((()=>[_(C(O),{quaternary:"",circle:"",size:"small",type:"error",title:e.$t("Delete Selected Items")},{icon:D((()=>[_(C(S),{icon:"fa-solid fa-trash-alt"})])),_:1},8,["title"])])),default:D((()=>[K(" "+$(e.$t("Are you sure you want to delete the selected {count} photos?",{count:C(a).selections.length})),1)])),_:1}))}}),Pe={key:0,class:"flex flex-col space-y-4"},Me={key:0,class:"text-sm dark:text-gray-300 mb-2 text-center p-2 bg-gray-50 dark:bg-gray-800 rounded"},je={key:1,class:"mb-4 bg-gray-50 dark:bg-gray-800 p-3 rounded"},ze={class:"text-sm font-medium mb-2 text-gray-700 dark:text-gray-300"},De={class:"flex flex-wrap gap-4"},Ee={class:"flex items-center gap-2"},Ie={class:"text-sm"},Le={class:"flex items-center gap-2"},Te={class:"text-sm"},Ue={class:"flex items-center gap-2"},Be={class:"text-sm"},$e={class:"flex items-center gap-2"},Ne={class:"text-sm"},Oe={class:"flex justify-end space-x-2"},Ke=v({__name:"PhotoEdit",setup(l){const a=e(),o=g((()=>a.selections)),s=g((()=>o.value.length>1)),n=g((()=>a.selections[0]||{tags:[]})),i=w(),v=w({}),y={},k=t(),{t:A}=b(),P=w({name:!s.value,intro:!s.value,is_public:!s.value,tags:!s.value});function z(){var e;if(0===o.value.length)return;const{name:t,intro:l,is_public:a}=n.value,i=(null==(e=n.value.tags)?void 0:e.map((e=>e.name)))||[];v.value={name:t,intro:l,is_public:a,tags:i},P.value={name:!s.value,intro:!s.value,is_public:!s.value,tags:!s.value}}async function E(){const e={ids:o.value.map((e=>e.id))};P.value.name&&(e.name=v.value.name),P.value.intro&&(e.intro=v.value.intro),P.value.is_public&&(e.is_public=v.value.is_public),P.value.tags&&(e.tags=v.value.tags),await W({body:e}).then((()=>{k.success(A("Successfully updated")),a.setEditModalActive(!1),o.value.forEach((e=>{P.value.name&&(e.name=v.value.name),P.value.intro&&(e.intro=v.value.intro),P.value.is_public&&(e.is_public=v.value.is_public),P.value.tags&&(e.tags=v.value.tags.map((e=>({name:e}))))}))})).catch((e=>{k.error(A("Update failed"))}))}return F((()=>{z()})),T((()=>a.editModalActive),(e=>{e&&L((()=>{z()}))})),(e,t)=>(m(),h(x,null,[(m(),M(H,{to:"body"},[_(C(R),{show:C(a).editModalActive,"onUpdate:show":t[9]||(t[9]=e=>C(a).editModalActive=e),title:s.value?C(A)("Batch Edit Information"):C(A)("Edit Information"),preset:"card",size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto","mask-closable":!1},{action:D((()=>[f("div",Oe,[_(C(O),{tertiary:"",type:"default",onClick:t[8]||(t[8]=e=>C(a).setEditModalActive(!1))},{default:D((()=>[K($(C(A)("Cancel")),1)])),_:1}),_(C(O),{tertiary:"",type:"primary",onClick:E},{default:D((()=>[K($(C(A)("Save")),1)])),_:1})])])),default:D((()=>[o.value.length>0?(m(),h("div",Pe,[_(C(r),{ref_key:"formRef",ref:i,model:v.value,rules:y},{default:D((()=>[s.value?(m(),h("div",Me,$(C(A)("Selected {count} photos for batch editing",{count:o.value.length})),1)):j("",!0),s.value?(m(),h("div",je,[f("div",ze,$(C(A)("Select fields to update"))+":",1),f("div",De,[f("div",Ee,[_(C(c),{value:P.value.name,"onUpdate:value":t[0]||(t[0]=e=>P.value.name=e),size:"small"},null,8,["value"]),f("span",Ie,$(C(A)("Custom Name")),1)]),f("div",Le,[_(C(c),{value:P.value.intro,"onUpdate:value":t[1]||(t[1]=e=>P.value.intro=e),size:"small"},null,8,["value"]),f("span",Te,$(C(A)("Description")),1)]),f("div",Ue,[_(C(c),{value:P.value.tags,"onUpdate:value":t[2]||(t[2]=e=>P.value.tags=e),size:"small"},null,8,["value"]),f("span",Be,$(C(A)("Tags")),1)]),f("div",$e,[_(C(c),{value:P.value.is_public,"onUpdate:value":t[3]||(t[3]=e=>P.value.is_public=e),size:"small"},null,8,["value"]),f("span",Ne,$(C(A)("Is Public")),1)])])])):j("",!0),_(C(u),{label:C(A)("Custom Name"),path:"name"},{default:D((()=>[_(C(d),{value:v.value.name,"onUpdate:value":t[4]||(t[4]=e=>v.value.name=e),disabled:s.value&&!P.value.name,placeholder:s.value&&!P.value.name?C(A)("Field not selected"):""},null,8,["value","disabled","placeholder"])])),_:1},8,["label"]),_(C(u),{label:C(A)("Description"),path:"intro"},{default:D((()=>[_(C(d),{resizable:"",type:"textarea",value:v.value.intro,"onUpdate:value":t[5]||(t[5]=e=>v.value.intro=e),disabled:s.value&&!P.value.intro,placeholder:s.value&&!P.value.intro?C(A)("Field not selected"):""},null,8,["value","disabled","placeholder"])])),_:1},8,["label"]),_(C(u),{label:C(A)("Tags"),path:"tags"},{default:D((()=>[_(C(p),{value:v.value.tags,"onUpdate:value":t[6]||(t[6]=e=>v.value.tags=e),disabled:s.value&&!P.value.tags,placeholder:s.value&&!P.value.tags?C(A)("Field not selected"):""},null,8,["value","disabled","placeholder"])])),_:1},8,["label"]),_(C(u),{label:C(A)("Is Public"),path:"is_public"},{default:D((()=>[_(C(c),{value:v.value.is_public,"onUpdate:value":t[7]||(t[7]=e=>v.value.is_public=e),disabled:s.value&&!P.value.is_public},null,8,["value","disabled"])])),_:1},8,["label"])])),_:1},8,["model"])])):j("",!0)])),_:1},8,["show","title"])])),_(C(O),{tertiary:"",circle:"",size:"small",type:"default",title:o.value.length>1?C(A)("Batch Edit Information"):C(A)("Edit Information"),onClick:t[10]||(t[10]=e=>C(a).setEditModalActive(!0))},{icon:D((()=>[_(C(S),{icon:"fa-solid fa-edit"})])),_:1},8,["title"])],64))}}),Fe=v({__name:"PhotoSelect",setup(t){const l=e();return(e,t)=>(m(),M(C(O),{tertiary:"",circle:"",size:"small",type:"default",title:C(l).isAllSelected?e.$t("Deselect All"):e.$t("Select All")},{icon:D((()=>[_(C(S),{icon:"fa-solid fa-"+(C(l).isAllSelected?"check-double":"check"),onClick:t[0]||(t[0]=()=>{C(l).isAllSelected?C(l).unselectAll():C(l).selectAll()})},null,8,["icon"])])),_:1},8,["title"]))}});export{fe as P,xe as _,_e as a,Se as b,Fe as c,Ce as d,Ke as e,Ae as f};
