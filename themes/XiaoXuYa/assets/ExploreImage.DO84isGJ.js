import{d as e,b as t,e as o,f as s,aA as a,ck as i,cl as l,k as n,a as r,v as u,x as d,B as c,an as p,C as h,D as v,A as f,E as k,cm as g,cn as x,co as w,cp as y,c as m,h as _,H as b,z as C,y as z,G as U,I as j,F as L,Z as I,aj as q,aw as A,u as B,_ as R}from"./index.CT88Sm32.js";import{P}from"./WaterfallLayout.BmuoTpDj.js";import{a as S,l as $,h as E,k as O,n as H,d as D,f as F,N as M}from"./Layout.vue_vue_type_script_setup_true_lang.CVCKf7J5.js";const N={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},T=[s("path",{d:"M256 448a32 32 0 0 1-18-5.57c-78.59-53.35-112.62-89.93-131.39-112.8c-40-48.75-59.15-98.8-58.61-153C48.63 114.52 98.46 64 159.08 64c44.08 0 74.61 24.83 92.39 45.51a6 6 0 0 0 9.06 0C278.31 88.81 308.84 64 352.92 64c60.62 0 110.45 50.52 111.08 112.64c.54 54.21-18.63 104.26-58.61 153c-18.77 22.87-52.8 59.45-131.39 112.8a32 32 0 0 1-18 5.56z",fill:"currentColor"},null,-1)],G=e({name:"Heart",render:function(e,s){return o(),t("svg",N,T)}}),W={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Z=[s("path",{d:"M352.92 80C288 80 256 144 256 144s-32-64-96.92-64c-52.76 0-94.54 44.14-95.08 96.81c-1.1 109.33 86.73 187.08 183 252.42a16 16 0 0 0 18 0c96.26-65.34 184.09-143.09 183-252.42c-.54-52.67-42.32-96.81-95.08-96.81z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1)],J=e({name:"HeartOutline",render:function(e,s){return o(),t("svg",W,Z)}}),K=a("explore",(()=>({photoLiked:async function(e){return await i({path:{id:e}})},photoUnlinked:async function(e){return await l({path:{id:e}})}}))),Q={class:"flex flex-col space-y-4"},V={class:"flex justify-end"},X=e({__name:"Report",props:{type:{type:String,required:!0}},setup(e,{expose:t}){const{t:a}=n(),i=e,l={album:a("Album"),photo:a("Photo"),user:a("User"),share:a("Share")},m=S(),_=r(!1),b=r(),C=r({content:""}),z={},U=r({});async function j(){var e,t;const o={photo:y,album:w,user:x,share:g},s=await o[i.type]({body:{content:C.value.content},...U.value});if("error"===(null==(e=s.data)?void 0:e.status))return m.error(null==(t=s.data)?void 0:t.message);m.success(a("Report submitted successfully. Thank you for your feedback!")),L()}function L(){_.value=!1}return t({open:function(e){U.value=e,_.value=!0},close:L}),(t,a)=>(o(),u(c(p),{show:_.value,"onUpdate:show":a[1]||(a[1]=e=>_.value=e),title:`举报${l[e.type]}`,preset:"card",size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto"},{action:d((()=>[s("div",V,[h(c(k),{tertiary:"",onClick:j},{default:d((()=>[v(f(t.$t("Confirm Report")),1)])),_:1})])])),default:d((()=>[s("div",Q,[h(c(O),{ref_key:"reportFormRef",ref:b,model:C.value,rules:z},{default:d((()=>[h(c($),{label:t.$t("Please describe the reason for reporting"),path:"content"},{default:d((()=>[h(c(E),{resizable:"",type:"textarea",value:C.value.content,"onUpdate:value":a[0]||(a[0]=e=>C.value.content=e)},null,8,["value"])])),_:1},8,["label"])])),_:1},8,["model"])])])),_:1},8,["show","title"]))}}),Y={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-700 rounded-sm"},ee={key:0,class:"text-gray-500 dark:text-gray-400 text-xs text-center px-2"},te={key:1,class:"text-gray-500 dark:text-gray-400 text-xs text-center px-2"},oe=["src","alt"],se={class:"bg-gradient-to-t from-black via-black/80 to-transparent p-2 space-y-1"},ae={class:"text-xs font-medium truncate"},ie={class:"text-xs opacity-90"},le={class:"sm:hidden space-y-0.5"},ne={class:"hidden sm:block truncate"},re={key:0,class:"flex gap-1 flex-wrap"},ue={key:0,class:"text-xs opacity-70"},de={class:"flex items-center justify-between space-x-2 pt-1"},ce={key:0,class:"flex items-center min-w-0 flex-1"},pe={class:"ml-2 min-w-0"},he={key:1,class:"shrink-0"},ve={class:"text-white text-xs hidden sm:inline"},fe={class:"flex gap-2"},ke=["onClick"],ge=["onClick"],xe={class:"text-white text-xs"},we={class:"explore-photo-info"},ye={key:0,class:"user-section"},me={class:"user-details"},_e={class:"user-name"},be={class:"user-username"},Ce=R(e({__name:"ExploreImage",props:{photo:{type:Object,required:!0,default:()=>{}},photos:{type:Array,required:!1,default:()=>[]},showUserInfo:{type:Boolean,required:!1,default:()=>!0},showLike:{type:Boolean,required:!1,default:()=>!0},showReport:{type:Boolean,required:!1,default:()=>!0}},setup(e){const a=e,i=r(!1),l=r(null),n=r(),p={showThumbnails:!0,showDrawer:!0,drawerConfig:{defaultOpen:!0,title:"图片信息"},controls:{showClose:!0,showInfo:!0,showNavigation:!0}},v=m((()=>(a.photos.length>0?a.photos:[a.photo]).map((e=>({id:e.id,src:e.public_url||e.src,thumbnail:e.thumbnail_url,name:e.name,width:e.width,height:e.height,size:e.size,extension:e.extension,tags:e.tags,user:e.user,is_liked:e.is_liked,is_public:e.is_public,created_at:e.created_at,updated_at:e.updated_at}))))),g=r(!0),x=r(!1),w=K(),y=B(),R=_();function S(){if(a.photo.is_liked){if(w.photoUnlinked(a.photo.id),a.photo.is_liked=!1,a.photos.length>0){const e=a.photos.find((e=>e.id===a.photo.id));e&&(e.is_liked=!1)}}else if(w.photoLiked(a.photo.id),a.photo.is_liked=!0,a.photos.length>0){const e=a.photos.find((e=>e.id===a.photo.id));e&&(e.is_liked=!0)}}function $(){y.push(`/explore/@${a.photo.user.username}`).then((()=>R.setSidebarOpen(!1)))}function E(){n.value=a.photo.id,i.value=!0}function O(){g.value=!1,x.value=!1}function N(){g.value=!1,x.value=!0}return(e,r)=>(o(),t(b,null,[s("div",{class:"relative group overflow-hidden w-full cursor-zoom-in bg-gray-100 dark:bg-gray-800 rounded-sm",onClick:E,style:C({paddingBottom:(a.photo.width&&a.photo.height?a.photo.height/a.photo.width*100:75)+"%"})},[g.value||x.value?(o(),t("div",Y,[g.value?(o(),t("div",ee," 努力加载中... ")):x.value?(o(),t("div",te," 加载失败 ")):z("",!0)])):z("",!0),s("img",{src:a.photo.thumbnail_url,alt:a.photo.name,class:U(["absolute inset-0 w-full h-full object-cover transition-all duration-300 group-hover:scale-105",{"opacity-0":g.value||x.value,"opacity-100":!g.value&&!x.value}]),loading:"lazy",onLoad:O,onError:N},null,42,oe),s("div",{class:U(["absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300",{"pointer-events-none":g.value||x.value}])},null,2),s("div",{class:U(["absolute bottom-0 left-0 right-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-white",{"pointer-events-none":g.value||x.value}])},[s("div",se,[s("div",ae,f(a.photo.name||"Untitled"),1),s("div",ie,[s("div",le,[s("div",null,f((a.photo.extension||"Unknown").toUpperCase()),1),s("div",null,f(a.photo.width||0)+" × "+f(a.photo.height||0),1),s("div",null,f(c(H).fileSize(1024*(a.photo.size||0))),1)]),s("div",ne,f((a.photo.extension||"Unknown").toUpperCase())+" • "+f(a.photo.width||0)+" × "+f(a.photo.height||0)+" • "+f(c(H).fileSize(1024*(a.photo.size||0))),1)]),a.photo.tags&&a.photo.tags.length>0?(o(),t("div",re,[(o(!0),t(b,null,j(a.photo.tags.slice(0,2),(e=>(o(),t("span",{key:e.id,class:"bg-white bg-opacity-20 rounded px-1 text-xs max-w-16 truncate"},f(e.name),1)))),128)),a.photo.tags.length>2?(o(),t("span",ue,"+"+f(a.photo.tags.length-2),1)):z("",!0)])):z("",!0),s("div",de,[a.showUserInfo?(o(),t("div",ce,[h(c(D),{class:"shrink-0 cursor-pointer z-10",round:"",size:16,src:c(F).getUserAvatar(a.photo.user.avatar_url),onClick:L($,["stop"])},null,8,["src"]),s("div",pe,[s("a",{href:"javascript:void(0)",onClick:L($,["stop"]),class:"text-white text-xs truncate block hover:text-gray-200"},f(a.photo.user.name),1)])])):z("",!0),a.showLike?(o(),t("div",he,[h(c(k),{quaternary:"",size:"tiny",class:"z-10 relative",type:a.photo.is_liked?"error":"default","render-icon":()=>I(c(M),{size:12},{default:()=>I(a.photo.is_liked?c(G):c(J))}),onClick:L(S,["stop"])},{default:d((()=>[s("span",ve,f(e.$t("Like")),1)])),_:1},8,["type","render-icon"])])):z("",!0)])])],2)],4),h(c(P),{show:i.value,"onUpdate:show":r[0]||(r[0]=e=>i.value=e),"current-photo-id":n.value,"onUpdate:currentPhotoId":r[1]||(r[1]=e=>n.value=e),photos:v.value,config:p,"onPhoto:change":r[2]||(r[2]=e=>{})},{"top-right":d((({photo:e})=>[s("div",fe,[a.showLike?(o(),t("button",{key:0,class:"viewer-button",onClick:t=>function(e){if(e.is_liked){if(w.photoUnlinked(e.id),e.is_liked=!1,a.photos.length>0){const t=a.photos.find((t=>t.id===e.id));t&&(t.is_liked=!1)}a.photo.id===e.id&&(a.photo.is_liked=!1)}else{if(w.photoLiked(e.id),e.is_liked=!0,a.photos.length>0){const t=a.photos.find((t=>t.id===e.id));t&&(t.is_liked=!0)}a.photo.id===e.id&&(a.photo.is_liked=!0)}}(e)},[h(c(q),{icon:e.is_liked?"fa-solid fa-heart":"fa-regular fa-heart",class:U(["text-sm",{"text-red-500":e.is_liked,"text-white":!e.is_liked}])},null,8,["icon","class"])],8,ke)):z("",!0),a.showReport?(o(),t("button",{key:1,class:"viewer-button",onClick:t=>{return o=e,void(null==(s=l.value)||s.open({path:{id:o.id}}));var o,s}},[h(c(q),{icon:"fa-solid fa-flag",class:"text-sm text-white"})],8,ge)):z("",!0)])])),"top-left":d((({photo:e})=>[a.showUserInfo&&e.user?(o(),t("div",{key:0,class:"flex items-center gap-2 cursor-pointer bg-gray-600/80 hover:bg-gray-600/60 rounded-full px-3 py-2",onClick:$},[h(c(D),{round:"",size:20,src:c(F).getUserAvatar(e.user.avatar_url)},null,8,["src"]),s("span",xe,f(e.user.name),1)])):z("",!0)])),"drawer-content":d((({photo:e})=>[s("div",we,[a.showUserInfo&&e.user?(o(),t("div",ye,[r[3]||(r[3]=s("h4",{class:"section-title"},"上传者",-1)),s("div",{class:"user-card",onClick:$},[h(c(D),{round:"",size:40,src:c(F).getUserAvatar(e.user.avatar_url)},null,8,["src"]),s("div",me,[s("div",_e,f(e.user.name),1),s("div",be,"@"+f(e.user.username),1)])])])):z("",!0)])])),_:1},8,["show","current-photo-id","photos"]),(o(),u(A,{to:"body"},[h(X,{ref_key:"reportRef",ref:l,type:"photo"},null,512)]))],64))}}),[["__scopeId","data-v-a507ce6f"]]);export{Ce as E,X as _};
