import{d as e,h as a,i as t,j as l,a as r,k as o,J as s,o as i,u as n,Q as u,v as d,x as p,b as c,C as v,B as m,y as f,D as y,A as g,F as _,f as h,E as b,H as w,I as k,e as $,T as x,S as q}from"./index.CT88Sm32.js";import{_ as j}from"./AuthFormCard.vue_vue_type_script_setup_true_lang.CrV5ahWt.js";import{a as U,_ as z,i as S,j as R,k as C,h as P,l as A,N as L,f as I}from"./Layout.vue_vue_type_script_setup_true_lang.CVCKf7J5.js";import{_ as N,a as O}from"./PhoneVerifyInput.vue_vue_type_script_setup_true_lang.ejbxxdOt.js";import{L as T}from"./LogInOutline.yJkReCIH.js";import{N as E}from"./Spin.BLa4Xvvk.js";import{N as F}from"./Alert.DuCewca8.js";import"./bg.DrqemlYk.js";const M={key:0,class:"w-full h-full flex items-center justify-center"},Q={class:"flex justify-between"},V={key:2,class:"mt-8 mb-4"},B={class:"flex flex-row justify-center relative"},D={class:"relative z-[2] text-sm px-4 bg-white dark:bg-[var(--n-color)] text-gray-500"},G={class:"flex justify-center space-x-6 mt-4"},H={key:3,class:"text-center"},J=e({__name:"RegisterView",setup(e){var J,W;const K=a(),X=t(),Y=l(),Z=r(!0),ee=s(),ae=n(),te=U(),{t:le}=o(),re=r(null),oe=r({email:"",phone:"",name:"",username:"",password:"",password_confirmation:"",code:"",country_code:"cn",token:(null==(W=null==(J=ee.query)?void 0:J.token)?void 0:W.toString())||""}),se=async()=>{var e,a;const t=await x({body:oe.value});if("error"===(null==(e=t.data)?void 0:e.status))return te.error(null==(a=t.data)?void 0:a.message);te.success(le("Registration successful. Please log in.")),await ae.push("/login")},ie=r("email");return i((()=>{var e;ie.value=(null==(e=X.configs)?void 0:e.app.user_email_verify)?"email":"phone",Y.isLoggedIn&&ae.push("/user/dashboard").then((()=>{K.setSidebarOpen(!0)})),ee.query.driver_id&&ee.query.code?u({path:{id:ee.query.driver_id.toString()},body:{code:ee.query.code.toString()}}).then((e=>{var a;const t=(null==(a=e.data)?void 0:a.data.token.toString())||"";202===e.status?(ae.replace({query:{token:t}}),oe.value.token=t):(async e=>{Y.setToken(e),ae.push("/user/dashboard").then((()=>{K.setSidebarOpen(!0)}))})(e.data.data.token).then((()=>{te.success(le("Account exists. Logged in directly."))}))})).finally((()=>{Z.value=!1})):Z.value=!1})),(e,a)=>($(),d(z,{"header-title":e.$t("Register")},{default:p((()=>{var t;return[Z.value?($(),c("div",M,[v(m(E),{size:"small",description:"loading..."})])):($(),d(j,{key:1,title:e.$t("Register a {sitename} account",{sitename:null==(t=m(X).configs)?void 0:t.site.title})},{default:p((()=>{var t,l,r,o,s,i;return[oe.value.token?($(),d(m(F),{key:0,type:"info",class:"mb-4"},{default:p((()=>[y(g(e.$t("Register a new account and bind it. After binding, you can log in directly next time.")),1)])),_:1})):f("",!0),(null==(t=m(X).configs)?void 0:t.app.enable_registration)&&(null==(l=m(X).configs)?void 0:l.app.user_email_verify)&&(null==(r=m(X).configs)?void 0:r.app.user_phone_verify)?($(),d(m(S),{key:1,type:"segment",class:"mb-4",value:ie.value,"onUpdate:value":a[0]||(a[0]=e=>ie.value=e)},{default:p((()=>[v(m(R),{name:"email"},{default:p((()=>[y(g(e.$t("Register with Email")),1)])),_:1}),v(m(R),{name:"phone"},{default:p((()=>[y(g(e.$t("Register with Mobile Number")),1)])),_:1})])),_:1},8,["value"])):f("",!0),(null==(o=m(X).configs)?void 0:o.app.enable_registration)&&((null==(s=m(X).configs)?void 0:s.app.user_email_verify)||(null==(i=m(X).configs)?void 0:i.app.user_phone_verify))?($(),d(m(C),{key:2,ref_key:"formRef",ref:re,model:oe.value,"show-require-mark":!0,onSubmit:_(se,["prevent"])},{default:p((()=>{var t,l,r,o;return["email"===ie.value?($(),d(N,{key:0,size:"large",event:"register",email:oe.value.email,"onUpdate:email":a[1]||(a[1]=e=>oe.value.email=e),code:oe.value.code,"onUpdate:code":a[2]||(a[2]=e=>oe.value.code=e),"require-verify":null==(t=m(X).configs)?void 0:t.app.user_email_register_verify},null,8,["email","code","require-verify"])):f("",!0),"phone"===ie.value?($(),d(O,{key:1,size:"large",event:"register",phone:oe.value.phone,"onUpdate:phone":a[3]||(a[3]=e=>oe.value.phone=e),"country-code":oe.value.country_code,"onUpdate:countryCode":a[4]||(a[4]=e=>oe.value.country_code=e),code:oe.value.code,"onUpdate:code":a[5]||(a[5]=e=>oe.value.code=e),"require-verify":null==(l=m(X).configs)?void 0:l.app.user_phone_register_verify},null,8,["phone","country-code","code","require-verify"])):f("",!0),v(m(A),{label:e.$t("Username")},{default:p((()=>[v(m(P),{value:oe.value.username,"onUpdate:value":a[6]||(a[6]=e=>oe.value.username=e),"input-props":{required:!0},placeholder:e.$t("Please enter your username"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"]),v(m(A),{label:e.$t("Name")},{default:p((()=>[v(m(P),{value:oe.value.name,"onUpdate:value":a[7]||(a[7]=e=>oe.value.name=e),"input-props":{required:!0},placeholder:e.$t("Please enter your name"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"]),v(m(A),{label:e.$t("Password")},{default:p((()=>[v(m(P),{value:oe.value.password,"onUpdate:value":a[8]||(a[8]=e=>oe.value.password=e),placeholder:e.$t("Please enter your password"),type:"password","show-password-on":"mousedown",size:"large","input-props":{required:!0}},null,8,["value","placeholder"])])),_:1},8,["label"]),v(m(A),{label:e.$t("Confirm Password"),"show-feedback":!1},{default:p((()=>[v(m(P),{value:oe.value.password_confirmation,"onUpdate:value":a[9]||(a[9]=e=>oe.value.password_confirmation=e),placeholder:e.$t("Please confirm your password"),type:"password","show-password-on":"mousedown",size:"large","input-props":{required:!0}},null,8,["value","placeholder"])])),_:1},8,["label"]),v(m(A),null,{default:p((()=>[v(m(b),{type:"primary","attr-type":"submit",size:"large",strong:"",block:""},{icon:p((()=>[v(m(L),{component:m(T)},null,8,["component"])])),default:p((()=>[y(" "+g(e.$t("Register")),1)])),_:1})])),_:1}),h("div",Q,[a[11]||(a[11]=h("div",null,null,-1)),h("p",null,[y(g(e.$t("Already have an account?"))+" ",1),v(m(b),{text:"",type:"info",onClick:a[10]||(a[10]=e=>m(ae).push({path:"/login",query:{token:oe.value.token||void 0}}))},{default:p((()=>[y(g(e.$t("Go to Login")),1)])),_:1})])]),!oe.value.token&&((null==(r=m(X).configs)?void 0:r.app.socialites)||[]).length>0?($(),c("div",V,[h("div",B,[a[12]||(a[12]=h("div",{class:"absolute top-[10px] h-[1px] bg-gray-200 dark:bg-gray-500 w-[80%] z-[1]"},null,-1)),h("p",D,g(e.$t("Register with Other Methods")),1)]),h("div",G,[($(!0),c(w,null,k(null==(o=m(X).configs)?void 0:o.app.socialites,(e=>($(),d(m(b),{text:"",onClick:a=>(async e=>{var a,t;const l=await q({path:{id:e.id.toString()},query:{redirect_url:`${I.getWithoutQueryUrl()}?driver_id=${e.id}`}});if("error"===(null==(a=l.data)?void 0:a.status))return te.error(null==(t=l.data)?void 0:t.message);window.location.replace(l.data.data.redirect_url)})(e)},{icon:p((()=>[v(m(L),{component:m(I).getSocialiteIcon(e.provider)},null,8,["component"])])),default:p((()=>[y(" "+g(e.name),1)])),_:2},1032,["onClick"])))),256))])])):f("",!0)]})),_:1},8,["model"])):($(),c("div",H,g(e.$t("The system has closed the registration")),1))]})),_:1},8,["title"]))]})),_:1},8,["header-title"]))}});export{J as default};
