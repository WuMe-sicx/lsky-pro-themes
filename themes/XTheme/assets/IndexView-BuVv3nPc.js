import{al as e,aA as t,d as s,i as a,a as l,a4 as i,O as r,j as n,s as o,v as c,h as d,g as u,z as p,E as m,y as f,A as k,b as y,x as v,F as g,B as h,aB as x,f as _,n as b,_ as w}from"./index-Ctnlk-aF.js";import{_ as z}from"./Content.vue_vue_type_script_setup_true_lang-CATP0AmL.js";import{a as C,B as T,m as $,D as j,L as W,f as A}from"./Layout-B7WTefT3.js";import{_ as L}from"./DataTable.vue_vue_type_script_setup_true_lang-BVAbYJmv.js";import{u as P}from"./composables-DhvgzyQS.js";import"./Checkbox-oCtQDiYY.js";import"./Ellipsis-8oa2BOhe.js";const U=e("ticket",(()=>({closeTicket:async function(e,s,a,l,i={}){return new Promise((r=>{const n=a.warning({title:l("Close Ticket"),content:l("Once closed, you cannot reply to the ticket. Are you sure you want to close this ticket?"),positiveText:l("Confirm"),negativeText:l("Cancel"),onPositiveClick:()=>(n.loading=!0,new Promise((a=>{t({path:{issue_no:e}}).then((()=>{s.success(l("Closed successfully")),a(!0)})).catch((()=>{s.error(l("Close failed")),a(!1)})).finally((()=>{n.loading=!1,r(!0)}))}))),...i})}))}}))),B={class:"ticket-section rounded-xl border border-zinc-200 dark:border-zinc-800 p-5",style:{"--i":"0"}},K={class:"flex items-center justify-between"},D={class:"flex items-center gap-4"},E={class:"flex h-10 w-10 items-center justify-center rounded-lg bg-blue-100/50 dark:bg-blue-900/30"},M={class:"text-xl font-semibold text-zinc-900 dark:text-zinc-100"},q={class:"text-sm text-zinc-500 dark:text-zinc-400 mt-0.5"},I={class:"ticket-section rounded-xl border border-zinc-200 dark:border-zinc-800 p-5",style:{"--i":"1"}},O={class:"flex flex-col gap-4"},R={class:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},S={class:"flex items-center gap-1"},F=["onClick"],G={class:"grow md:grow-0 md:w-72"},H=w(s({__name:"IndexView",setup(e){const t=U(),s=n(),{t:w}=a(),H=C(),N=P(),V=l(),J=l("all"),Q=[{title:w("Ticket Number"),key:"issue_no",minWidth:250},{title:w("Ticket Title"),key:"title",minWidth:300},{title:w("Ticket Level"),key:"level",minWidth:120,sorter:!0,align:"center",render(e){const t={low:w("Low"),medium:w("Medium"),high:w("High")},s=e.level;return i(T,{type:{low:"info",medium:"warning",high:"danger"}[s]},{default:()=>t[s]||w("Unknown")})}},{title:w("Ticket Status"),key:"status",minWidth:100,align:"center",render(e){const t={in_progress:w("Processing"),completed:w("Completed")},s=e.status;return i(T,{type:{in_progress:"warning",completed:"success"}[s]},{default:()=>t[s]??w("Unknown")})}},{title:w("Creation Time"),minWidth:200,key:"created_at",sorter:!0,align:"center",render:e=>$(e.created_at).format("L")},{title:w("Actions"),key:"actions",minWidth:170,fixed:"right",align:"center",render:e=>i(j,{vertical:!1,size:5,justify:"center"},{default:()=>[i(r,{size:"small",onClick:()=>{s.push(`/user/tickets/${e.issue_no}`)}},{default:()=>w("Details")}),i(r,{disabled:"completed"===e.status,size:"small",type:"error",onClick:()=>{t.closeTicket(e.issue_no,H,N,w).finally((()=>{var e;Z.value=[],null==(e=V.value)||e.refresh()}))}},{default:()=>w("Close Ticket")})]})}],X=l(""),Y=l("sort:latest"),Z=l([]),ee=e=>{const t="all"!==J.value?`status:${J.value}`:"";return x({query:{page:e,per_page:40,q:`${X.value} ${Y.value} ${t}`.trim()}})};function te(e){var t;e.order?Y.value=`sort:${e.columnKey}:${e.order}`:Y.value="sort:latest",null==(t=V.value)||t.refresh()}function se(){var e;null==(e=V.value)||e.refresh()}return(e,t)=>(_(),o(W,{"header-title":e.$t("My Tickets"),"toggle-header":!1,"show-footer":!1},{default:c((()=>[d(z,{class:"p-4 md:p-6 lg:p-8 space-y-6"},{default:c((()=>[u("div",B,[u("div",K,[u("div",D,[u("div",E,[d(p(m),{icon:["far","life-ring"],class:"w-4 h-4 text-blue-600 dark:text-blue-400"})]),u("div",null,[u("h1",M,f(e.$t("My Tickets")),1),u("p",q,f(e.$t("Get help from our support team")),1)])]),d(p(r),{type:"primary",onClick:t[0]||(t[0]=e=>p(s).push("/user/tickets/create"))},{icon:c((()=>[d(p(m),{icon:["fas","plus"],class:"w-3.5 h-3.5"})])),default:c((()=>[k(" "+f(e.$t("Create Ticket")),1)])),_:1})])]),u("div",I,[u("div",O,[u("div",R,[u("div",S,[(_(!0),y(g,null,v([{key:"all",label:e.$t("All")},{key:"in_progress",label:e.$t("Processing")},{key:"completed",label:e.$t("Completed")}],(e=>(_(),y("button",{key:e.key,onClick:t=>function(e){var t;J.value=e,null==(t=V.value)||t.refresh()}(e.key),class:b(["px-3 py-1.5 rounded-lg text-sm font-medium transition-colors cursor-pointer",J.value===e.key?"bg-zinc-900 text-white dark:bg-zinc-100 dark:text-zinc-900":"text-zinc-500 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800"])},f(e.label),11,F)))),128))]),u("div",G,[d(p(A),{value:X.value,"onUpdate:value":t[1]||(t[1]=e=>X.value=e),placeholder:e.$t("Enter keywords to search..."),onKeyup:h(se,["enter","native"])},{prefix:c((()=>[d(p(m),{icon:["fas","magnifying-glass"],class:"w-3.5 h-3.5 text-zinc-400"})])),_:1},8,["value","placeholder"])])]),d(L,{striped:"",ref_key:"tableRef",ref:V,bordered:!1,fetch:ee,columns:Q,"row-key":e=>e.id,"checked-row-keys":Z.value,"onUpdate:checkedRowKeys":t[2]||(t[2]=e=>Z.value=e),onUpdateSorter:te},null,8,["row-key","checked-row-keys"])])])])),_:1})])),_:1},8,["header-title"]))}}),[["__scopeId","data-v-c4e17c9a"]]);export{H as default};
