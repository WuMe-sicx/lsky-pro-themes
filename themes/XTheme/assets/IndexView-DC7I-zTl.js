import{d as e,b as t,f as r,g as s,al as a,a_ as i,a$ as l,i as o,a as n,a4 as u,O as d,s as c,v as p,h as m,z as f,P as h,A as w,y as v,j as y,B as g,b0 as k}from"./index-Ctnlk-aF.js";import{_}from"./Content.vue_vue_type_script_setup_true_lang-CATP0AmL.js";import{a as x,B as b,I as C,c as T,m as j,D as A,L as q,f as P,S as $}from"./Layout-B7WTefT3.js";import{_ as z}from"./DataTable.vue_vue_type_script_setup_true_lang-BVAbYJmv.js";import{N as L,a as D}from"./ListItem-Ch4GPpL1.js";import{u as W}from"./composables-DhvgzyQS.js";import{N as B}from"./Alert-CXqSmTtF.js";import"./Checkbox-oCtQDiYY.js";import"./Ellipsis-8oa2BOhe.js";const I={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},M=[s("defs",null,null,-1),s("path",{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z",fill:"currentColor"},null,-1),s("path",{d:"M176 474h672q8 0 8 8v60q0 8-8 8H176q-8 0-8-8v-60q0-8 8-8z",fill:"currentColor"},null,-1)],O=e({name:"PlusOutlined",render:function(e,s){return r(),t("svg",I,M)}}),K=a("token",(()=>{const e=i.global.t;return{deleteToken:async function(t,r={},s){const{message:a,dialog:i}=s;return new Promise((s=>{const o=i.warning({title:e("Delete Token"),content:e("Once deleted, the login status of the client using this token will become invalid. Are you sure you want to delete it?"),positiveText:e("Confirm"),negativeText:e("Cancel"),onPositiveClick:()=>(o.loading=!0,new Promise((r=>{l({path:{id:t}}).then((()=>{a.success(e("Delete successfully")),r(!0)})).catch((()=>{a.error(e("Delete failed")),r(!1)})).finally((()=>{o.loading=!1,s(!0)}))}))),...r})}))}}})),U={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},E={class:"grow md:grow-0 md:basis-1/2"},N=e({__name:"IndexView",setup(e){const t=y(),{t:a}=o(),i=n(),l=K(),I=x(),M=W(),N=e=>j(e).format("L"),R=[{title:a("Token Name"),key:"name",minWidth:200},{title:a("Permissions"),key:"abilities",minWidth:150,render:e=>!e.abilities||Array.isArray(e.abilities)&&e.abilities.includes("*")?u(b,{type:"warning"},{default:()=>a("Full Access")}):u(C,{trigger:"hover",placement:"bottom",width:300},{trigger:()=>u(b,{type:"info"},{default:()=>u("span",{},`${e.abilities.length} ${a("Permissions")}`)}),default:()=>u(L,{hoverable:!0,bordered:!1,style:"max-height: 400px; overflow-y: auto;"},{header:()=>u("div",{class:"font-bold pb-2"},a("Granted Permissions")),default:()=>e.abilities.map((e=>u(D,{key:e},{default:()=>u("div",{class:"flex items-center gap-2"},[u(T,{size:16,color:"#18a058"},{default:()=>u("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor"},[u("path",{d:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"})])}),u("span",{},Q(e))])})))})})},{title:a("Last Used Time"),minWidth:150,key:"last_used_at",sorter:!0,align:"center",render:e=>e.last_used_at?N(e.last_used_at):"-"},{title:a("Expires Time"),minWidth:150,key:"expires_at",sorter:!0,align:"center",render:e=>e.expires_at?N(e.expires_at):"-"},{title:a("Creation Time"),minWidth:150,key:"created_at",sorter:!0,align:"center",render:e=>N(e.created_at)},{title:a("Actions"),key:"actions",minWidth:150,fixed:"right",align:"center",render:e=>u(A,{vertical:!1,size:5,justify:"center"},{default:()=>[u(d,{size:"small",type:"error",onClick:()=>{l.deleteToken(e.id,{},{message:I,dialog:M}).finally((()=>{var e;F.value=[],null==(e=i.value)||e.refresh()}))}},{default:()=>a("Delete Token")})]})}],S=n(""),V=n("sort:latest"),F=n([]),G=e=>k({query:{page:e,per_page:40,q:`${S.value} ${V.value}`.trim()}});function H(e){var t;e.order?V.value=`sort:${e.columnKey}:${e.order}`:V.value="sort:latest",null==(t=i.value)||t.refresh()}function J(){var e;null==(e=i.value)||e.refresh()}const Q=e=>({basic:"基础权限","user:profile:read":"读取用户资料","user:profile:write":"更新用户资料","user:token:read":"查看个人令牌","user:token:write":"管理个人令牌","user:group:read":"查看用户角色组","user:group:write":"管理用户角色组","user:capacity:read":"查看用户容量","user:capacity:write":"管理用户容量","user:album:read":"查看相册","user:album:write":"管理相册","user:photo:read":"查看照片","user:photo:write":"管理照片","user:share:read":"查看分享","user:share:write":"管理分享","user:ticket:read":"查看工单","user:ticket:write":"管理工单","user:order:read":"查看订单","user:order:write":"管理订单","oauth:read":"查看OAuth信息","oauth:write":"管理OAuth绑定","explore:read":"浏览探索内容","explore:write":"管理探索互动","upload:write":"上传图片"}[e]||e);return(e,a)=>(r(),c(q,{"header-title":e.$t("My Tokens"),"toggle-header":!1,"show-footer":!1},{default:p((()=>[a[3]||(a[3]=s("span",{id:"lskyv2_giopic",style:{display:"none"}},null,-1)),m(_,{class:"mx-auto p-4 md:p-10 space-y-10"},{default:p((()=>[m(f(h),null,{default:p((()=>[m(f(A),{vertical:""},{default:p((()=>[m(f(B),{type:"info","show-icon":""},{default:p((()=>[w(v(e.$t("API tokens are used to authenticate API requests. Create tokens with specific permissions to improve security. Tokens with no permissions will have full access.")),1)])),_:1}),s("div",U,[s("div",null,[m(f(d),{tertiary:"",onClick:a[0]||(a[0]=()=>{f(t).push("/user/tokens/create")})},{icon:p((()=>[m(f(T),{component:f(O)},null,8,["component"])])),default:p((()=>[w(" "+v(e.$t("Create Token")),1)])),_:1})]),s("div",E,[m(f(P),{value:S.value,"onUpdate:value":a[1]||(a[1]=e=>S.value=e),placeholder:e.$t("Enter keywords to search..."),onKeyup:g(J,["enter","native"])},{prefix:p((()=>[m(f(T),{component:f($)},null,8,["component"])])),_:1},8,["value","placeholder"])])]),m(z,{striped:"",ref_key:"tableRef",ref:i,bordered:!1,fetch:G,columns:R,"row-key":e=>e.id,"checked-row-keys":F.value,"onUpdate:checkedRowKeys":a[2]||(a[2]=e=>F.value=e),onUpdateSorter:H},null,8,["row-key","checked-row-keys"])])),_:1})])),_:1})])),_:1})])),_:1,__:[3]},8,["header-title"]))}});export{N as default};
