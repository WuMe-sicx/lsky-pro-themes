import{d as e,k as a,u as t,m as l,a as s,I as r,c as n,o,j as i,Q as u,s as d,v as c,f as p,b as v,h as m,z as y,e as g,A as b,y as f,C as h,g as _,O as k,F as w,x as $,R as x,S as z}from"./index-Ctnlk-aF.js";import{_ as q}from"./AuthFormCard.vue_vue_type_script_setup_true_lang-Cu_hDfQ0.js";import{a as S,L as j,g as C,h as U,i as P,j as L,f as R,d as A,k as N,c as E,b as F,l as I}from"./Layout-B7WTefT3.js";import{N as O}from"./Alert-CXqSmTtF.js";import{N as B}from"./Checkbox-oCtQDiYY.js";import{N as M}from"./Spin-DlOkiMFH.js";const Q={key:0,class:"h-full flex justify-center items-center"},W={class:"flex justify-between items-center mt-2 mb-2 relative z-10"},D={class:"text-sm text-zinc-500 dark:text-zinc-400"},H={key:3,class:"mt-10 mb-4"},T={class:"auth-swiss-divider-label"},V={class:"flex justify-center gap-4 mt-6"},G={class:"flex justify-between items-center mt-10 pt-6 border-t border-zinc-200 dark:border-zinc-800"},J={class:"text-sm text-zinc-500 dark:text-zinc-400"},K=["disabled"],X=e({__name:"LoginView",setup(e){var X,Y;const Z=a(),ee=t(),ae=l(),te=ee.getSelectOptionCountryCodes(),le=e=>{var a,t;return(null==(t=null==(a=e.option.label)?void 0:a.toString())?void 0:t.match(/^\+\d+/))||""},se=s(!0),re=r(),ne=i(),oe=S(),ie=s(null),ue=s({login_type:"email",username:"",password:"",remember:!1,token:(null==(Y=null==(X=re.query)?void 0:X.token)?void 0:Y.toString())||"",country_code:"cn"}),de=n((()=>{var e;return(null==(e=ee.configs)?void 0:e.site.user_login_types)||[]})),ce=async()=>{var e,a;const t=await x({body:ue.value});if("error"===(null==(e=t.data)?void 0:e.status))return oe.error(null==(a=t.data)?void 0:a.message);await pe(t.data.data.token)},pe=async e=>{ae.setToken(e),window.location.href="/user/dashboard"};return o((()=>{de.value.length>0&&(ue.value.login_type=de.value[0]),ae.isLoggedIn&&ne.push("/user/dashboard").then((()=>{Z.setSidebarOpen(!0)})),re.query.driver_id&&re.query.code?u({path:{id:re.query.driver_id.toString()},body:{code:re.query.code.toString()}}).then((e=>{var a;const t=(null==(a=e.data)?void 0:a.data.token.toString())||"";202===e.status?(ne.replace({query:{token:t}}),ue.value.token=t):pe(t)})).finally((()=>{se.value=!1})):se.value=!1})),(e,a)=>(p(),d(j,{"header-title":e.$t("Login")},{default:c((()=>[se.value?(p(),v("div",Q,[m(y(M),{size:"small",description:"loading..."})])):(p(),d(q,{key:1,title:e.$t("Welcome Back"),subtitle:e.$t("Enter your credentials to access the console")},{default:c((()=>[ue.value.token?(p(),d(y(O),{key:0,type:"info",class:"mb-6"},{default:c((()=>[b(f(e.$t("Please log in to your account. After binding, you can log in directly next time.")),1)])),_:1})):g("",!0),de.value.length>1?(p(),d(y(C),{key:1,type:"line",class:"mb-8",value:ue.value.login_type,"onUpdate:value":a[0]||(a[0]=e=>ue.value.login_type=e)},{default:c((()=>[de.value.includes("email")?(p(),d(y(U),{key:0,name:"email",tab:e.$t("Email")},null,8,["tab"])):g("",!0),de.value.includes("phone")?(p(),d(y(U),{key:1,name:"phone",tab:e.$t("Phone")},null,8,["tab"])):g("",!0),de.value.includes("username")?(p(),d(y(U),{key:2,name:"username",tab:e.$t("Username")},null,8,["tab"])):g("",!0)])),_:1},8,["value"])):g("",!0),m(y(P),{ref_key:"formRef",ref:ie,model:ue.value,"show-require-mark":!0,onSubmit:h(ce,["prevent"])},{default:c((()=>{var t,l,s,r,n;return["email"===ue.value.login_type?(p(),d(y(L),{key:0,label:e.$t("Email")},{default:c((()=>[m(y(R),{value:ue.value.username,"onUpdate:value":a[1]||(a[1]=e=>ue.value.username=e),"input-props":{type:"email",required:!0},placeholder:e.$t("Please enter your email"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"])):g("",!0),"phone"===ue.value.login_type?(p(),d(y(L),{key:1,label:e.$t("Mobile Number")},{default:c((()=>[m(y(A),null,{default:c((()=>[m(y(N),{options:y(te),"render-tag":le,"consistent-menu-width":!1,value:ue.value.country_code,"onUpdate:value":a[2]||(a[2]=e=>ue.value.country_code=e),class:"w-40",size:"large",filterable:"",placeholder:e.$t("Select Country")},null,8,["options","value","placeholder"]),m(y(R),{value:ue.value.username,"onUpdate:value":a[3]||(a[3]=e=>ue.value.username=e),placeholder:e.$t("Please enter your mobile number"),"input-props":{required:!0},size:"large"},null,8,["value","placeholder"])])),_:1})])),_:1},8,["label"])):g("",!0),"username"===ue.value.login_type?(p(),d(y(L),{key:2,label:e.$t("Username")},{default:c((()=>[m(y(R),{value:ue.value.username,"onUpdate:value":a[4]||(a[4]=e=>ue.value.username=e),"input-props":{required:!0},placeholder:e.$t("Please enter your username"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"])):g("",!0),m(y(L),{label:e.$t("Password"),"show-feedback":!1},{default:c((()=>[m(y(R),{value:ue.value.password,"onUpdate:value":a[5]||(a[5]=e=>ue.value.password=e),placeholder:e.$t("Please enter your password"),type:"password","show-password-on":"mousedown",size:"large","input-props":{required:!0}},null,8,["value","placeholder"])])),_:1},8,["label"]),_("div",W,[m(y(B),{checked:ue.value.remember,"onUpdate:checked":a[6]||(a[6]=e=>ue.value.remember=e)},{default:c((()=>[_("span",D,f(e.$t("Remember Me")),1)])),_:1},8,["checked"]),_("button",{type:"button",class:"auth-swiss-link text-xs text-zinc-400 dark:text-zinc-500",onClick:a[7]||(a[7]=e=>y(ne).push("/forget-password"))},f(e.$t("Forgot Password?")),1)]),m(y(L),{class:"mt-8"},{default:c((()=>[m(y(k),{type:"primary","attr-type":"submit",size:"large",strong:"",block:""},{default:c((()=>[b(f(e.$t("Login")),1)])),_:1})])),_:1}),!ue.value.token&&((null==(t=y(ee).configs)?void 0:t.app.socialites)||[]).length>0?(p(),v("div",H,[_("div",T,[_("span",null,f(e.$t("or")),1)]),_("div",V,[(p(!0),v(w,null,$((null==(l=y(ee).configs)?void 0:l.app.socialites)||[],(e=>(p(),d(y(k),{onClick:a=>(async e=>{var a,t;const l=await z({path:{id:e.id.toString()},query:{redirect_url:`${F.getWithoutQueryUrl()}?driver_id=${e.id}`}});if("error"===(null==(a=l.data)?void 0:a.status))return oe.error(null==(t=l.data)?void 0:t.message);window.location.replace(l.data.data.redirect_url)})(e),secondary:"",size:"large",class:"flex-1"},{icon:c((()=>[m(y(E),{component:y(F).getSocialiteIcon(e.provider)},null,8,["component"])])),default:c((()=>[b(" "+f(e.name),1)])),_:2},1032,["onClick"])))),256))])])):g("",!0),_("div",G,[_("button",{type:"button",class:"auth-swiss-link text-sm",onClick:a[8]||(a[8]=e=>y(ne).push("/"))},f(e.$t("Back to Home")),1),m(y(I),{trigger:"hover",disabled:(null==(s=y(ee).configs)?void 0:s.app.enable_registration)&&((null==(r=y(ee).configs)?void 0:r.app.user_email_verify)||(null==(n=y(ee).configs)?void 0:n.app.user_phone_verify))},{trigger:c((()=>{var t,l,s;return[_("span",J,[b(f(e.$t("Don't have an account?"))+" ",1),_("button",{type:"button",class:"auth-swiss-link text-sm ml-1",onClick:a[9]||(a[9]=e=>y(ne).push({path:"/register",query:{token:ue.value.token||void 0}})),disabled:!(null==(t=y(ee).configs)?void 0:t.app.enable_registration)||!(null==(l=y(ee).configs)?void 0:l.app.user_email_verify)&&!(null==(s=y(ee).configs)?void 0:s.app.user_phone_verify)},f(e.$t("Register")),9,K)])]})),default:c((()=>[b(" "+f(e.$t("Registration is currently closed")),1)])),_:1},8,["disabled"])])]})),_:1},8,["model"])])),_:1},8,["title","subtitle"]))])),_:1},8,["header-title"]))}});export{X as default};
