import{aJ as e,bw as s,d as l,a4 as a,bx as t,bc as i,aN as r,aO as n,by as o,b3 as d,c as u,aR as c,aV as p,aW as v,aL as m,F as f,bz as h,i as b,a as g,s as y,f as x,v as _,b as w,e as k,h as C,y as P,z as $,x as z,g as j,A,O as G,C as O,P as T,_ as D,o as R,a7 as B,bA as S,E,j as V,bB as H}from"./index-Ctnlk-aF.js";import{a1 as N,I,c as M,B as F,a2 as L,a as U,L as q,D as J,i as W,j as K,f as Q,q as X,s as Y}from"./Layout-B7WTefT3.js";import{_ as Z}from"./Content.vue_vue_type_script_setup_true_lang-CATP0AmL.js";import{_ as ee}from"./Back.vue_vue_type_script_setup_true_lang-sCWvZjrO.js";import{N as se,a as le}from"./CollapseItem-BTCbNBkY.js";import{N as ae,a as te}from"./ListItem-Ch4GPpL1.js";import{N as ie}from"./Checkbox-oCtQDiYY.js";import{N as re}from"./Alert-CXqSmTtF.js";const ne=e("collapse-transition",{width:"100%"},[s()]),oe=l({name:"CollapseTransition",props:Object.assign(Object.assign({},n.props),{show:{type:Boolean,default:!0},appear:Boolean,collapsed:{type:Boolean,default:void 0}}),inheritAttrs:!1,setup(e){const{mergedClsPrefixRef:s,inlineThemeDisabled:l,mergedRtlRef:a}=r(e),t=n("CollapseTransition","-collapse-transition",ne,o,e,s),i=d("CollapseTransition",a,s),p=u((()=>void 0!==e.collapsed?e.collapsed:e.show)),v=u((()=>{const{self:{bezier:e}}=t.value;return{"--n-bezier":e}})),m=l?c("collapse-transition",void 0,v,e):void 0;return{rtlEnabled:i,mergedShow:p,mergedClsPrefix:s,cssVars:l?void 0:v,themeClass:null==m?void 0:m.themeClass,onRender:null==m?void 0:m.onRender}},render(){return a(t,{appear:this.appear},{default:()=>{var e;if(this.mergedShow)return null===(e=this.onRender)||void 0===e||e.call(this),a("div",i({class:[`${this.mergedClsPrefix}-collapse-transition`,this.rtlEnabled&&`${this.mergedClsPrefix}-collapse-transition--rtl`,this.themeClass],style:this.cssVars},this.$attrs),this.$slots)}})}}),de=e("divider","\n position: relative;\n display: flex;\n width: 100%;\n box-sizing: border-box;\n font-size: 16px;\n color: var(--n-text-color);\n transition:\n color .3s var(--n-bezier),\n background-color .3s var(--n-bezier);\n",[p("vertical","\n margin-top: 24px;\n margin-bottom: 24px;\n ",[p("no-title","\n display: flex;\n align-items: center;\n ")]),v("title","\n display: flex;\n align-items: center;\n margin-left: 12px;\n margin-right: 12px;\n white-space: nowrap;\n font-weight: var(--n-font-weight);\n "),m("title-position-left",[v("line",[m("left",{width:"28px"})])]),m("title-position-right",[v("line",[m("right",{width:"28px"})])]),m("dashed",[v("line","\n background-color: #0000;\n height: 0px;\n width: 100%;\n border-style: dashed;\n border-width: 1px 0 0;\n ")]),m("vertical","\n display: inline-block;\n height: 1em;\n margin: 0 8px;\n vertical-align: middle;\n width: 1px;\n "),v("line","\n border: none;\n transition: background-color .3s var(--n-bezier), border-color .3s var(--n-bezier);\n height: 1px;\n width: 100%;\n margin: 0;\n "),p("dashed",[v("line",{backgroundColor:"var(--n-color)"})]),m("dashed",[v("line",{borderColor:"var(--n-color)"})]),m("vertical",{backgroundColor:"var(--n-color)"})]),ue=l({name:"Divider",props:Object.assign(Object.assign({},n.props),{titlePlacement:{type:String,default:"center"},dashed:Boolean,vertical:Boolean}),setup(e){const{mergedClsPrefixRef:s,inlineThemeDisabled:l}=r(e),a=n("Divider","-divider",de,h,e,s),t=u((()=>{const{common:{cubicBezierEaseInOut:e},self:{color:s,textColor:l,fontWeight:t}}=a.value;return{"--n-bezier":e,"--n-color":s,"--n-text-color":l,"--n-font-weight":t}})),i=l?c("divider",void 0,t,e):void 0;return{mergedClsPrefix:s,cssVars:l?void 0:t,themeClass:null==i?void 0:i.themeClass,onRender:null==i?void 0:i.onRender}},render(){var e;const{$slots:s,titlePlacement:l,vertical:t,dashed:i,cssVars:r,mergedClsPrefix:n}=this;return null===(e=this.onRender)||void 0===e||e.call(this),a("div",{role:"separator",class:[`${n}-divider`,this.themeClass,{[`${n}-divider--vertical`]:t,[`${n}-divider--no-title`]:!s.default,[`${n}-divider--dashed`]:i,[`${n}-divider--title-position-${l}`]:s.default&&l}],style:r},t?null:a("div",{class:`${n}-divider__line ${n}-divider__line--left`}),!t&&s.default?a(f,null,a("div",{class:`${n}-divider__title`},this.$slots),a("div",{class:`${n}-divider__line ${n}-divider__line--right`})):null)}}),ce={class:"flex gap-2 items-center"},pe={class:"flex gap-1"},ve={key:0,class:"text-sm text-gray-500 mb-3"},me={class:"flex items-center justify-between"},fe=["onClick"],he={class:"flex items-center justify-between"},be=["onClick"],ge={key:0,class:"mt-4 px-2"},ye={class:"space-y-2"},xe={class:"font-medium"},_e={class:"text-sm text-gray-500 mt-1"},we=D(l({__name:"PermissionCard",props:{title:{},description:{},permissions:{},selectedPermissions:{},subGroups:{}},emits:["update:selectedPermissions"],setup(e,{emit:s}){const{t:l}=b(),a=e,t=s;g(!0);const i=g(!1),r=u((()=>a.permissions.every((e=>a.selectedPermissions.includes(e.value))))),n=u((()=>a.permissions.some((e=>a.selectedPermissions.includes(e.value)))&&!r.value)),o=u((()=>a.permissions.filter((e=>a.selectedPermissions.includes(e.value))).length)),d=e=>{const s=[...a.selectedPermissions],l=s.indexOf(e);-1===l?s.push(e):s.splice(l,1),t("update:selectedPermissions",s)},c=()=>{const e=[...a.selectedPermissions];a.permissions.forEach((s=>{e.includes(s.value)||e.push(s.value)})),t("update:selectedPermissions",e)},p=()=>{const e=a.permissions.map((e=>e.value)),s=a.selectedPermissions.filter((s=>!e.includes(s)));t("update:selectedPermissions",s)},v=()=>{i.value=!i.value},m=e=>{if(!a.subGroups||!a.subGroups[e])return!1;return a.subGroups[e].permissions.map((e=>e.value)).every((e=>a.selectedPermissions.includes(e)))},h=e=>{if(!a.subGroups||!a.subGroups[e])return!1;return a.subGroups[e].permissions.map((e=>e.value)).some((e=>a.selectedPermissions.includes(e)))&&!m(e)};return(e,s)=>(x(),y($(T),{title:e.title,class:"permission-card mb-4",size:"small",bordered:!0,segmented:{content:!0,footer:"soft"}},{"header-extra":_((()=>[j("div",ce,[C($(L),{value:o.value,max:99,"show-zero":!1,offset:[2,2]},{default:_((()=>[C($(F),{type:r.value?"success":n.value?"warning":"default",size:"small",bordered:!1},{default:_((()=>[A(P(r.value?$(l)("All Selected"):n.value?$(l)("Partially Selected"):$(l)("None Selected")),1)])),_:1},8,["type"])])),_:1},8,["value"]),j("div",pe,[C($(G),{size:"tiny",onClick:c,type:"primary",secondary:""},{default:_((()=>[A(P($(l)("Select All")),1)])),_:1}),C($(G),{size:"tiny",onClick:p,secondary:""},{default:_((()=>[A(P($(l)("Cancel")),1)])),_:1}),C($(G),{size:"tiny",onClick:v,tertiary:""},{default:_((()=>[A(P(i.value?$(l)("Hide Details"):$(l)("Show Details")),1)])),_:1})])])])),default:_((()=>[e.description?(x(),w("div",ve,P(e.description),1)):k("",!0),e.subGroups&&Object.keys(e.subGroups).length>0?(x(),y($(se),{key:1,class:"mb-2"},{default:_((()=>[(x(!0),w(f,null,z(e.subGroups,((i,r)=>(x(),y($(le),{key:r,title:i.name},{"header-extra":_((()=>[j("div",{class:"flex gap-1 mr-2",onClick:s[0]||(s[0]=O((()=>{}),["stop"]))},[C($(G),{size:"tiny",onClick:e=>(e=>{if(!a.subGroups||!a.subGroups[e])return;const s=[...a.selectedPermissions];a.subGroups[e].permissions.forEach((e=>{s.includes(e.value)||s.push(e.value)})),t("update:selectedPermissions",s)})(r),type:"primary",secondary:"",disabled:m(r)},{default:_((()=>[A(P($(l)("Select All")),1)])),_:2},1032,["onClick","disabled"]),C($(G),{size:"tiny",onClick:e=>(e=>{if(!a.subGroups||!a.subGroups[e])return;const s=a.subGroups[e].permissions.map((e=>e.value)),l=a.selectedPermissions.filter((e=>!s.includes(e)));t("update:selectedPermissions",l)})(r),secondary:"",disabled:!h(r)&&!m(r)},{default:_((()=>[A(P($(l)("Cancel")),1)])),_:2},1032,["onClick","disabled"])])])),default:_((()=>[C($(ae),{hoverable:""},{default:_((()=>[(x(!0),w(f,null,z(i.permissions,(l=>(x(),y($(te),{key:l.value},{default:_((()=>[j("div",me,[j("div",{class:"flex items-center gap-2 flex-1 cursor-pointer",onClick:e=>d(l.value)},[C($(ie),{checked:e.selectedPermissions.includes(l.value)},null,8,["checked"]),C($(N),{type:e.selectedPermissions.includes(l.value)?"primary":void 0},{default:_((()=>[A(P(l.label),1)])),_:2},1032,["type"])],8,fe),l.detail?(x(),y($(I),{key:0,trigger:"hover",placement:"top"},{trigger:_((()=>[C($(M),{class:"cursor-help text-gray-400 hover:text-primary"},{default:_((()=>s[1]||(s[1]=[j("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"1em",height:"1em"},[j("path",{fill:"currentColor",d:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"})],-1)]))),_:1,__:[1]})])),default:_((()=>[A(" "+P(l.detail),1)])),_:2},1024)):k("",!0)])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1032,["title"])))),128))])),_:1})):(x(),y($(ae),{key:2,hoverable:""},{default:_((()=>[(x(!0),w(f,null,z(e.permissions,(l=>(x(),y($(te),{key:l.value},{default:_((()=>[j("div",he,[j("div",{class:"flex items-center gap-2 flex-1 cursor-pointer",onClick:e=>d(l.value)},[C($(ie),{checked:e.selectedPermissions.includes(l.value)},null,8,["checked"]),C($(N),{type:e.selectedPermissions.includes(l.value)?"primary":void 0},{default:_((()=>[A(P(l.label),1)])),_:2},1032,["type"])],8,be),l.detail?(x(),y($(I),{key:0,trigger:"hover",placement:"top"},{trigger:_((()=>[C($(M),{class:"cursor-help text-gray-400 hover:text-primary"},{default:_((()=>s[2]||(s[2]=[j("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"1em",height:"1em"},[j("path",{fill:"currentColor",d:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"})],-1)]))),_:1,__:[2]})])),default:_((()=>[A(" "+P(l.detail),1)])),_:2},1024)):k("",!0)])])),_:2},1024)))),128))])),_:1})),C($(oe),null,{default:_((()=>[i.value?(x(),w("div",ge,[C($(ue),null,{default:_((()=>[A(P($(l)("Permission Details")),1)])),_:1}),j("div",ye,[(x(!0),w(f,null,z(e.permissions,(e=>(x(),w("div",{key:`detail-${e.value}`,class:"p-2 rounded hover:bg-gray-50"},[j("div",xe,[A(P(e.label)+" ",1),C($(F),{size:"small"},{default:_((()=>[A(P(e.value),1)])),_:2},1024)]),j("div",_e,P(e.detail),1)])))),128))])])):k("",!0)])),_:1})])),_:1},8,["title"]))}}),[["__scopeId","data-v-fd9fae23"]]),ke={class:"space-x-2"},Ce={class:"flex flex-col gap-4"},Pe={class:"flex justify-between items-center mb-2 flex-wrap gap-2"},$e={class:"flex gap-2"},ze={class:"flex flex-col space-y-4"},je={class:"flex justify-between space-x-2"},Ae=D(l({__name:"CreateView",setup(e){const s=U(),l=V(),{t:a}=b(),t=g(!1),i=g({abilities:[]}),r=g(null),n=g(!1),o=g(""),d=g([]),u=g({}),c=g({}),p=g({}),v={name:{type:"string",required:!0,trigger:["blur","input"],message:a("Please enter the token name")},expires_at:{type:"string",required:!1,trigger:["blur","input"],message:a("Please select the token expiration time")}},m=()=>{i.value.abilities=d.value.map((e=>e.value))},h=()=>{i.value.abilities=[]},y=e=>p.value&&p.value[e]&&Object.keys(p.value[e]).length>0,k=e=>{var s;return(null==(s=p.value)?void 0:s[e])||{}},D=e=>({user:"用户资料、令牌、角色组和容量等用户相关权限",content:"相册、照片、分享和图片上传等内容管理权限",service:"工单和订单等服务相关权限",integration:"OAuth绑定和内容探索等集成功能权限",basic:"基础功能权限，所有令牌默认拥有",oauth:"OAuth第三方账号绑定相关权限",explore:"内容探索和浏览相关权限",upload:"图片上传相关权限"}[e]||""),I=async e=>{var l;e.preventDefault(),null==(l=r.value)||l.validate((async e=>{var l,r,d,u,c;if(!e){t.value=!0;try{const e=Array.isArray(i.value.abilities)&&i.value.abilities.length>0?[...i.value.abilities]:["*"],a={name:i.value.name,abilities:e};i.value.expires_at&&(a.expires_at=i.value.expires_at);const t=new FormData;t.append("name",a.name),a.expires_at&&t.append("expires_at",a.expires_at);for(const s of a.abilities)t.append("abilities[]",s);const u=await H({body:t});if("error"===(null==(l=u.data)?void 0:l.status))return s.error(null==(r=u.data)?void 0:r.message);o.value=(null==(d=u.data)?void 0:d.data.token)||"",n.value=!0}catch(p){s.error((null==(c=null==(u=p.response)?void 0:u.data)?void 0:c.message)||a("Failed to create token"))}finally{t.value=!1}}}))},M=()=>{n.value=!1,l.push("/user/tokens")},F=()=>{Y.copyText(o.value).then((()=>{s.success(a("Copy successful")),setTimeout((()=>{l.push("/user/tokens")}),500)})).catch((()=>{s.error(a("Copy failed"))}))};return R((()=>{(async()=>{var e,l,t,i,r;try{const s=await S();if("success"===(null==(e=s.data)?void 0:e.status)){const e=(null==(t=null==(l=s.data)?void 0:l.data)?void 0:t.permissions)||[],a=(null==(r=null==(i=s.data)?void 0:i.data)?void 0:r.groups)||{};d.value=e,c.value=a;const n={};e.forEach((e=>{const s=e.category||e.value.split(":")[0];n[s]||(n[s]=[]),n[s].push(e)})),u.value=n;const o={};Object.entries(a).forEach((([s,l])=>{o[s]={},Object.entries(l).forEach((([l,a])=>{const t=a.map((s=>e.find((e=>e.value===s)))).filter((e=>void 0!==e));t.length>0&&(o[s][l]={name:l,permissions:t})}))})),p.value=o}}catch(n){s.error(a("Failed to get permissions"))}})()})),(e,s)=>(x(),w(f,null,[C(q,{"header-title":e.$t("Create Token"),"toggle-header":!1,"show-footer":!1},{default:_((()=>[C(Z,{class:"mx-auto p-4 md:p-10 space-y-10 overflow-hidden"},{default:_((()=>[C($(J),{vertical:""},{default:_((()=>[j("div",ke,[C(ee,{to:"/user/tokens"})]),C($(T),null,{default:_((()=>[C($(W),{ref_key:"formRef",ref:r,"label-placement":"left","label-width":200,"label-align":"left",model:i.value,rules:v,onSubmit:O(I,["prevent"]),class:"form-container"},{default:_((()=>[C($(K),{label:e.$t("Token Name"),path:"name"},{default:_((()=>[C($(Q),{value:i.value.name,"onUpdate:value":s[0]||(s[0]=e=>i.value.name=e),maxlength:20,placeholder:e.$t("Please enter the token name")},null,8,["value","placeholder"])])),_:1},8,["label"]),C($(K),{label:e.$t("Token Expires Time"),path:"expires_at"},{default:_((()=>[C($(X),{"formatted-value":i.value.expires_at,"onUpdate:formattedValue":s[1]||(s[1]=e=>i.value.expires_at=e),type:"datetime",class:"w-full","is-date-disabled":e=>e<Date.now(),"value-format":"yyyy-MM-dd HH:mm:ss",clearable:"",placeholder:e.$t("Please select the token expiration time")},null,8,["formatted-value","is-date-disabled","placeholder"])])),_:1},8,["label"]),C($(K),{label:e.$t("Token Permissions"),path:"abilities"},{default:_((()=>[j("div",Ce,[C($(re),{type:"info","show-icon":""},{default:_((()=>[A(P(e.$t("The token created without choosing any permissions will have full access rights. Please select the permissions carefully based on your needs.")),1)])),_:1}),j("div",Pe,[C($(N),null,{default:_((()=>[A(P(e.$t("Permissions")),1)])),_:1}),j("div",$e,[C($(G),{size:"small",onClick:m},{default:_((()=>[A(P(e.$t("Select All")),1)])),_:1}),C($(G),{size:"small",onClick:h},{default:_((()=>[A(P(e.$t("Deselect All")),1)])),_:1})])]),C($(J),{vertical:""},{default:_((()=>[(x(!0),w(f,null,z(u.value,((e,l)=>{return x(),w("div",{key:l},[C(we,{title:(a=l,{user:"用户管理",content:"内容管理",service:"服务管理",integration:"集成功能",basic:"基础功能",oauth:"OAuth认证",explore:"探索功能",upload:"上传功能"}[a]||a),description:D(l),permissions:e,"selected-permissions":i.value.abilities,"sub-groups":y(l)?k(l):void 0,"onUpdate:selectedPermissions":s[2]||(s[2]=e=>i.value.abilities=e)},null,8,["title","description","permissions","selected-permissions","sub-groups"])]);var a})),128)),C($(re),{type:"info",class:"mt-4"},{default:_((()=>[A(P(e.$t("Permission Principle")),1)])),_:1})])),_:1})])])),_:1},8,["label"]),C($(K),{class:"flex justify-end"},{default:_((()=>[C($(G),{"attr-type":"submit",type:"primary",loading:t.value},{default:_((()=>[A(P(e.$t("Confirm Creation")),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])),_:1})])),_:1},8,["header-title"]),C($(B),{show:n.value,"onUpdate:show":s[3]||(s[3]=e=>n.value=e),preset:"card",title:e.$t("Created successfully"),size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto max-h-[90vh] overflow-auto"},{action:_((()=>[j("div",je,[C($(G),{tertiary:"",onClick:M},{default:_((()=>[A(P(e.$t("Close")),1)])),_:1}),C($(G),{tertiary:"",type:"primary",class:"shrink-0",onClick:F},{icon:_((()=>[C($(E),{icon:"fa-solid fa-copy"})])),_:1})])])),default:_((()=>[j("div",ze,[C($(re),{type:"warning","show-icon":""},{default:_((()=>[A(P(e.$t("Please keep it safe. This Token will no longer be displayed after the window is closed.")),1)])),_:1}),C($(Q),{class:"select-all",value:o.value,readonly:""},null,8,["value"])])])),_:1},8,["show","title"])],64))}}),[["__scopeId","data-v-457aaef6"]]);export{Ae as default};
