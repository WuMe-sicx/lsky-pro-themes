import{d as e,bV as a,aw as l,i as t,a as u,c as r,o as i,s,z as o,v as d,g as n,h as c,D as v,n as p,b as f,O as h,A as m,y,bW as b,f as g,J as k,a8 as z,Y as C,e as V,F as S,bU as _,u as w,bR as $}from"./index-Ctnlk-aF.js";import{a as q,d as x,f as I,j as M,k as U}from"./Layout-B7WTefT3.js";const P={class:"flex items-center w-full"},E=["src"],K=e({__name:"CaptchaInput",props:a({disabled:{type:Boolean,default:!1},size:{type:String,default:()=>"medium"}},{captcha:{default:""},captchaModifiers:{},captchaKey:{default:""},captchaKeyModifiers:{}}),emits:["update:captcha","update:captchaKey"],setup(e){const a=e,k=l(e,"captcha"),z=l(e,"captchaKey"),{t:C}=t(),V=q(),S=u(""),_=u(!1),w=u(!1),$=u(0),M=r((()=>{switch(a.size){case"small":return"28px";case"large":return"40px";default:return"34px"}})),U=async(e=!1)=>{try{_.value=!0,w.value=!1,e||($.value=0);const l=(await b()).data;if(!(l&&l.data&&l.data.img))throw new Error("Invalid response structure");{const e=(a=l.data.img)?a.startsWith("data:image/")?a:`data:image/png;base64,${a}`:"";S.value=e,z.value=l.data.key,k.value="",$.value=0}}catch(l){if($.value<3&&!e)return $.value++,void setTimeout((()=>U(!0)),1e3);w.value=!0,V.error(C("Failed to load captcha"))}finally{_.value=!1}var a},K=()=>{w.value=!1},B=()=>{V.error(C("Failed to load captcha image")),S.value="",w.value=!0};return i((()=>{U()})),(e,l)=>(g(),s(o(x),null,{default:d((()=>[n("div",P,[c(o(I),{value:k.value,"onUpdate:value":l[0]||(l[0]=e=>k.value=e),placeholder:e.$t("Please enter captcha"),disabled:a.disabled,size:a.size,class:"flex-1"},null,8,["value","placeholder","disabled","size"]),n("div",{class:p(["ml-2 flex items-center cursor-pointer",{"opacity-50":_.value}]),onClick:l[2]||(l[2]=()=>U(!1)),style:v({height:M.value})},[S.value?(g(),f("div",{key:0,class:"overflow-hidden rounded-md border border-[#d9d9d9] dark:border-[#383838] h-full bg-gray-50 dark:bg-gray-800",style:v({minHeight:M.value,minWidth:"80px"})},[n("img",{src:S.value,alt:"captcha",class:"h-full w-full object-contain",style:v({maxHeight:M.value,minHeight:M.value,display:"block"}),onLoad:K,onError:B,loading:"eager"},null,44,E)],4)):(g(),s(o(h),{key:1,onClick:l[1]||(l[1]=()=>U(!1)),loading:_.value,size:a.size,class:"h-full"},{default:d((()=>[m(y(w.value||$.value>0?e.$t("Retry"):e.$t("Load Captcha")),1)])),_:1},8,["loading","size"]))],6)])])),_:1}))}}),B=e({__name:"EmailVerifyInput",props:a({event:{type:String,required:!0},size:{type:String,default:()=>"medium"},modelValue:{type:String,default:void 0},disabled:{type:Boolean,default:!1},requireVerify:{type:Boolean,default:!0}},{email:{default:""},emailModifiers:{},code:{default:""},codeModifiers:{}}),emits:["update:email","update:code"],setup(e){const a=e,i=l(e,"email"),n=l(e,"code"),v=u(""),p=u("");k((()=>a.modelValue),(e=>{e&&e!==i.value&&(i.value=e)}),{immediate:!0});const{t:b}=t(),w=q(),$=u(b("Send Email Verification Code")),U=u(!1),P=r((()=>a.modelValue&&a.modelValue.length>0||i.value.length>0));let E=null;z((()=>{E&&(clearInterval(E),E=null)}));const B=async()=>{var e;const l=a.modelValue||i.value.toString();if(!P.value)return w.error(b("Please enter your email first"));if(!v.value)return w.error(b("Please enter captcha"));if(!p.value)return w.error(b("Captcha key is missing, please refresh the captcha"));const t=await _({body:{event:a.event,email:l,captcha:v.value,captcha_key:p.value}});"success"===(null==(e=t.data)?void 0:e.status)?(()=>{let e=60;U.value=!0,E&&clearInterval(E),E=setInterval((()=>{e--,$.value=b("Resend after {seconds} seconds",{seconds:e}),e<=0&&(U.value=!1,$.value=b("Send Email Verification Code"),clearInterval(E),E=null)}),1e3)})():w.error(t.data.message)};return(l,t)=>a.disabled?C(l.$slots,"default",{key:0,sendVerifyCode:B,btnDisabled:U.value,btnText:$.value}):(g(),f(S,{key:1},[c(o(M),{label:l.$t("Email"),"show-require-mark":""},{default:d((()=>[c(o(x),null,{default:d((()=>[c(o(I),{value:i.value,"onUpdate:value":t[0]||(t[0]=e=>i.value=e),"input-props":{type:"email",required:!0},placeholder:l.$t("Please enter your email"),size:a.size},null,8,["value","placeholder","size"])])),_:1})])),_:1},8,["label"]),e.requireVerify?(g(),f(S,{key:0},[P.value?(g(),s(o(M),{key:0,label:l.$t("Captcha"),"show-require-mark":""},{default:d((()=>[c(K,{captcha:v.value,"onUpdate:captcha":t[1]||(t[1]=e=>v.value=e),"captcha-key":p.value,"onUpdate:captchaKey":t[2]||(t[2]=e=>p.value=e),size:a.size},null,8,["captcha","captcha-key","size"])])),_:1},8,["label"])):V("",!0),v.value?(g(),s(o(M),{key:1,label:l.$t("Email Verification Code"),"show-require-mark":""},{default:d((()=>[c(o(I),{value:n.value,"onUpdate:value":t[3]||(t[3]=e=>n.value=e),"input-props":{required:!0},placeholder:l.$t("Please enter the email verification code"),size:a.size},{suffix:d((()=>[c(o(h),{text:"",type:"info",onClick:B,disabled:U.value||!a.modelValue&&!i.value||P.value&&!v.value},{default:d((()=>[m(y($.value),1)])),_:1},8,["disabled"])])),_:1},8,["value","placeholder","size"])])),_:1},8,["label"])):V("",!0)],64)):V("",!0)],64))}}),j=e({__name:"PhoneVerifyInput",props:a({event:{type:String,required:!0},size:{type:String,default:()=>"medium"},modelValue:{type:String,default:void 0},modelValueCountryCode:{type:String,default:void 0},disabled:{type:Boolean,default:!1},requireVerify:{type:Boolean,default:!0}},{countryCode:{default:"cn"},countryCodeModifiers:{},phone:{default:""},phoneModifiers:{},code:{default:""},codeModifiers:{}}),emits:["update:countryCode","update:phone","update:code"],setup(e){const a=e,i=l(e,"countryCode"),n=l(e,"phone"),v=l(e,"code"),p=u(""),b=u("");k((()=>a.modelValue),(e=>{e&&e!==n.value&&(n.value=e)}),{immediate:!0}),k((()=>a.modelValueCountryCode),(e=>{e&&e!==i.value&&(i.value=e)}),{immediate:!0});const{t:_}=t(),P=q(),E=w(),B=u(_("Send SMS Verification Code")),j=u(!1),R=r((()=>a.modelValue&&a.modelValue.length>0||n.value.length>0)),D=E.getSelectOptionCountryCodes(),F=e=>{var a,l;return(null==(l=null==(a=e.option.label)?void 0:a.toString())?void 0:l.match(/^\+\d+/))||""};let H=null;z((()=>{H&&(clearInterval(H),H=null)}));const L=async()=>{var e;const l=a.modelValue||n.value.toString(),t=a.modelValueCountryCode||i.value.toString();if(!R.value)return P.error(_("Please enter your mobile number first"));if(!p.value)return P.error(_("Please enter captcha"));if(!b.value)return P.error(_("Captcha key is missing, please refresh the captcha"));const u=await $({body:{event:a.event,country_code:t,phone:l,captcha:p.value,captcha_key:b.value}});"success"===(null==(e=u.data)?void 0:e.status)?(()=>{let e=60;j.value=!0,H&&clearInterval(H),H=setInterval((()=>{e--,B.value=_("Resend after {seconds} seconds",{seconds:e}),e<=0&&(j.value=!1,B.value=_("Send SMS Verification Code"),clearInterval(H),H=null)}),1e3)})():P.error(u.data.message)};return(l,t)=>a.disabled?C(l.$slots,"default",{key:0,sendVerifyCode:L,btnDisabled:j.value,btnText:B.value}):(g(),f(S,{key:1},[c(o(M),{label:l.$t("Mobile Number"),"show-require-mark":""},{default:d((()=>[c(o(x),null,{default:d((()=>[c(o(U),{options:o(D),"render-tag":F,"consistent-menu-width":!1,value:i.value,"onUpdate:value":t[0]||(t[0]=e=>i.value=e),class:"w-40",size:a.size,filterable:"",placeholder:l.$t("Select Country")},null,8,["options","value","size","placeholder"]),c(o(I),{value:n.value,"onUpdate:value":t[1]||(t[1]=e=>n.value=e),placeholder:l.$t("Please enter your mobile number"),"input-props":{required:!0},size:a.size},null,8,["value","placeholder","size"])])),_:1})])),_:1},8,["label"]),e.requireVerify?(g(),f(S,{key:0},[R.value?(g(),s(o(M),{key:0,label:l.$t("Captcha"),"show-require-mark":""},{default:d((()=>[c(K,{captcha:p.value,"onUpdate:captcha":t[2]||(t[2]=e=>p.value=e),"captcha-key":b.value,"onUpdate:captchaKey":t[3]||(t[3]=e=>b.value=e),size:a.size},null,8,["captcha","captcha-key","size"])])),_:1},8,["label"])):V("",!0),p.value?(g(),s(o(M),{key:1,label:l.$t("SMS Verification Code"),"show-require-mark":""},{default:d((()=>[c(o(I),{value:v.value,"onUpdate:value":t[4]||(t[4]=e=>v.value=e),"input-props":{required:!0},placeholder:l.$t("Please enter the SMS verification code"),size:a.size},{suffix:d((()=>[c(o(h),{text:"",type:"info",onClick:L,disabled:j.value||!a.modelValue&&!n.value||R.value&&!p.value},{default:d((()=>[m(y(B.value),1)])),_:1},8,["disabled"])])),_:1},8,["value","placeholder","size"])])),_:1},8,["label"])):V("",!0)],64)):V("",!0)],64))}});export{B as _,j as a,K as b};
