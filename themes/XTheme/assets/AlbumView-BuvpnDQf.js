import{d as a,u as l,j as e,a as t,o as s,b as o,h as u,v as r,F as i,cj as n,I as d,ck as v,f as m,g as c,y as p,z as f,O as g,A as h}from"./index-Ctnlk-aF.js";import{_,E as x}from"./ExploreImage-DuMNEv2N.js";import{W as y}from"./WaterfallLayout-Cc-Ll5Bs.js";import{_ as w}from"./Content.vue_vue_type_script_setup_true_lang-CATP0AmL.js";import{a as b,L as j,N as k,b as A}from"./Layout-B7WTefT3.js";const z={class:"w-full"},L={class:"container mx-auto p-4 sm:p-8"},N={class:"flex flex-col sm:flex-row sm:justify-between mb-10 w-full"},$={class:"flex flex-col"},q={class:"text-2xl mb-4 font-bold"},C={class:"flex items-center w-full"},E={class:"flex flex-col ml-2 w-full overflow-hidden"},H={class:"mt-4"},I={class:"flex justify-end mt-2 sm:mt-0"},R={class:"my-4"},T={style:{"padding-left":"6px","padding-right":"6px"}},W=a({__name:"AlbumView",setup(a){var W,D;const F=d(),O=e(),U=b(),V=l();V.configs&&!(null==(D=null==(W=V.configs)?void 0:W.app)?void 0:D.enable_explore)&&O.replace("/404");const B=t(null),G=t({}),J=t(0),K=t([]),M=t(""),P=t(1),Q=t(!1),S=t(!1);async function X(a={}){var l,e,t,s,o,u,r,i,d;if(!Q.value&&!S.value){Q.value=!0;try{const m=await n({path:{id:Number(F.params.id)}});if("error"===(null==(l=m.data)?void 0:l.status))return U.error(null==(e=m.data)?void 0:e.message),void(Q.value=!1);G.value=null==(t=m.data)?void 0:t.data;const c=await v({path:{id:Number(F.params.id)},query:{q:M.value,page:P.value,per_page:20,...a}});if("error"===(null==(s=c.data)?void 0:s.status))return U.error(null==(o=c.data)?void 0:o.message),void(Q.value=!1);const p=(null==(u=c.data)?void 0:u.data.data)||[];K.value.push(...p),J.value=(null==(r=c.data)?void 0:r.data.meta.total)||0,S.value=(null==(i=c.data)?void 0:i.data.meta.last_page)===(null==(d=c.data)?void 0:d.data.meta.current_page),p.length>0&&P.value++}catch(m){U.error("加载失败，请重试。")}finally{Q.value=!1}}}function Y(a){const l=a.target;100+l.scrollTop+l.clientHeight>=l.scrollHeight&&(Q.value||S.value||X())}function Z(){var a;null==(a=B.value)||a.open({path:{id:F.params.id}})}return s((()=>{X()})),(a,l)=>(m(),o(i,null,[u(_,{ref_key:"reportRef",ref:B,type:"album"},null,512),u(j,{"toggle-header":!1,"show-footer":!0,"header-title":a.$t("Album Details"),"on-scroll":Y},{default:r((()=>[u(w,null,{default:r((()=>{var l,e;return[c("div",z,[c("div",L,[c("div",N,[c("div",$,[c("p",q,p(G.value.name),1),c("div",C,[u(f(k),{class:"shrink-0",round:"",size:"medium",src:f(A).getUserAvatar(null==(l=G.value.user)?void 0:l.avatar_url)},null,8,["src"]),c("div",E,p(null==(e=G.value.user)?void 0:e.name),1)]),c("p",H,p(G.value.intro),1)]),c("div",I,[u(f(g),{secondary:"",strong:"",size:"small",onClick:Z},{default:r((()=>[h(p(a.$t("Report")),1)])),_:1})])]),c("p",R,p(a.$t("Total {count} photos",{count:J.value})),1)]),c("div",T,[u(y,{items:K.value.map((a=>({...a,id:a.id}))),"column-width":200,gap:6,"max-aspect-ratio":2.5},{default:r((({item:a})=>[u(x,{photo:a},null,8,["photo"])])),_:1},8,["items"])])])]})),_:1})])),_:1},8,["header-title"])],64))}});export{W as default};
