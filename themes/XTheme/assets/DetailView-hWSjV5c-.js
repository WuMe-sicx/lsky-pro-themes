import{a as e,L as a,m as l,f as t,c as s,N as o,b as r}from"./Layout-B7WTefT3.js";import{_ as n}from"./Content.vue_vue_type_script_setup_true_lang-CATP0AmL.js";import{d as i,b as u,f as d,g as c,m as f,i as v,a as p,o as m,aD as _,I as w,c as g,s as x,v as h,aE as b,h as k,z as y,P as T,A as j,y as N,e as $,x as C,F as z,O as I,aF as S}from"./index-Ctnlk-aF.js";import{_ as R}from"./Back.vue_vue_type_script_setup_true_lang-sCWvZjrO.js";import{N as D,a as L}from"./CollapseItem-BTCbNBkY.js";import{N as A,a as U}from"./DescriptionsItem-BnC20TdP.js";import{N as M}from"./InfiniteScroll-PXT6Tz33.js";import{N as O}from"./Spin-DlOkiMFH.js";const P={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},B=[c("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 244l144-144l144 144"},null,-1),c("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 120v292"},null,-1)],F=i({name:"ArrowUpOutline",render:function(e,a){return d(),u("svg",P,B)}}),H={class:"flex flex-col space-y-2 h-full"},q={class:"flex-none space-x-2"},E={key:0,class:"flex space-x-2 overflow-hidden mb-5"},G={class:"flex flex-col items-end space-y-1 grow"},J={class:"text-gray-500 text-xs"},V={class:"flex-none w-fit inline-block bg-[#20b2e5] text-white overflow-hidden break-all p-2 rounded-lg md:max-w-[80%]"},K={key:1,class:"flex space-x-2 overflow-hidden mb-5"},Q={class:"flex flex-col space-y-1 grow"},W={class:"text-gray-500 text-xs"},X={class:"flex-none w-fit inline-block bg-gray-200 dark:bg-gray-700 overflow-hidden break-all p-2 rounded-lg md:max-w-[80%]"},Y={class:"shrink-0 w-full mt-5"},Z=i({__name:"DetailView",setup(i){const P=w(),B=e(),Z=f(),{t:ee}=v(),ae=p({}),le=p(!0),te=p(0),se=p([]),oe=p(!1),re=p(),ne=p("");function ie(){setTimeout((()=>{var e,a,l,t,s;null==(s=null==(e=re.value)?void 0:e.scrollbarInstRef)||s.scrollTo({top:(null==(t=null==(l=null==(a=re.value)?void 0:a.scrollbarInstRef)?void 0:l.contentRef)?void 0:t.scrollHeight)||0,behavior:"smooth"})}),50)}async function ue(){var e,a,l,t;if(!ne.value)return;const s=await S({path:{issue_no:P.params.issue_no.toString()},body:{content:ne.value,is_notify:!0}});if("error"===(null==(e=s.data)?void 0:e.status))return B.error(null==(a=s.data)?void 0:a.message);se.value.push({content:ne.value,created_at:new Date,user:{avatar:null==(l=Z.profile)?void 0:l.avatar_url,name:null==(t=Z.profile)?void 0:t.name}}),ne.value="",ie()}m((async()=>{var e,a,l;const t=await _({path:{issue_no:P.params.issue_no.toString()}});if("error"===(null==(e=t.data)?void 0:e.status))return B.error(null==(a=t.data)?void 0:a.message);ae.value=(null==(l=t.data)?void 0:l.data)||{},await async function(){var e,a,l;if(oe.value)return;te.value++,le.value=!0;const t=await b({path:{issue_no:P.params.issue_no.toString()},query:{page:1,per_page:9999}});se.value.push(...(null==(e=t.data)?void 0:e.data.data)||[]),le.value=!1,oe.value=(null==(a=t.data)?void 0:a.data.current_page)===(null==(l=t.data)?void 0:l.data.last_page),ie()}()}));const de=g((()=>({low:ee("Low"),medium:ee("Medium"),high:ee("High")}))),ce=g((()=>({in_progress:ee("Processing"),completed:ee("Completed")})));return(e,i)=>(d(),x(a,{"header-title":e.$t("Ticket Details"),"toggle-header":!1,"show-footer":!1},{default:h((()=>[k(n,{class:"mx-auto p-4 md:p-10 space-y-10 h-full"},{default:h((()=>[c("div",H,[c("div",q,[k(R,{to:"/user/tickets"})]),k(y(T),null,{default:h((()=>[k(y(D),{accordion:"","default-expanded-names":"info"},{default:h((()=>[k(y(L),{title:e.$t("Ticket Information"),name:"info"},{default:h((()=>[k(y(A),{size:"small",bordered:""},{default:h((()=>[k(y(U),{label:e.$t("Ticket Number")},{default:h((()=>[j(N(ae.value.issue_no),1)])),_:1},8,["label"]),k(y(U),{label:e.$t("Ticket Title")},{default:h((()=>[j(N(ae.value.title),1)])),_:1},8,["label"]),k(y(U),{label:e.$t("Ticket Level")},{default:h((()=>[j(N(de.value[ae.value.level]),1)])),_:1},8,["label"]),k(y(U),{label:e.$t("Ticket Status")},{default:h((()=>[j(N(ce.value[ae.value.status]),1)])),_:1},8,["label"]),k(y(U),{label:e.$t("Creation Time")},{default:h((()=>[j(N(y(l)(ae.value.created_at).format("L")),1)])),_:1},8,["label"])])),_:1})])),_:1},8,["title"])])),_:1})])),_:1}),k(y(T),{class:"grow w-full overflow-hidden","content-class":"flex flex-col overflow-hidden"},{default:h((()=>[k(y(M),{ref_key:"infiniteScrollRef",ref:re,class:"grow w-full"},{default:h((()=>[le.value?(d(),x(y(O),{key:0,size:"small",class:"w-full my-10"})):$("",!0),(d(!0),u(z,null,C(se.value,(e=>{var a;return d(),u(z,null,[e.user.id==(null==(a=y(Z).profile)?void 0:a.id)?(d(),u("div",E,[c("div",G,[c("p",null,[c("span",J,N(y(l)(e.created_at).fromNow()),1),j(" "+N(e.user.name),1)]),c("p",V,N(e.content),1)]),k(y(o),{class:"shrink-0",round:"",src:y(r).getUserAvatar(e.user.avatar_url)},null,8,["src"])])):(d(),u("div",K,[k(y(o),{class:"shrink-0",round:"",src:y(r).getUserAvatar(e.user.avatar_url)},null,8,["src"]),c("div",Q,[c("p",null,[j(N(e.user.name)+" ",1),c("span",W,N(y(l)(e.created_at).fromNow()),1)]),c("p",X,N(e.content),1)])]))],64)})),256))])),_:1},512),c("div",Y,[k(y(t),{value:ne.value,"onUpdate:value":i[0]||(i[0]=e=>ne.value=e),size:"large",type:"textarea",autosize:{minRows:1,maxRows:4},class:"w-full",placeholder:"completed"===ae.value.status?e.$t("Ticket Completed"):e.$t("Please describe your problem"),disabled:"completed"===ae.value.status},{suffix:h((()=>[k(y(I),{strong:"",secondary:"",circle:"",type:"primary",size:"small",onClick:ue,disabled:"completed"===ae.value.status||""==ne.value},{icon:h((()=>[k(y(s),{size:14,component:y(F)},null,8,["component"])])),_:1},8,["disabled"])])),_:1},8,["value","placeholder","disabled"])])])),_:1})])])),_:1})])),_:1},8,["header-title"]))}});export{Z as default};
