import{d as e,k as a,u as t,m as l,a as s,i as r,I as o,c as n,o as i,j as u,Q as d,s as c,v as p,b as v,h as m,z as y,e as f,A as g,y as h,C as _,g as k,D as w,n as b,O as $,F as x,x as q,f as z,U as S,S as U}from"./index-Ctnlk-aF.js";import{_ as j}from"./AuthFormCard.vue_vue_type_script_setup_true_lang-Cu_hDfQ0.js";import{a as A,L as P,g as C,h as R,i as L,f as I,j as N,c as O,b as W}from"./Layout-B7WTefT3.js";import{_ as F,a as M}from"./PhoneVerifyInput.vue_vue_type_script_setup_true_lang-e--7F6GK.js";import{N as Q}from"./Spin-DlOkiMFH.js";import{N as T}from"./Alert-CXqSmTtF.js";const V={key:0,class:"w-full h-full flex items-center justify-center"},Z={key:2,class:"password-strength-bar mb-4 -mt-4"},D={class:"strength-track"},E={class:"strength-label"},G={class:"flex justify-end items-center mt-2"},Y={class:"text-sm text-zinc-500 dark:text-zinc-400"},B={key:3,class:"mt-10 mb-4"},H={class:"auth-swiss-divider-label"},J={class:"flex justify-center gap-4 mt-6"},K={key:3,class:"text-center py-12 text-zinc-500 dark:text-zinc-400 text-sm"},X=e({__name:"RegisterView",setup(e){var X,ee;const ae=a(),te=t(),le=l(),se=s(!0),re=o(),oe=u(),ne=A(),{t:ie}=r(),ue=s(null),de=s({email:"",phone:"",name:"",username:"",password:"",password_confirmation:"",code:"",country_code:"cn",token:(null==(ee=null==(X=re.query)?void 0:X.token)?void 0:ee.toString())||""}),ce=async()=>{var e,a;const t=await S({body:de.value});if("error"===(null==(e=t.data)?void 0:e.status))return ne.error(null==(a=t.data)?void 0:a.message);ne.success(ie("Registration successful. Please log in.")),await oe.push("/login")},pe=s("email"),ve=n((()=>{const e=de.value.password;if(!e)return 0;let a=0;return e.length>=6&&a++,e.length>=10&&a++,/[A-Z]/.test(e)&&a++,/[0-9]/.test(e)&&a++,/[^A-Za-z0-9]/.test(e)&&a++,Math.min(a,4)})),me=n((()=>25*ve.value)),ye=n((()=>["","weak","weak","medium","strong"][ve.value])),fe=n((()=>["",ie("Weak"),ie("Weak"),ie("Medium"),ie("Strong")][ve.value]));return i((()=>{var e;pe.value=(null==(e=te.configs)?void 0:e.app.user_email_verify)?"email":"phone",le.isLoggedIn&&oe.push("/user/dashboard").then((()=>{ae.setSidebarOpen(!0)})),re.query.driver_id&&re.query.code?d({path:{id:re.query.driver_id.toString()},body:{code:re.query.code.toString()}}).then((e=>{var a;const t=(null==(a=e.data)?void 0:a.data.token.toString())||"";202===e.status?(oe.replace({query:{token:t}}),de.value.token=t):(async e=>{le.setToken(e),oe.push("/user/dashboard").then((()=>{ae.setSidebarOpen(!0)}))})(e.data.data.token).then((()=>{ne.success(ie("Account exists. Logged in directly."))}))})).finally((()=>{se.value=!1})):se.value=!1})),(e,a)=>(z(),c(P,{"header-title":e.$t("Register")},{default:p((()=>[se.value?(z(),v("div",V,[m(y(Q),{size:"small",description:"loading..."})])):(z(),c(j,{key:1,title:e.$t("Create Your Account"),subtitle:e.$t("Start building your cloud gallery")},{default:p((()=>{var t,l,s,r,o,n;return[de.value.token?(z(),c(y(T),{key:0,type:"info",class:"mb-6"},{default:p((()=>[g(h(e.$t("Register a new account and bind it. After binding, you can log in directly next time.")),1)])),_:1})):f("",!0),(null==(t=y(te).configs)?void 0:t.app.enable_registration)&&(null==(l=y(te).configs)?void 0:l.app.user_email_verify)&&(null==(s=y(te).configs)?void 0:s.app.user_phone_verify)?(z(),c(y(C),{key:1,type:"line",class:"mb-8",value:pe.value,"onUpdate:value":a[0]||(a[0]=e=>pe.value=e)},{default:p((()=>[m(y(R),{name:"email"},{default:p((()=>[g(h(e.$t("Email")),1)])),_:1}),m(y(R),{name:"phone"},{default:p((()=>[g(h(e.$t("Phone")),1)])),_:1})])),_:1},8,["value"])):f("",!0),(null==(r=y(te).configs)?void 0:r.app.enable_registration)&&((null==(o=y(te).configs)?void 0:o.app.user_email_verify)||(null==(n=y(te).configs)?void 0:n.app.user_phone_verify))?(z(),c(y(L),{key:2,ref_key:"formRef",ref:ue,model:de.value,"show-require-mark":!0,onSubmit:_(ce,["prevent"])},{default:p((()=>{var t,l,s,r;return["email"===pe.value?(z(),c(F,{key:0,size:"large",event:"register",email:de.value.email,"onUpdate:email":a[1]||(a[1]=e=>de.value.email=e),code:de.value.code,"onUpdate:code":a[2]||(a[2]=e=>de.value.code=e),"require-verify":null==(t=y(te).configs)?void 0:t.app.user_email_register_verify},null,8,["email","code","require-verify"])):f("",!0),"phone"===pe.value?(z(),c(M,{key:1,size:"large",event:"register",phone:de.value.phone,"onUpdate:phone":a[3]||(a[3]=e=>de.value.phone=e),"country-code":de.value.country_code,"onUpdate:countryCode":a[4]||(a[4]=e=>de.value.country_code=e),code:de.value.code,"onUpdate:code":a[5]||(a[5]=e=>de.value.code=e),"require-verify":null==(l=y(te).configs)?void 0:l.app.user_phone_register_verify},null,8,["phone","country-code","code","require-verify"])):f("",!0),m(y(N),{label:e.$t("Username")},{default:p((()=>[m(y(I),{value:de.value.username,"onUpdate:value":a[6]||(a[6]=e=>de.value.username=e),"input-props":{required:!0},placeholder:e.$t("Please enter your username"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"]),m(y(N),{label:e.$t("Name")},{default:p((()=>[m(y(I),{value:de.value.name,"onUpdate:value":a[7]||(a[7]=e=>de.value.name=e),"input-props":{required:!0},placeholder:e.$t("Please enter your name"),size:"large"},null,8,["value","placeholder"])])),_:1},8,["label"]),m(y(N),{label:e.$t("Password")},{default:p((()=>[m(y(I),{value:de.value.password,"onUpdate:value":a[8]||(a[8]=e=>de.value.password=e),placeholder:e.$t("Please enter your password"),type:"password","show-password-on":"mousedown",size:"large","input-props":{required:!0}},null,8,["value","placeholder"])])),_:1},8,["label"]),de.value.password?(z(),v("div",Z,[k("div",D,[k("div",{class:b(["strength-fill",ye.value]),style:w({width:me.value+"%"})},null,6)]),k("span",E,h(e.$t("Password Strength"))+": "+h(fe.value),1)])):f("",!0),m(y(N),{label:e.$t("Confirm Password"),"show-feedback":!1},{default:p((()=>[m(y(I),{value:de.value.password_confirmation,"onUpdate:value":a[9]||(a[9]=e=>de.value.password_confirmation=e),placeholder:e.$t("Please confirm your password"),type:"password","show-password-on":"mousedown",size:"large","input-props":{required:!0}},null,8,["value","placeholder"])])),_:1},8,["label"]),m(y(N),{class:"mt-8"},{default:p((()=>[m(y($),{type:"primary","attr-type":"submit",size:"large",strong:"",block:""},{default:p((()=>[g(h(e.$t("Register")),1)])),_:1})])),_:1}),k("div",G,[k("span",Y,[g(h(e.$t("Already have an account?"))+" ",1),k("button",{type:"button",class:"auth-swiss-link text-sm ml-1",onClick:a[10]||(a[10]=e=>y(oe).push({path:"/login",query:{token:de.value.token||void 0}}))},h(e.$t("Go to Login")),1)])]),!de.value.token&&((null==(s=y(te).configs)?void 0:s.app.socialites)||[]).length>0?(z(),v("div",B,[k("div",H,[k("span",null,h(e.$t("or")),1)]),k("div",J,[(z(!0),v(x,null,q(null==(r=y(te).configs)?void 0:r.app.socialites,(e=>(z(),c(y($),{onClick:a=>(async e=>{var a,t;const l=await U({path:{id:e.id.toString()},query:{redirect_url:`${W.getWithoutQueryUrl()}?driver_id=${e.id}`}});if("error"===(null==(a=l.data)?void 0:a.status))return ne.error(null==(t=l.data)?void 0:t.message);window.location.replace(l.data.data.redirect_url)})(e),secondary:"",size:"large",class:"flex-1"},{icon:p((()=>[m(y(O),{component:y(W).getSocialiteIcon(e.provider)},null,8,["component"])])),default:p((()=>[g(" "+h(e.name),1)])),_:2},1032,["onClick"])))),256))])])):f("",!0)]})),_:1},8,["model"])):(z(),v("div",K,h(e.$t("The system has closed the registration")),1))]})),_:1},8,["title","subtitle"]))])),_:1},8,["header-title"]))}});export{X as default};
