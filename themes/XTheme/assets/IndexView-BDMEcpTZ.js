import{_ as e}from"./Content.vue_vue_type_script_setup_true_lang-CATP0AmL.js";import{f as a,o as l,p as t,a as s,n as o,L as r,k as i,i as n,j as d,q as c,s as u}from"./Layout-B7WTefT3.js";import{l as p}from"./lodash-CdNXJ-G9.js";import{_ as v,a as f,b as h,c as m,d as g,e as b,f as y}from"./PhotoSelect.vue_vue_type_script_setup_true_lang-Dl1OVyhE.js";import{d as w,i as x,a as _,J as k,s as S,z as $,a7 as A,v as j,g as z,e as C,h as P,b as L,F as q,x as U,f as E,E as T,y as I,o as D,O as F,u as M,c as N,a8 as O,A as H,a9 as B,n as G,aa as K,_ as R}from"./index-Ctnlk-aF.js";import{u as W}from"./album-CfclpCjE.js";import{N as J}from"./InfiniteScroll-PXT6Tz33.js";import{N as V}from"./Spin-DlOkiMFH.js";import"./WaterfallLayout-Cc-Ll5Bs.js";import"./composables-DhvgzyQS.js";import"./Popconfirm-DM_99shz.js";const Q={class:"flex flex-col space-y-4"},X={class:"flex justify-between w-full border-b pb-2 dark:border-b-gray-600"},Y=["onClick"],Z={class:"h-16 w-16 rounded-lg overflow-hidden shrink-0"},ee=["src"],ae={key:1,class:"flex grow items-center justify-center h-full bg-gray-100 dark:bg-gray-700"},le={class:"flex flex-col justify-center ml-4 overflow-hidden"},te={key:0,class:"truncate text-lg"},se={class:"truncate text-gray-500"},oe={key:0,class:"flex justify-center py-10"},re=w({__name:"AlbumSelector",props:{title:{type:String,required:!1,default:"Select Album"}},emits:["onSelect"],setup(e,{expose:t,emit:s}){const o=W(),{t:r}=x(),i=e,n=s,d=_(!1),c=_("");function u(){d.value=!1}function v(){o.isLoading||(o.setPage(o.page+1),o.fetchAlbums())}return k((()=>c.value),p.debounce((()=>{o.resetAlbums({q:c})}),500)),t({open:function(){o.resetAlbums(),d.value=!0},close:u}),(e,t)=>(E(),S($(A),{show:d.value,"onUpdate:show":t[1]||(t[1]=e=>d.value=e),title:i.title,preset:"card",size:"small",bordered:!1,class:"container m-4 md:mx-auto md:my-10 max-w-screen-md overflow-hidden"},{default:j((()=>[z("div",Q,[z("div",X,[P($(a),{placeholder:e.$t("Search Albums"),bordered:!1,value:c.value,"onUpdate:value":t[0]||(t[0]=e=>c.value=e)},null,8,["placeholder","value"])]),$(o).isLoading||0!==$(o).albums.length?C("",!0):(E(),S($(l),{key:0,class:"py-8",description:e.$t("No albums available")},null,8,["description"])),P($(J),{class:"max-h-[400px]",onLoad:v},{default:j((()=>[(E(!0),L(q,null,U($(o).albums,(a=>(E(),L("div",{class:"flex p-2 mb-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800",onClick:e=>function(e){var a;o.toggleSelect((null==(a=e.id)?void 0:a.toString())||""),n("onSelect",o.selections),u()}(a)},[z("div",Z,[a.covers&&a.covers.length>0?(E(),L("img",{key:0,class:"rounded-lg w-full h-full object-cover",alt:"album cover",src:a.covers[0]},null,8,ee)):(E(),L("div",ae,[P($(T),{icon:"fa-solid fa-images",class:"text-gray-500",size:"xl"})]))]),z("div",le,[a.name?(E(),L("div",te,I(a.name),1)):C("",!0),z("div",se,I(e.$t("{count} items",{count:a.photo_count})),1)])],8,Y)))),256)),$(o).isLoading?(E(),L("div",oe,[P($(V),{size:25})])):C("",!0)])),_:1})])])),_:1},8,["show","title"]))}}),ie=w({__name:"PhotoToAlbum",setup(e){const a=t(),l=_(null),o=s(),{t:r}=x();function i(){var e;null==(e=l.value)||e.open()}function n(e){a.selectedToAlbum(e).then((()=>{o.success(r("Added successfully"))})).catch((e=>{o.error(r("Failed to add to album"))}))}return D((()=>{a.setAlbumSelectorRef(l.value)})),(e,a)=>(E(),L(q,null,[P(re,{ref_key:"albumSelectorRef",ref:l,title:e.$t("Add to Album"),onOnSelect:n},null,8,["title"]),P($(F),{tertiary:"",circle:"",size:"small",type:"default",title:e.$t("Add to Album"),"aria-label":e.$t("Add to Album"),onClick:i},{icon:j((()=>[P($(T),{icon:"fa-solid fa-plus"})])),_:1},8,["title","aria-label"])],64))}}),ne=w({__name:"PhotoShare",setup(e){const{t:a}=x(),l=t();return(e,a)=>(E(),S($(F),{tertiary:"",circle:"",size:"small",type:"default",title:e.$t("Share"),"aria-label":e.$t("Share"),onClick:a[0]||(a[0]=e=>$(l).setShareModalActive(!0))},{icon:j((()=>[P($(T),{icon:"fa-solid fa-share-nodes"})])),_:1},8,["title","aria-label"]))}}),de={class:"photo-toolbar sticky top-0 z-[4] px-4 py-3 w-full"},ce={class:"flex items-center justify-between gap-4"},ue={class:"hidden md:block text-lg font-semibold text-apple-text-dark dark:text-gray-100 shrink-0 tracking-tight select-none"},pe={class:"flex items-center gap-1.5 grow md:grow-0"},ve={class:"photo-filter-input relative grow md:grow-0 md:w-52"},fe={class:"shrink-0 hidden md:flex items-center bg-apple-bg dark:bg-white/[0.06] rounded-lg p-0.5 gap-0.5"},he=["onClick","aria-label"],me={class:"flex flex-col"},ge={class:"space-y-4 p-2"},be={class:"flex flex-col space-y-4"},ye={key:0,class:"flex justify-end"},we={key:1,class:"flex justify-between space-x-2"},xe=R(w({__name:"IndexView",setup(l){const w=M(),C=t(),{t:R}=x(),W=s(),J=_(""),V=_({type:"photo",ids:[],content:"",password:"",expired_at:null}),Q={},X=e=>{const a=e.target;100+a.scrollTop+a.clientHeight>=a.scrollHeight&&(C.isLoading||(C.setPage(C.page+1),C.fetchPhotos()))};function Y(e){(e.ctrlKey||e.metaKey)&&"a"===e.key&&(e.preventDefault(),C.selectAll())}const Z=[{label:R("Newest"),value:"latest"},{label:R("Oldest"),value:"oldest"}],ee=_({q:"",storage_id:null,order_by:"latest"}),ae=[{width:160,icon:"fa-solid fa-th"},{width:220,icon:"fa-solid fa-th-large"},{width:300,icon:"fa-solid fa-square"}],le=localStorage.getItem("photo-density"),te=_(le?Number(le):220);K("columnWidth",te);const se=N((()=>C.groups.reduce(((e,a)=>e+a.photos.length),0)));function oe(){C.resetPhotos({storage_id:ee.value.storage_id,q:`sort:${ee.value.order_by} ${ee.value.q}`})}function re(){if(0===C.selections.length)return void W.warning(R("Please select photos first"));const e={...V.value};if(e.ids=C.selections.map((e=>e.id)),e.expired_at){const a=new Date(e.expired_at);e.expired_at=a.toISOString().slice(0,19).replace("T"," ")}B({body:e}).then((e=>{var a,l,t;if("error"===(null==(a=e.data)?void 0:a.status))return W.error(null==(l=e.data)?void 0:l.message);J.value=`${window.location.origin}/shares/${null==(t=e.data)?void 0:t.data.slug}`})).catch((()=>{W.error(R("Failed to create share"))}))}function xe(){u.copyText(J.value).then((()=>{W.success(R("Copy successful"))})).catch((()=>{W.error(R("Copy failed"))}))}return k((()=>C.shareModalActive),(e=>{e&&(J.value="",V.value={type:"photo",ids:[],content:"",password:"",expired_at:null})})),k(ee,p.debounce((()=>oe()),500),{deep:!0}),D((()=>{oe(),window.addEventListener("keydown",Y)})),O((()=>{window.removeEventListener("keydown",Y)})),(l,t)=>(E(),S(r,{"toggle-header":!1,"show-footer":!1,"header-title":`${$(C).selections.length>0?l.$t("{count} items selected",{count:$(o).format($(C).selections.length)}):l.$t("Photo Management")}`,"on-scroll":X},{default:j((()=>[P(e,{class:"max-w-full bg-white dark:bg-zinc-950"},{default:j((()=>{var e;return[z("div",de,[z("div",ce,[z("h2",ue,I(l.$t("{count} photos",{count:$(o).format(se.value)})),1),z("div",pe,[z("div",ve,[P($(T),{icon:"fa-solid fa-magnifying-glass",class:"absolute left-3 top-1/2 -translate-y-1/2 text-xs text-gray-400 dark:text-gray-500 z-[1] pointer-events-none"}),P($(a),{value:ee.value.q,"onUpdate:value":t[0]||(t[0]=e=>ee.value.q=e),class:"w-full",placeholder:l.$t("Enter keywords to search..."),clearable:""},null,8,["value","placeholder"])]),P($(i),{class:"photo-filter-select max-w-44 hidden md:block",filterable:"",clearable:"",placeholder:l.$t("Storage Filter"),value:ee.value.storage_id,"onUpdate:value":t[1]||(t[1]=e=>ee.value.storage_id=e),options:(null==(e=$(w).group)?void 0:e.storages)||[],"label-field":"name","value-field":"id"},null,8,["placeholder","value","options"]),P($(i),{class:"photo-filter-select w-28 shrink-0",placeholder:l.$t("Sort"),options:Z,value:ee.value.order_by,"onUpdate:value":t[2]||(t[2]=e=>ee.value.order_by=e)},null,8,["placeholder","value"]),z("div",fe,[(E(),L(q,null,U(ae,(e=>z("button",{key:e.width,class:G(["density-btn",te.value===e.width?"density-btn-active":""]),onClick:a=>{return l=e.width,te.value=l,void localStorage.setItem("photo-density",String(l));var l},"aria-label":l.$t("Grid density")},[P($(T),{icon:e.icon,class:"text-xs"},null,8,["icon"])],10,he))),64))])])])]),z("div",me,[z("div",ge,[P(v)]),P(f,null,{default:j((()=>[P(h),P(m),P(g),P(b),P(ne),P(ie),P(y)])),_:1})])]})),_:1}),P($(A),{show:$(C).shareModalActive,"onUpdate:show":t[6]||(t[6]=e=>$(C).shareModalActive=e),title:l.$t("Share Photos"),preset:"card",size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto z-50"},{action:j((()=>[J.value?(E(),L("div",we,[P($(a),{class:"grow select-all","default-value":J.value,readonly:""},null,8,["default-value"]),P($(F),{tertiary:"",type:"primary",class:"shrink-0",onClick:xe},{icon:j((()=>[P($(T),{icon:"fa-solid fa-copy"})])),_:1})])):(E(),L("div",ye,[P($(F),{tertiary:"",onClick:re},{default:j((()=>[H(I(l.$t("Create Share Link")),1)])),_:1})]))])),default:j((()=>[z("div",be,[P($(n),{model:V.value,rules:Q,disabled:Boolean(J.value)},{default:j((()=>[P($(d),{label:l.$t("Share Description"),path:"content"},{default:j((()=>[P($(a),{resizable:"",type:"textarea",value:V.value.content,"onUpdate:value":t[3]||(t[3]=e=>V.value.content=e)},null,8,["value"])])),_:1},8,["label"]),P($(d),{label:l.$t("Password"),path:"password"},{default:j((()=>[P($(a),{type:"password",value:V.value.password,"onUpdate:value":t[4]||(t[4]=e=>V.value.password=e)},null,8,["value"])])),_:1},8,["label"]),P($(d),{label:l.$t("Expiration Time"),path:"expired_at"},{default:j((()=>[P($(c),{value:V.value.expired_at,"onUpdate:value":t[5]||(t[5]=e=>V.value.expired_at=e),type:"datetime",class:"w-full",placeholder:l.$t("Select Expiration Time"),"is-date-disabled":e=>e<Date.now(),clearable:""},null,8,["value","placeholder","is-date-disabled"])])),_:1},8,["label"])])),_:1},8,["model","disabled"])])])),_:1},8,["show","title"])])),_:1},8,["header-title"]))}}),[["__scopeId","data-v-195fc8d1"]]);export{xe as default};
