import{az as e,m as t,b8 as r,d as s,a,$ as i,B as o,s as l,v as n,h as u,z as d,N as c,f as p,A as m,y as f,j as h,O as v,b9 as y,e as _}from"./index-DKzf3TMO.js";import{_ as w}from"./Content.vue_vue_type_script_setup_true_lang-CGEjm_tA.js";import{a as g,I as k,N as b,P as x,r as T,J as j,_ as A,g as C,S as P}from"./Layout.vue_vue_type_script_setup_true_lang-BRRcuvRl.js";import{_ as $}from"./DataTable.vue_vue_type_script_setup_true_lang-QegQ-Qi6.js";import{N as L,a as z}from"./ListItem-C_hNZPC8.js";import{P as W}from"./PlusOutlined-BNnMg6_T.js";import{u as D}from"./composables-B9wCYdts.js";import{N as I}from"./Alert-DPCT-9KG.js";import"./Checkbox-BBdeyiKG.js";import"./Ellipsis-DiUODvwn.js";const N=e("token",()=>{const{t:e}=t();return{deleteToken:async function(t,s={},a){const{message:i,dialog:o}=a;return new Promise(a=>{const l=o.warning({title:e("Delete Token"),content:e("Once deleted, the login status of the client using this token will become invalid. Are you sure you want to delete it?"),positiveText:e("Confirm"),negativeText:e("Cancel"),onPositiveClick:()=>(l.loading=!0,new Promise(s=>{r({path:{id:t}}).then(()=>{i.success(e("Delete successfully")),s(!0)}).finally(()=>{l.loading=!1,a(!0)})})),...s})})}}}),O={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},U={class:"grow md:grow-0 md:basis-1/2"},q=s({__name:"IndexView",setup(e){const r=h(),{t:s}=t(),q=a(),E=N(),K=g(),M=D(),R=[{title:s("Token Name"),key:"name",minWidth:200},{title:s("Permissions"),key:"abilities",minWidth:150,render:e=>!e.abilities||Array.isArray(e.abilities)&&e.abilities.includes("*")?i(k,{type:"warning"},{default:()=>s("Full Access")}):i(x,{trigger:"hover",placement:"bottom",width:300},{trigger:()=>i(k,{type:"info"},{default:()=>i("span",{},`${e.abilities.length} ${s("Permissions")}`)}),default:()=>i(L,{hoverable:!0,bordered:!1,style:"max-height: 400px; overflow-y: auto;"},{header:()=>i("div",{class:"font-bold pb-2"},s("Granted Permissions")),default:()=>e.abilities.map(e=>i(z,{key:e},{default:()=>i("div",{class:"flex items-center gap-2"},[i(b,{size:16,color:"#18a058"},{default:()=>i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor"},[i("path",{d:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z"})])}),i("span",{},H(e))])}))})})},{title:s("Last Used Time"),minWidth:150,key:"last_used_at",sorter:!0,align:"center",render:e=>e.last_used_at?T(e.last_used_at).format("L"):"-"},{title:s("Expires Time"),minWidth:150,key:"expires_at",sorter:!0,align:"center",render:e=>e.expires_at?T(e.expires_at).format("L"):"-"},{title:s("Creation Time"),minWidth:150,key:"created_at",sorter:!0,align:"center",render:e=>T(e.created_at).format("L")},{title:s("Actions"),key:"actions",minWidth:150,fixed:"right",align:"center",render:e=>i(j,{vertical:!1,size:5,justify:"center"},{default:()=>[i(o,{size:"small",type:"error",onClick:()=>{E.deleteToken(e.id,{},{message:K,dialog:M}).finally(()=>{var e;F.value=[],null==(e=q.value)||e.refresh()})}},{default:()=>s("Delete Token")})]})}],B=a(""),S=a("sort:latest"),F=a([]),G=e=>y({query:{page:e,per_page:40,q:`${B.value} ${S.value}`.trim()}});function J(e){var t;e.order?S.value=`sort:${e.columnKey}:${e.order}`:S.value="sort:latest",null==(t=q.value)||t.refresh()}function V(){var e;null==(e=q.value)||e.refresh()}const H=e=>({basic:"基础权限","user:profile:read":"读取用户资料","user:profile:write":"更新用户资料","user:token:read":"查看个人令牌","user:token:write":"管理个人令牌","user:group:read":"查看用户角色组","user:group:write":"管理用户角色组","user:capacity:read":"查看用户容量","user:capacity:write":"管理用户容量","user:album:read":"查看相册","user:album:write":"管理相册","user:photo:read":"查看照片","user:photo:write":"管理照片","user:share:read":"查看分享","user:share:write":"管理分享","user:ticket:read":"查看工单","user:ticket:write":"管理工单","user:order:read":"查看订单","user:order:write":"管理订单","oauth:read":"查看OAuth信息","oauth:write":"管理OAuth绑定","explore:read":"浏览探索内容","explore:write":"管理探索互动","upload:write":"上传图片"}[e]||e);return(e,t)=>(_(),l(A,{"header-title":e.$t("My Tokens"),"toggle-header":!1,"show-footer":!1},{default:n(()=>[u(w,{class:"mx-auto p-4 md:p-10 space-y-10"},{default:n(()=>[u(d(c),null,{default:n(()=>[u(d(j),{vertical:""},{default:n(()=>[u(d(I),{type:"info","show-icon":""},{default:n(()=>[m(f(e.$t("API tokens are used to authenticate API requests. Create tokens with specific permissions to improve security. Tokens with no permissions will have full access.")),1)]),_:1}),p("div",O,[p("div",null,[u(d(o),{tertiary:"",onClick:t[0]||(t[0]=()=>{d(r).push("/user/tokens/create")})},{icon:n(()=>[u(d(b),{component:d(W)},null,8,["component"])]),default:n(()=>[m(" "+f(e.$t("Create Token")),1)]),_:1})]),p("div",U,[u(d(C),{value:B.value,"onUpdate:value":t[1]||(t[1]=e=>B.value=e),placeholder:e.$t("Enter keywords to search..."),onKeyup:v(V,["enter","native"])},{prefix:n(()=>[u(d(b),{component:d(P)},null,8,["component"])]),_:1},8,["value","placeholder"])])]),u($,{striped:"",ref_key:"tableRef",ref:q,bordered:!1,fetch:G,columns:R,"row-key":e=>e.id,"checked-row-keys":F.value,"onUpdate:checkedRowKeys":t[2]||(t[2]=e=>F.value=e),onUpdateSorter:J},null,8,["row-key","checked-row-keys"])]),_:1})]),_:1})]),_:1})]),_:1},8,["header-title"]))}});export{q as default};
