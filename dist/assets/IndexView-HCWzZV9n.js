import{az as e,aS as t,d as s,m as a,a as r,$ as l,B as i,j as o,s as n,v as u,h as c,z as d,N as m,f as p,A as f,y as _,O as k,aT as v,e as y}from"./index-DKzf3TMO.js";import{_ as h}from"./Content.vue_vue_type_script_setup_true_lang-CGEjm_tA.js";import{a as g,I as w,r as T,J as C,_ as x,N as j,g as b,S as $}from"./Layout.vue_vue_type_script_setup_true_lang-BRRcuvRl.js";import{_ as P}from"./DataTable.vue_vue_type_script_setup_true_lang-QegQ-Qi6.js";import{P as W}from"./PlusOutlined-BNnMg6_T.js";import{u as z}from"./composables-B9wCYdts.js";import"./Checkbox-BBdeyiKG.js";import"./Ellipsis-DiUODvwn.js";const L=e("ticket",()=>({closeTicket:async function(e,s,a,r,l={}){return new Promise(i=>{const o=a.warning({title:r("Close Ticket"),content:r("Once closed, you cannot reply to the ticket. Are you sure you want to close this ticket?"),positiveText:r("Confirm"),negativeText:r("Cancel"),onPositiveClick:()=>(o.loading=!0,new Promise(a=>{t({path:{issue_no:e}}).then(()=>{s.success(r("Closed successfully")),a(!0)}).finally(()=>{o.loading=!1,i(!0)})})),...l})})}})),U={class:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between"},A={class:"grow md:grow-0 md:basis-1/2"},S=s({__name:"IndexView",setup(e){const t=L(),s=o(),{t:S}=a(),D=g(),K=z(),N=r(),O=[{title:S("Ticket Number"),key:"issue_no",minWidth:250},{title:S("Ticket Title"),key:"title",minWidth:300},{title:S("Ticket Level"),key:"level",minWidth:120,sorter:!0,align:"center",render(e){const t={low:S("Low"),medium:S("Medium"),high:S("High")},s=e.level;return l(w,{type:{low:"info",medium:"warning",high:"danger"}[s]},{default:()=>t[s]||S("Unknown")})}},{title:S("Ticket Status"),key:"status",minWidth:100,sorter:!0,align:"center",render(e){const t={in_progress:S("Processing"),completed:S("Completed")},s=e.status;return l(w,{type:{in_progress:"warning",completed:"success"}[s]},{default:()=>t[s]??S("Unknown")})}},{title:S("Creation Time"),minWidth:200,key:"created_at",sorter:!0,align:"center",render:e=>T(e.created_at).format("L")},{title:S("Actions"),key:"actions",minWidth:170,fixed:"right",align:"center",render:e=>l(C,{vertical:!1,size:5,justify:"center"},{default:()=>[l(i,{size:"small",onClick:()=>{s.push(`/user/tickets/${e.issue_no}`)}},{default:()=>S("Details")}),l(i,{disabled:"completed"===e.status,size:"small",type:"error",onClick:()=>{t.closeTicket(e.issue_no,D,K,S).finally(()=>{var e;E.value=[],null==(e=N.value)||e.refresh()})}},{default:()=>S("Close Ticket")})]})}],R=r(""),q=r("sort:latest"),E=r([]),I=e=>v({query:{page:e,per_page:40,q:`${R.value} ${q.value}`.trim()}});function M(e){var t;e.order?q.value=`sort:${e.columnKey}:${e.order}`:q.value="sort:latest",null==(t=N.value)||t.refresh()}function B(){var e;null==(e=N.value)||e.refresh()}return(e,t)=>(y(),n(x,{"header-title":e.$t("My Tickets"),"toggle-header":!1,"show-footer":!1},{default:u(()=>[c(h,{class:"mx-auto p-4 md:p-10 space-y-10"},{default:u(()=>[c(d(m),null,{default:u(()=>[c(d(C),{vertical:""},{default:u(()=>[p("div",U,[p("div",null,[c(d(i),{tertiary:"",onClick:t[0]||(t[0]=()=>{d(s).push("/user/tickets/create")})},{icon:u(()=>[c(d(j),{component:d(W)},null,8,["component"])]),default:u(()=>[f(" "+_(e.$t("Create Ticket")),1)]),_:1})]),p("div",A,[c(d(b),{value:R.value,"onUpdate:value":t[1]||(t[1]=e=>R.value=e),placeholder:e.$t("Enter keywords to search..."),onKeyup:k(B,["enter","native"])},{prefix:u(()=>[c(d(j),{component:d($)},null,8,["component"])]),_:1},8,["value","placeholder"])])]),c(P,{striped:"",ref_key:"tableRef",ref:N,bordered:!1,fetch:I,columns:O,"row-key":e=>e.id,"checked-row-keys":E.value,"onUpdate:checkedRowKeys":t[2]||(t[2]=e=>E.value=e),onUpdateSorter:M},null,8,["row-key","checked-row-keys"])]),_:1})]),_:1})]),_:1})]),_:1},8,["header-title"]))}});export{S as default};
