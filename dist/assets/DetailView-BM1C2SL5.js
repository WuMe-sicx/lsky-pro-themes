import{z as e,r as a,s as t,A as l,B as s,n as o,v as r,a as i,_ as u,N as n,g as c,D as d,j as p,k as v,w as f,x as m}from"./Layout.vue_vue_type_script_setup_true_lang-BRRcuvRl.js";import{_ as h}from"./Content.vue_vue_type_script_setup_true_lang-CGEjm_tA.js";import{l as y}from"./album-DkuRp1Yw.js";import{d as g,c as _,b,e as x,z as k,f as w,h as S,ak as P,Q as $,n as j,i as z,m as C,y as A,v as L,s as T,g as D,F as U,x as q,a as N,B,A as H,l as I,aq as R,I as M,ar as F,o as O,as as E,H as G,am as W,ao as J,j as K,at as Q}from"./index-DKzf3TMO.js";import{P as V,_ as X,a as Y,b as Z,c as ee,d as ae,e as te,f as le}from"./PhotoSelect.vue_vue_type_script_setup_true_lang-CFkFFKqv.js";import{W as se}from"./WaterfallLayout-B-kJbIBO.js";import{N as oe}from"./Spin-DZKmp4ei.js";import{_ as re,a as ie}from"./Share.vue_vue_type_script_setup_true_lang-4tYwhG2g.js";import{N as ue}from"./Popconfirm-BfiBX2TP.js";import{_ as ne}from"./Back.vue_vue_type_script_setup_true_lang-i2ZA4QCP.js";import"./DeleteOutlined-Daecp8an.js";import"./composables-B9wCYdts.js";const ce={class:"absolute inset-0 flex justify-between z-[2] select-none"},de=g({__name:"PhotoBox",props:{photo:{}},emits:["onToggleSelect"],setup(a,{emit:t}){const l=a,s=_(()=>l.photo),{toggleSelect:o}=e();return(e,a)=>(x(),b("div",{class:"relative group bg-gray-200 dark:bg-gray-700",onClick:a[1]||(a[1]=()=>k(o)(s.value.key))},[a[2]||(a[2]=w("div",{class:"transition-all absolute w-full top-0 h-1/2 bg-gradient-to-b from-black/30 opacity-0 group-hover:opacity-100"},null,-1)),w("div",ce,[S(k(P),{class:j(["rounded-full cursor-pointer absolute top-2 left-2",s.value.selected?"text-violet-500 bg-white outline outline-1 outline-white dark:outline-gray-500":"hidden group-hover:block text-white/70 hover:text-white"]),icon:"fa-solid fa-circle-check",size:"xl",onClick:a[0]||(a[0]=$(()=>k(o)(s.value.key),["prevent","stop"]))},null,8,["class"])]),w("div",{class:j(["overflow-hidden transition-all",s.value.selected?"scale-90 rounded-lg":""])},[z(e.$slots,"default")],2)]))}}),pe={class:"flex flex-col space-y-2"},ve={class:"sticky top-0 z-[3] py-2 bg-gray-50 dark:bg-[var(--n-color)] flex space-x-2 items-center overflow-hidden group text-md"},fe={class:"font-bold"},me=g({__name:"PhotoSelectorGroup",props:{group:{type:Object,default:()=>{},required:!0}},setup(t){const l=t,{toggleSelectAllByGroup:s}=e(),{t:o}=C(),r=[o("Sunday"),o("Monday"),o("Tuesday"),o("Wednesday"),o("Thursday"),o("Friday"),o("Saturday")],i=_(()=>l.group.photos.map(e=>({...e,id:e.key})));return(e,t)=>(x(),b("div",pe,[w("div",ve,[S(k(P),{icon:l.group.selected?"fa-solid fa-circle-check":"fa-regular fa-circle",size:"xl",class:j(["transition-all select-none",l.group.selected?"text-violet-500 ml-0.5":"-ml-6 group-hover:ml-0.5 text-gray-500/70"]),onClick:t[0]||(t[0]=()=>k(s)(l.group.date))},null,8,["icon","class"]),w("p",fe,A(k(a)(l.group.date).format("L"))+" "+A(r[k(a)(l.group.date).day()]),1)]),S(se,{items:i.value,"column-width":150,gap:6},{default:L(({item:e})=>[S(de,{photo:e},{default:L(()=>[S(V,{src:e.src,alt:e.name||"","placeholder-text":"拼命加载中..."},null,8,["src","alt"])]),_:2},1032,["photo"])]),_:1},8,["items"])]))}}),he={key:1,class:"space-y-4"},ye={key:2,class:"flex justify-center py-10"},ge=g({__name:"PhotoSelectorList",setup(a){const l=e();return(e,a)=>(x(),b(U,null,[k(l).isLoading||0!==k(l).groups.length?(x(),b("div",he,[(x(!0),b(U,null,q(k(l).groups,e=>(x(),T(me,{group:e},null,8,["group"]))),256))])):(x(),T(k(t),{key:0,class:"my-10",description:e.$t("No photos available")},null,8,["description"])),k(l).isLoading?(x(),b("div",ye,[S(k(oe),{size:25})])):D("",!0)],64))}}),_e=g({__name:"PhotoSelector",props:{title:{type:String,required:!1,default:"Select Photos"}},emits:["onSelect"],setup(a,{expose:t,emit:r}){const{t:i}=C(),u=e();function n(e){const a=e.target;100+a.scrollTop+a.clientHeight>=a.scrollHeight&&!u.isLoading&&u.hasMore&&(u.setPage(u.page+1),u.fetchPhotos())}const c=a,d=r,p=N(!1);function v(){p.value=!1}function f(){d("onSelect",u.selections),v()}return t({open:function(){u.resetPhotos({q:"sort:latest"}),p.value=!0},close:v}),(e,a)=>(x(),T(k(l),{show:p.value,"onUpdate:show":a[0]||(a[0]=e=>p.value=e),placement:"bottom",height:"90%"},{default:L(()=>[S(k(s),{title:e.$t(c.title),"body-content-class":"!py-0 !px-2",closable:""},{footer:L(()=>[S(k(B),{secondary:"",strong:"",onClick:f},{default:L(()=>[H(A(e.$t("Selection Complete ({count})",{count:k(o).format(k(u).selections.length)})),1)]),_:1})]),default:L(()=>[w("div",{class:"h-full overflow-y-auto",onScroll:n},[S(ge)],32)]),_:1},8,["title"])]),_:1},8,["show"]))}}),be=g({__name:"PhotoRemove",props:{albumId:{type:Number,required:!0}},setup(e){const a=r(),t=I(),l=i(),{t:s}=C(),o=e;function u(){R({path:{id:o.albumId},body:a.selections.map(e=>e.id)}).then(()=>{l.success(s("Removed successfully")),a.deletePhotos(a.selections.map(e=>e.key)),t.isLoggedIn&&t.fetchUserProfile()})}return(e,t)=>(x(),T(k(ue),{placement:"left-start",onPositiveClick:u},{trigger:L(()=>[S(k(B),{quaternary:"",circle:"",size:"small",type:"error",title:e.$t("Remove selected items from album")},{icon:L(()=>[S(k(P),{icon:"fa-regular fa-square-minus"})]),_:1},8,["title"])]),default:L(()=>[H(" "+A(e.$t("Are you sure you want to remove the selected {count} photos from the album?",{count:k(a).selections.length})),1)]),_:1}))}}),xe={class:"flex items-center justify-between sticky top-0 z-[4] bg-gray-50 border-b border-transparent dark:bg-[var(--n-color)] dark:border-b-gray-800 p-2 w-full"},ke={class:"space-x-2"},we={class:"space-x-2"},Se={class:"flex flex-col"},Pe={class:"space-y-2 p-2 border-b dark:border-b-gray-600"},$e={class:"flex items-center p-2"},je={class:"space-y-4 p-2"},ze={class:"flex flex-col space-y-4"},Ce={key:0,class:"flex justify-end"},Ae={key:1,class:"flex justify-between space-x-2"},Le=g({__name:"DetailView",setup(e){const t=G(),l=K(),s=i(),{t:o}=C(),g=N(!1),_=N(),$=N(),j=N(),z=N({}),D=r(),U=N(""),q=N({type:"photo",ids:[],content:"",password:"",expired_at:null}),I={},R=e=>{const a=e.target;100+a.scrollTop+a.clientHeight>=a.scrollHeight&&(D.isLoading||(D.setPage(D.page+1),D.fetchPhotos()))};function V(){if(0===D.selections.length)return void s.warning(o("Please select photos first"));const e={...q.value};if(e.ids=D.selections.map(e=>e.id),e.expired_at){const a=new Date(e.expired_at);e.expired_at=a.toISOString().slice(0,19).replace("T"," ")}J({body:e}).then(e=>{var a,t,l;if("error"===(null==(a=e.data)?void 0:a.status))return s.error(null==(t=e.data)?void 0:t.message);U.value=`${window.location.origin}/shares/${null==(l=e.data)?void 0:l.data.slug}`}).catch(()=>{s.error(o("Failed to create share"))})}function se(){m.copyText(U.value).then(()=>{s.success(o("Copy successful"))}).catch(()=>{s.error(o("Copy failed"))})}M(()=>D.shareModalActive,e=>{e&&(U.value="",q.value={type:"photo",ids:[],content:"",password:"",expired_at:null})});const oe=y.debounce(()=>{F({path:{id:z.value.id},body:{name:z.value.name,intro:z.value.intro,is_public:z.value.is_public}})},500);function ue(){var e;null==(e=_.value)||e.open()}function ce(){D.resetPhotos({q:"sort:latest",album_id:z.value.id})}function de(e){Q({path:{id:z.value.id},body:e.map(e=>e.id)}).then(()=>{s.success(o("Added successfully")),ce()})}return M(()=>z.value,()=>{g.value&&oe()},{deep:!0}),O(()=>{var e;D.clearGroups(),E({path:{id:Number(null==(e=t.params)?void 0:e.id)}}).then(e=>{var a;z.value=null==(a=e.data)?void 0:a.data,setTimeout(()=>{g.value=!0,ce()},50)})}),(e,r)=>(x(),T(u,{"toggle-header":!1,"show-footer":!1,"header-title":e.$t("Album Details"),"content-class":"bg-white dark:bg-[var(--n-color)]","on-scroll":R},{default:L(()=>[S(_e,{ref_key:"photoSelectorRef",ref:_,onOnSelect:de},null,512),S(re,{ref_key:"deleteRef",ref:$},null,512),S(ie,{ref_key:"shareRef",ref:j},null,512),S(h,{class:"max-w-full"},{default:L(()=>[w("div",xe,[w("div",ke,[S(ne)]),w("div",we,[S(k(B),{tertiary:"",type:"error",onClick:r[0]||(r[0]=()=>{return e=z.value,void(null==(a=$.value)||a.open(e,()=>{l.back(),s.success(o("Deleted successfully"))}));var e,a})},{icon:L(()=>[S(k(P),{icon:"fa-solid fa-trash",size:"sm"})]),_:1}),S(k(B),{tertiary:"",type:"default",onClick:r[1]||(r[1]=()=>{return e=z.value,void(null==(a=j.value)||a.open(e));var e,a})},{icon:L(()=>[S(k(P),{icon:"fa-solid fa-share",size:"sm"})]),_:1}),S(k(B),{secondary:"",onClick:ue},{icon:L(()=>[S(k(n),null,{default:L(()=>[S(k(P),{icon:"fa-solid fa-plus",size:"sm"})]),_:1})]),default:L(()=>[H(" "+A(e.$t("Add Photos")),1)]),_:1})])]),w("div",Se,[w("div",Pe,[S(k(c),{size:"large",value:z.value.name,"onUpdate:value":r[2]||(r[2]=e=>z.value.name=e),placeholder:e.$t("Add Title")},null,8,["value","placeholder"]),S(k(c),{resizable:"",type:"textarea",value:z.value.intro,"onUpdate:value":r[3]||(r[3]=e=>z.value.intro=e),placeholder:e.$t("Add Description")},null,8,["value","placeholder"]),w("div",$e,A(k(a)(z.value.created_at).format("L"))+" - "+A(e.$t("{count} items",{count:z.value.photo_count})),1),S(k(d),{value:z.value.is_public,"onUpdate:value":r[4]||(r[4]=e=>z.value.is_public=e),size:"large"},{checked:L(()=>[H(A(e.$t("Public")),1)]),unchecked:L(()=>[H(A(e.$t("Private")),1)]),_:1},8,["value"])]),w("div",je,[S(X)]),S(Y,null,{default:L(()=>{var e;return[S(Z),S(ee),S(ae),S(te),S(ie),S(be,{"album-id":Number(null==(e=k(t).params)?void 0:e.id)},null,8,["album-id"]),S(le)]}),_:1})])]),_:1}),S(k(W),{show:k(D).shareModalActive,"onUpdate:show":r[8]||(r[8]=e=>k(D).shareModalActive=e),title:e.$t("Share Photos"),preset:"card",size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto z-50"},{action:L(()=>[U.value?(x(),b("div",Ae,[S(k(c),{class:"grow select-all","default-value":U.value,readonly:""},null,8,["default-value"]),S(k(B),{tertiary:"",type:"primary",class:"shrink-0",onClick:se},{icon:L(()=>[S(k(P),{icon:"fa-solid fa-copy"})]),_:1})])):(x(),b("div",Ce,[S(k(B),{tertiary:"",onClick:V},{default:L(()=>[H(A(e.$t("Create Share Link")),1)]),_:1})]))]),default:L(()=>[w("div",ze,[S(k(p),{model:q.value,rules:I,disabled:Boolean(U.value)},{default:L(()=>[S(k(v),{label:e.$t("Share Description"),path:"content"},{default:L(()=>[S(k(c),{resizable:"",type:"textarea",value:q.value.content,"onUpdate:value":r[5]||(r[5]=e=>q.value.content=e)},null,8,["value"])]),_:1},8,["label"]),S(k(v),{label:e.$t("Password"),path:"password"},{default:L(()=>[S(k(c),{type:"password",value:q.value.password,"onUpdate:value":r[6]||(r[6]=e=>q.value.password=e)},null,8,["value"])]),_:1},8,["label"]),S(k(v),{label:e.$t("Expiration Time"),path:"expired_at"},{default:L(()=>[S(k(f),{value:q.value.expired_at,"onUpdate:value":r[7]||(r[7]=e=>q.value.expired_at=e),type:"datetime",class:"w-full",placeholder:e.$t("Select Expiration Time"),"is-date-disabled":e=>e<Date.now(),clearable:""},null,8,["value","placeholder","is-date-disabled"])]),_:1},8,["label"])]),_:1},8,["model","disabled"])])]),_:1},8,["show","title"])]),_:1},8,["header-title"]))}});export{Le as default};
