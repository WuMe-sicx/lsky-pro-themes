import{W as e,by as s,d as a,$ as l,bg as t,bz as i,a0 as r,aF as o,bA as n,a2 as u,c as d,aH as c,m as p,a as m,s as v,e as f,v as h,b as y,g as b,h as _,y as g,z as x,F as k,x as w,f as C,A as P,B as z,Q as j,N as $,_ as A,o as G,am as T,bB as S,ak as O,j as D,bC as N}from"./index-DKzf3TMO.js";import{a6 as B,P as E,N as H,I as M,K as R,a as V,_ as F,J as I,j as U,k as q,g as K,w as L,x as J}from"./Layout.vue_vue_type_script_setup_true_lang-BRRcuvRl.js";import{_ as Q}from"./Content.vue_vue_type_script_setup_true_lang-CGEjm_tA.js";import{_ as W}from"./Back.vue_vue_type_script_setup_true_lang-i2ZA4QCP.js";import{N as X,a as Y}from"./CollapseItem-BFU5dm0v.js";import{N as Z,a as ee}from"./ListItem-C_hNZPC8.js";import{N as se}from"./Checkbox-BBdeyiKG.js";import{N as ae}from"./Divider-oynq3jZ4.js";import{N as le}from"./Alert-DPCT-9KG.js";const te=e("collapse-transition",{width:"100%"},[s()]),ie=a({name:"CollapseTransition",props:Object.assign(Object.assign({},o.props),{show:{type:Boolean,default:!0},appear:Boolean,collapsed:{type:Boolean,default:void 0}}),inheritAttrs:!1,setup(e){const{mergedClsPrefixRef:s,inlineThemeDisabled:a,mergedRtlRef:l}=r(e),t=o("CollapseTransition","-collapse-transition",te,n,e,s),i=u("CollapseTransition",l,s),p=d(()=>void 0!==e.collapsed?e.collapsed:e.show),m=d(()=>{const{self:{bezier:e}}=t.value;return{"--n-bezier":e}}),v=a?c("collapse-transition",void 0,m,e):void 0;return{rtlEnabled:i,mergedShow:p,mergedClsPrefix:s,cssVars:a?void 0:m,themeClass:null==v?void 0:v.themeClass,onRender:null==v?void 0:v.onRender}},render(){return l(i,{appear:this.appear},{default:()=>{var e;if(this.mergedShow)return null===(e=this.onRender)||void 0===e||e.call(this),l("div",t({class:[`${this.mergedClsPrefix}-collapse-transition`,this.rtlEnabled&&`${this.mergedClsPrefix}-collapse-transition--rtl`,this.themeClass],style:this.cssVars},this.$attrs),this.$slots)}})}}),re={class:"flex gap-2 items-center"},oe={class:"flex gap-1"},ne={key:0,class:"text-sm text-gray-500 mb-3"},ue={class:"flex items-center justify-between"},de=["onClick"],ce={class:"flex items-center justify-between"},pe=["onClick"],me={key:0,class:"mt-4 px-2"},ve={class:"space-y-2"},fe={class:"font-medium"},he={class:"text-sm text-gray-500 mt-1"},ye=A(a({__name:"PermissionCard",props:{title:{},description:{},permissions:{},selectedPermissions:{},subGroups:{}},emits:["update:selectedPermissions"],setup(e,{emit:s}){const{t:a}=p(),l=e,t=s;m(!0);const i=m(!1),r=d(()=>l.permissions.every(e=>l.selectedPermissions.includes(e.value))),o=d(()=>l.permissions.some(e=>l.selectedPermissions.includes(e.value))&&!r.value),n=d(()=>l.permissions.filter(e=>l.selectedPermissions.includes(e.value)).length),u=e=>{const s=[...l.selectedPermissions],a=s.indexOf(e);-1===a?s.push(e):s.splice(a,1),t("update:selectedPermissions",s)},c=()=>{const e=[...l.selectedPermissions];l.permissions.forEach(s=>{e.includes(s.value)||e.push(s.value)}),t("update:selectedPermissions",e)},A=()=>{const e=l.permissions.map(e=>e.value),s=l.selectedPermissions.filter(s=>!e.includes(s));t("update:selectedPermissions",s)},G=()=>{i.value=!i.value},T=e=>{if(!l.subGroups||!l.subGroups[e])return!1;return l.subGroups[e].permissions.map(e=>e.value).every(e=>l.selectedPermissions.includes(e))},S=e=>{if(!l.subGroups||!l.subGroups[e])return!1;return l.subGroups[e].permissions.map(e=>e.value).some(e=>l.selectedPermissions.includes(e))&&!T(e)};return(s,d)=>(f(),v(x($),{title:e.title,class:"permission-card mb-4",size:"small",bordered:!0,segmented:{content:!0,footer:"soft"}},{"header-extra":h(()=>[C("div",re,[_(x(R),{value:n.value,max:99,"show-zero":!1,offset:[2,2]},{default:h(()=>[_(x(M),{type:r.value?"success":o.value?"warning":"default",size:"small",bordered:!1},{default:h(()=>[P(g(r.value?x(a)("All Selected"):o.value?x(a)("Partially Selected"):x(a)("None Selected")),1)]),_:1},8,["type"])]),_:1},8,["value"]),C("div",oe,[_(x(z),{size:"tiny",onClick:c,type:"primary",secondary:""},{default:h(()=>[P(g(x(a)("Select All")),1)]),_:1}),_(x(z),{size:"tiny",onClick:A,secondary:""},{default:h(()=>[P(g(x(a)("Cancel")),1)]),_:1}),_(x(z),{size:"tiny",onClick:G,tertiary:""},{default:h(()=>[P(g(i.value?x(a)("Hide Details"):x(a)("Show Details")),1)]),_:1})])])]),default:h(()=>[e.description?(f(),y("div",ne,g(e.description),1)):b("",!0),e.subGroups&&Object.keys(e.subGroups).length>0?(f(),v(x(X),{key:1,class:"mb-2"},{default:h(()=>[(f(!0),y(k,null,w(e.subGroups,(s,i)=>(f(),v(x(Y),{key:i,title:s.name},{"header-extra":h(()=>[C("div",{class:"flex gap-1 mr-2",onClick:d[0]||(d[0]=j(()=>{},["stop"]))},[_(x(z),{size:"tiny",onClick:e=>(e=>{if(!l.subGroups||!l.subGroups[e])return;const s=[...l.selectedPermissions];l.subGroups[e].permissions.forEach(e=>{s.includes(e.value)||s.push(e.value)}),t("update:selectedPermissions",s)})(i),type:"primary",secondary:"",disabled:T(i)},{default:h(()=>[P(g(x(a)("Select All")),1)]),_:1},8,["onClick","disabled"]),_(x(z),{size:"tiny",onClick:e=>(e=>{if(!l.subGroups||!l.subGroups[e])return;const s=l.subGroups[e].permissions.map(e=>e.value),a=l.selectedPermissions.filter(e=>!s.includes(e));t("update:selectedPermissions",a)})(i),secondary:"",disabled:!S(i)&&!T(i)},{default:h(()=>[P(g(x(a)("Cancel")),1)]),_:1},8,["onClick","disabled"])])]),default:h(()=>[_(x(Z),{hoverable:""},{default:h(()=>[(f(!0),y(k,null,w(s.permissions,s=>(f(),v(x(ee),{key:s.value},{default:h(()=>[C("div",ue,[C("div",{class:"flex items-center gap-2 flex-1 cursor-pointer",onClick:e=>u(s.value)},[_(x(se),{checked:e.selectedPermissions.includes(s.value)},null,8,["checked"]),_(x(B),{type:e.selectedPermissions.includes(s.value)?"primary":void 0},{default:h(()=>[P(g(s.label),1)]),_:2},1032,["type"])],8,de),s.detail?(f(),v(x(E),{key:0,trigger:"hover",placement:"top"},{trigger:h(()=>[_(x(H),{class:"cursor-help text-gray-400 hover:text-primary"},{default:h(()=>[...d[1]||(d[1]=[C("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"1em",height:"1em"},[C("path",{fill:"currentColor",d:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"})],-1)])]),_:1})]),default:h(()=>[P(" "+g(s.detail),1)]),_:2},1024)):b("",!0)])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1})):(f(),v(x(Z),{key:2,hoverable:""},{default:h(()=>[(f(!0),y(k,null,w(e.permissions,s=>(f(),v(x(ee),{key:s.value},{default:h(()=>[C("div",ce,[C("div",{class:"flex items-center gap-2 flex-1 cursor-pointer",onClick:e=>u(s.value)},[_(x(se),{checked:e.selectedPermissions.includes(s.value)},null,8,["checked"]),_(x(B),{type:e.selectedPermissions.includes(s.value)?"primary":void 0},{default:h(()=>[P(g(s.label),1)]),_:2},1032,["type"])],8,pe),s.detail?(f(),v(x(E),{key:0,trigger:"hover",placement:"top"},{trigger:h(()=>[_(x(H),{class:"cursor-help text-gray-400 hover:text-primary"},{default:h(()=>[...d[2]||(d[2]=[C("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"1em",height:"1em"},[C("path",{fill:"currentColor",d:"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"})],-1)])]),_:1})]),default:h(()=>[P(" "+g(s.detail),1)]),_:2},1024)):b("",!0)])]),_:2},1024))),128))]),_:1})),_(x(ie),null,{default:h(()=>[i.value?(f(),y("div",me,[_(x(ae),null,{default:h(()=>[P(g(x(a)("Permission Details")),1)]),_:1}),C("div",ve,[(f(!0),y(k,null,w(e.permissions,e=>(f(),y("div",{key:`detail-${e.value}`,class:"p-2 rounded hover:bg-gray-50"},[C("div",fe,[P(g(e.label)+" ",1),_(x(M),{size:"small"},{default:h(()=>[P(g(e.value),1)]),_:2},1024)]),C("div",he,g(e.detail),1)]))),128))])])):b("",!0)]),_:1})]),_:1},8,["title"]))}}),[["__scopeId","data-v-fd9fae23"]]),be={class:"space-x-2"},_e={class:"flex flex-col gap-4"},ge={class:"flex justify-between items-center mb-2 flex-wrap gap-2"},xe={class:"flex gap-2"},ke={class:"flex flex-col space-y-4"},we={class:"flex justify-between space-x-2"},Ce=A(a({__name:"CreateView",setup(e){const s=V(),a=D(),{t:l}=p(),t=m(!1),i=m({abilities:[]}),r=m(null),o=m(!1),n=m(""),u=m([]),d=m({}),c=m({}),v=m({}),b={name:{type:"string",required:!0,trigger:["blur","input"],message:l("Please enter the token name")},expires_at:{type:"string",required:!1,trigger:["blur","input"],message:l("Please select the token expiration time")}},A=()=>{i.value.abilities=u.value.map(e=>e.value)},E=()=>{i.value.abilities=[]},H=e=>v.value&&v.value[e]&&Object.keys(v.value[e]).length>0,M=e=>{var s;return(null==(s=v.value)?void 0:s[e])||{}},R=e=>({user:"用户资料、令牌、角色组和容量等用户相关权限",content:"相册、照片、分享和图片上传等内容管理权限",service:"工单和订单等服务相关权限",integration:"OAuth绑定和内容探索等集成功能权限",basic:"基础功能权限，所有令牌默认拥有",oauth:"OAuth第三方账号绑定相关权限",explore:"内容探索和浏览相关权限",upload:"图片上传相关权限"}[e]||""),X=async e=>{var a;e.preventDefault(),null==(a=r.value)||a.validate(async e=>{var a,r,u,d,c;if(!e){t.value=!0;try{const e=Array.isArray(i.value.abilities)&&i.value.abilities.length>0?[...i.value.abilities]:["*"],l={name:i.value.name,abilities:e};i.value.expires_at&&(l.expires_at=i.value.expires_at);const t=new FormData;t.append("name",l.name),l.expires_at&&t.append("expires_at",l.expires_at);for(const s of l.abilities)t.append("abilities[]",s);const d=await N({body:t});if("error"===(null==(a=d.data)?void 0:a.status))return s.error(null==(r=d.data)?void 0:r.message);n.value=(null==(u=d.data)?void 0:u.data.token)||"",o.value=!0}catch(p){s.error((null==(c=null==(d=p.response)?void 0:d.data)?void 0:c.message)||l("Failed to create token"))}finally{t.value=!1}}})},Y=()=>{o.value=!1,a.push("/user/tokens")},Z=()=>{J.copyText(n.value).then(()=>{s.success(l("Copy successful")),setTimeout(()=>{a.push("/user/tokens")},500)}).catch(()=>{s.error(l("Copy failed"))})};return G(()=>{(async()=>{var e,a,t,i,r;try{const s=await S();if("success"===(null==(e=s.data)?void 0:e.status)){const e=(null==(t=null==(a=s.data)?void 0:a.data)?void 0:t.permissions)||[],l=(null==(r=null==(i=s.data)?void 0:i.data)?void 0:r.groups)||{};u.value=e,c.value=l;const o={};e.forEach(e=>{const s=e.category||e.value.split(":")[0];o[s]||(o[s]=[]),o[s].push(e)}),d.value=o;const n={};Object.entries(l).forEach(([s,a])=>{n[s]={},Object.entries(a).forEach(([a,l])=>{const t=l.map(s=>e.find(e=>e.value===s)).filter(e=>void 0!==e);t.length>0&&(n[s][a]={name:a,permissions:t})})}),v.value=n}}catch(o){s.error(l("Failed to get permissions"))}})()}),(e,s)=>(f(),y(k,null,[_(F,{"header-title":e.$t("Create Token"),"toggle-header":!1,"show-footer":!1},{default:h(()=>[_(Q,{class:"mx-auto p-4 md:p-10 space-y-10 overflow-hidden"},{default:h(()=>[_(x(I),{vertical:""},{default:h(()=>[C("div",be,[_(W,{to:"/user/tokens"})]),_(x($),null,{default:h(()=>[_(x(U),{ref_key:"formRef",ref:r,"label-placement":"left","label-width":200,"label-align":"left",model:i.value,rules:b,onSubmit:j(X,["prevent"]),class:"form-container"},{default:h(()=>[_(x(q),{label:e.$t("Token Name"),path:"name"},{default:h(()=>[_(x(K),{value:i.value.name,"onUpdate:value":s[0]||(s[0]=e=>i.value.name=e),maxlength:20,placeholder:e.$t("Please enter the token name")},null,8,["value","placeholder"])]),_:1},8,["label"]),_(x(q),{label:e.$t("Token Expires Time"),path:"expires_at"},{default:h(()=>[_(x(L),{"formatted-value":i.value.expires_at,"onUpdate:formattedValue":s[1]||(s[1]=e=>i.value.expires_at=e),type:"datetime",class:"w-full","is-date-disabled":e=>e<Date.now(),"value-format":"yyyy-MM-dd HH:mm:ss",clearable:"",placeholder:e.$t("Please select the token expiration time")},null,8,["formatted-value","is-date-disabled","placeholder"])]),_:1},8,["label"]),_(x(q),{label:e.$t("Token Permissions"),path:"abilities"},{default:h(()=>[C("div",_e,[_(x(le),{type:"info","show-icon":""},{default:h(()=>[P(g(e.$t("The token created without choosing any permissions will have full access rights. Please select the permissions carefully based on your needs.")),1)]),_:1}),C("div",ge,[_(x(B),null,{default:h(()=>[P(g(e.$t("Permissions")),1)]),_:1}),C("div",xe,[_(x(z),{size:"small",onClick:A},{default:h(()=>[P(g(e.$t("Select All")),1)]),_:1}),_(x(z),{size:"small",onClick:E},{default:h(()=>[P(g(e.$t("Deselect All")),1)]),_:1})])]),_(x(I),{vertical:""},{default:h(()=>[(f(!0),y(k,null,w(d.value,(e,a)=>{return f(),y("div",{key:a},[_(ye,{title:(l=a,{user:"用户管理",content:"内容管理",service:"服务管理",integration:"集成功能",basic:"基础功能",oauth:"OAuth认证",explore:"探索功能",upload:"上传功能"}[l]||l),description:R(a),permissions:e,"selected-permissions":i.value.abilities,"sub-groups":H(a)?M(a):void 0,"onUpdate:selectedPermissions":s[2]||(s[2]=e=>i.value.abilities=e)},null,8,["title","description","permissions","selected-permissions","sub-groups"])]);var l}),128)),_(x(le),{type:"info",class:"mt-4"},{default:h(()=>[P(g(e.$t("Permission Principle")),1)]),_:1})]),_:1})])]),_:1},8,["label"]),_(x(q),{class:"flex justify-end"},{default:h(()=>[_(x(z),{"attr-type":"submit",type:"primary",loading:t.value},{default:h(()=>[P(g(e.$t("Confirm Creation")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})]),_:1},8,["header-title"]),_(x(T),{show:o.value,"onUpdate:show":s[3]||(s[3]=e=>o.value=e),preset:"card",title:e.$t("Created successfully"),size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto max-h-[90vh] overflow-auto"},{action:h(()=>[C("div",we,[_(x(z),{tertiary:"",onClick:Y},{default:h(()=>[P(g(e.$t("Close")),1)]),_:1}),_(x(z),{tertiary:"",type:"primary",class:"shrink-0",onClick:Z},{icon:h(()=>[_(x(O),{icon:"fa-solid fa-copy"})]),_:1})])]),default:h(()=>[C("div",ke,[_(x(le),{type:"warning","show-icon":""},{default:h(()=>[P(g(e.$t("Please keep it safe. This Token will no longer be displayed after the window is closed.")),1)]),_:1}),_(x(K),{class:"select-all",value:n.value,readonly:""},null,8,["value"])])]),_:1},8,["show","title"])],64))}}),[["__scopeId","data-v-457aaef6"]]);export{Ce as default};
