import{az as e,cj as t,ck as o,d as a,m as s,a as i,s as r,v as l,z as n,am as c,e as u,f as d,h as p,A as h,y as v,B as f,cl as k,cm as m,cn as g,co as w,c as b,k as y,b as x,F as _,af as z,g as C,n as j,Q as U,ak as L,av as B,j as I,_ as A}from"./index-DKzf3TMO.js";import{P as R}from"./WaterfallLayout-B-kJbIBO.js";import{a as q,k as M,g as P,j as $,d as E}from"./Layout.vue_vue_type_script_setup_true_lang-BRRcuvRl.js";const O=e("explore",()=>({photoLiked:async function(e){return await t({path:{id:e}})},photoUnlinked:async function(e){return await o({path:{id:e}})}})),S={class:"flex flex-col space-y-4"},V={class:"flex justify-end"},F=a({__name:"Report",props:{type:{type:String,required:!0}},setup(e,{expose:t}){const{t:o}=s(),a=e,b={album:o("Album"),photo:o("Photo"),user:o("User"),share:o("Share")},y=q(),x=i(!1),_=i(),z=i({content:""}),C={},j=i({});async function U(){var e,t;const s={photo:w,album:g,user:m,share:k},i=await s[a.type]({body:{content:z.value.content},...j.value});if("error"===(null==(e=i.data)?void 0:e.status))return y.error(null==(t=i.data)?void 0:t.message);y.success(o("Report submitted successfully. Thank you for your feedback!")),L()}function L(){x.value=!1}return t({open:function(e){j.value=e,x.value=!0},close:L}),(t,o)=>(u(),r(n(c),{show:x.value,"onUpdate:show":o[1]||(o[1]=e=>x.value=e),title:`举报${b[e.type]}`,preset:"card",size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto"},{action:l(()=>[d("div",V,[p(n(f),{tertiary:"",onClick:U},{default:l(()=>[h(v(t.$t("Confirm Report")),1)]),_:1})])]),default:l(()=>[d("div",S,[p(n($),{ref_key:"reportFormRef",ref:_,model:z.value,rules:C},{default:l(()=>[p(n(M),{label:t.$t("Please describe the reason for reporting"),path:"content"},{default:l(()=>[p(n(P),{resizable:"",type:"textarea",value:z.value.content,"onUpdate:value":o[0]||(o[0]=e=>z.value.content=e)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["show","title"]))}}),H={key:0,class:"absolute inset-0 flex items-center justify-center bg-zinc-100 dark:bg-zinc-800"},T={key:0,class:"w-6 h-6"},D={key:1,class:"text-zinc-400 dark:text-zinc-500"},N=["src","alt"],Q=["fill"],W={class:"flex items-center justify-between"},G=["src","alt"],J={class:"text-white text-sm font-medium truncate max-w-[120px] hover:underline"},K=["href"],X={class:"flex gap-2"},Y=["onClick"],Z=["onClick"],ee=["src","alt"],te={class:"text-white text-sm font-medium"},oe={class:"space-y-6"},ae={key:0},se=["src","alt"],ie={class:"min-w-0"},re={class:"text-sm font-medium text-zinc-900 dark:text-zinc-100 truncate"},le={class:"text-xs text-zinc-500 dark:text-zinc-400"},ne=A(a({__name:"ExploreImage",props:{photo:{type:Object,required:!0,default:()=>{}},photos:{type:Array,required:!1,default:()=>[]},showUserInfo:{type:Boolean,required:!1,default:()=>!0},showLike:{type:Boolean,required:!1,default:()=>!0},showReport:{type:Boolean,required:!1,default:()=>!0}},setup(e){const t=e,o=i(!1),a=i(null),s=i(),c={showThumbnails:!0,showDrawer:!0,drawerConfig:{defaultOpen:!0,title:"图片信息"},controls:{showClose:!0,showInfo:!0,showNavigation:!0}},h=b(()=>(t.photos.length>0?t.photos:[t.photo]).map(e=>({id:e.id,src:e.public_url||e.src,thumbnail:e.thumbnail_url,name:e.name,width:e.width,height:e.height,size:e.size,extension:e.extension,tags:e.tags,user:e.user,is_liked:e.is_liked,is_public:e.is_public,created_at:e.created_at,updated_at:e.updated_at}))),f=i(!0),k=i(!1),m=O(),g=I(),w=y();function A(){if(t.photo.is_liked){if(m.photoUnlinked(t.photo.id),t.photo.is_liked=!1,t.photos.length>0){const e=t.photos.find(e=>e.id===t.photo.id);e&&(e.is_liked=!1)}}else if(m.photoLiked(t.photo.id),t.photo.is_liked=!0,t.photos.length>0){const e=t.photos.find(e=>e.id===t.photo.id);e&&(e.is_liked=!0)}}function q(){g.push(`/explore/@${t.photo.user.username}`).then(()=>w.setSidebarOpen(!1))}function M(){s.value=t.photo.id,o.value=!0}function P(){f.value=!1,k.value=!1}function $(){f.value=!1,k.value=!0}return(e,i)=>(u(),x(_,null,[d("div",{class:"group relative overflow-hidden w-full cursor-zoom-in bg-zinc-100 dark:bg-zinc-800 rounded-lg",onClick:M,style:z({paddingBottom:(t.photo.width&&t.photo.height?t.photo.height/t.photo.width*100:75)+"%"})},[f.value||k.value?(u(),x("div",H,[f.value?(u(),x("div",T,[...i[4]||(i[4]=[d("svg",{class:"animate-spin text-zinc-300 dark:text-zinc-600",fill:"none",viewBox:"0 0 24 24"},[d("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),d("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):k.value?(u(),x("div",D,[...i[5]||(i[5]=[d("svg",{class:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])])):C("",!0)])):C("",!0),d("img",{src:t.photo.thumbnail_url,alt:t.photo.name,class:j(["absolute inset-0 w-full h-full object-cover transition-transform duration-500 group-hover:scale-[1.03]",{"opacity-0":f.value||k.value,"opacity-100":!f.value&&!k.value}]),loading:"lazy",onLoad:P,onError:$},null,42,N),d("div",{class:j(["absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300",{"pointer-events-none":f.value||k.value}])},null,2),t.showLike?(u(),x("div",{key:1,class:j(["absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity duration-300",{"pointer-events-none":f.value||k.value}])},[d("button",{onClick:U(A,["stop"]),class:j(["flex items-center justify-center w-8 h-8 rounded-md bg-white/90 dark:bg-zinc-800/90 hover:bg-white dark:hover:bg-zinc-700 shadow-sm transition-all",{"!bg-red-50 dark:!bg-red-900/30":t.photo.is_liked}])},[(u(),x("svg",{class:j(["w-4 h-4 transition-colors",t.photo.is_liked?"text-red-500 fill-red-500":"text-zinc-600 dark:text-zinc-300"]),viewBox:"0 0 24 24",fill:t.photo.is_liked?"currentColor":"none",stroke:"currentColor","stroke-width":"2"},[...i[6]||(i[6]=[d("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"},null,-1)])],10,Q))],2)],2)):C("",!0),t.showUserInfo?(u(),x("div",{key:2,class:j(["absolute bottom-0 left-0 right-0 p-3 opacity-0 group-hover:opacity-100 transition-opacity duration-300",{"pointer-events-none":f.value||k.value}])},[d("div",W,[d("div",{class:"flex items-center gap-2 min-w-0",onClick:U(q,["stop"])},[d("img",{src:n(E).getUserAvatar(t.photo.user.avatar_url),alt:t.photo.user.name,class:"w-8 h-8 rounded-full object-cover ring-2 ring-white/20"},null,8,G),d("span",J,v(t.photo.user.name),1)]),t.photo.public_url?(u(),x("a",{key:0,href:t.photo.public_url,target:"_blank",onClick:i[0]||(i[0]=U(()=>{},["stop"])),class:"flex items-center justify-center w-8 h-8 rounded-md bg-white/90 hover:bg-white transition-colors"},[...i[7]||(i[7]=[d("svg",{class:"w-4 h-4 text-zinc-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[d("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,K)):C("",!0)])],2)):C("",!0)],4),p(n(R),{show:o.value,"onUpdate:show":i[1]||(i[1]=e=>o.value=e),"current-photo-id":s.value,"onUpdate:currentPhotoId":i[2]||(i[2]=e=>s.value=e),photos:h.value,config:c,"onPhoto:change":i[3]||(i[3]=e=>{})},{"top-right":l(({photo:e})=>[d("div",X,[t.showLike?(u(),x("button",{key:0,class:"viewer-button",onClick:o=>function(e){if(e.is_liked){if(m.photoUnlinked(e.id),e.is_liked=!1,t.photos.length>0){const o=t.photos.find(t=>t.id===e.id);o&&(o.is_liked=!1)}t.photo.id===e.id&&(t.photo.is_liked=!1)}else{if(m.photoLiked(e.id),e.is_liked=!0,t.photos.length>0){const o=t.photos.find(t=>t.id===e.id);o&&(o.is_liked=!0)}t.photo.id===e.id&&(t.photo.is_liked=!0)}}(e)},[p(n(L),{icon:e.is_liked?"fa-solid fa-heart":"fa-regular fa-heart",class:j(["text-sm",{"text-red-500":e.is_liked,"text-white":!e.is_liked}])},null,8,["icon","class"])],8,Y)):C("",!0),t.showReport?(u(),x("button",{key:1,class:"viewer-button",onClick:t=>{return o=e,void(null==(s=a.value)||s.open({path:{id:o.id}}));var o,s}},[p(n(L),{icon:"fa-solid fa-flag",class:"text-sm text-white"})],8,Z)):C("",!0)])]),"top-left":l(({photo:e})=>[t.showUserInfo&&e.user?(u(),x("div",{key:0,class:"flex items-center gap-2 cursor-pointer bg-black/40 hover:bg-black/50 backdrop-blur-sm rounded-full px-3 py-2 transition-colors",onClick:q},[d("img",{src:n(E).getUserAvatar(e.user.avatar_url),alt:e.user.name,class:"w-6 h-6 rounded-full object-cover"},null,8,ee),d("span",te,v(e.user.name),1)])):C("",!0)]),"drawer-content":l(({photo:e})=>[d("div",oe,[t.showUserInfo&&e.user?(u(),x("div",ae,[i[8]||(i[8]=d("h4",{class:"text-xs font-medium text-zinc-500 dark:text-zinc-400 uppercase tracking-wide mb-3"},"上传者",-1)),d("div",{class:"flex items-center gap-3 p-3 rounded-lg bg-zinc-50 dark:bg-zinc-800/50 cursor-pointer hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors",onClick:q},[d("img",{src:n(E).getUserAvatar(e.user.avatar_url),alt:e.user.name,class:"w-10 h-10 rounded-full object-cover"},null,8,se),d("div",ie,[d("div",re,v(e.user.name),1),d("div",le,"@"+v(e.user.username),1)])])])):C("",!0)])]),_:1},8,["show","current-photo-id","photos"]),(u(),r(B,{to:"body"},[p(F,{ref_key:"reportRef",ref:a,type:"photo"},null,512)]))],64))}}),[["__scopeId","data-v-348846a8"]]);export{ne as E,F as _};
