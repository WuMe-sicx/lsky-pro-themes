import{a as e,_ as a,r as l,g as t,N as s,c as o,d as r}from"./Layout.vue_vue_type_script_setup_true_lang-BRRcuvRl.js";import{_ as n}from"./Content.vue_vue_type_script_setup_true_lang-CGEjm_tA.js";import{d as u,b as i,e as d,f as c,l as v,m as f,a as p,o as m,aV as _,H as w,c as g,s as x,v as h,aW as b,h as k,z as y,N as T,A as j,y as N,g as $,x as C,F as S,B as z,aX as I}from"./index-DKzf3TMO.js";import{_ as R}from"./Back.vue_vue_type_script_setup_true_lang-i2ZA4QCP.js";import{N as A,a as D}from"./CollapseItem-BFU5dm0v.js";import{N as L,a as U}from"./DescriptionsItem-CDAJ72Yx.js";import{N as B}from"./InfiniteScroll-BYFnNaBd.js";import{N as H}from"./Spin-DZKmp4ei.js";const M={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},P=[c("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 244l144-144l144 144"},null,-1),c("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 120v292"},null,-1)],V=u({name:"ArrowUpOutline",render:function(e,a){return d(),i("svg",M,P)}}),q={class:"flex flex-col space-y-2 h-full"},F={class:"flex-none space-x-2"},G={key:0,class:"flex space-x-2 overflow-hidden mb-5"},K={class:"flex flex-col items-end space-y-1 grow"},O={class:"text-gray-500 text-xs"},Q={class:"flex-none w-fit inline-block bg-[#20b2e5] text-white overflow-hidden break-all p-2 rounded-lg md:max-w-[80%]"},W={key:1,class:"flex space-x-2 overflow-hidden mb-5"},X={class:"flex flex-col space-y-1 grow"},E={class:"text-gray-500 text-xs"},J={class:"flex-none w-fit inline-block bg-gray-200 dark:bg-gray-700 overflow-hidden break-all p-2 rounded-lg md:max-w-[80%]"},Y={class:"shrink-0 w-full mt-5"},Z=u({__name:"DetailView",setup(u){const M=w(),P=e(),Z=v(),{t:ee}=f(),ae=p({}),le=p(!0),te=p(0),se=p([]),oe=p(!1),re=p(),ne=p("");function ue(){setTimeout(()=>{var e,a,l,t,s;null==(s=null==(e=re.value)?void 0:e.scrollbarInstRef)||s.scrollTo({top:(null==(t=null==(l=null==(a=re.value)?void 0:a.scrollbarInstRef)?void 0:l.contentRef)?void 0:t.scrollHeight)||0,behavior:"smooth"})},50)}async function ie(){var e,a,l,t;if(!ne.value)return;const s=await I({path:{issue_no:M.params.issue_no.toString()},body:{content:ne.value,is_notify:!0}});if("error"===(null==(e=s.data)?void 0:e.status))return P.error(null==(a=s.data)?void 0:a.message);se.value.push({content:ne.value,created_at:new Date,user:{avatar:null==(l=Z.profile)?void 0:l.avatar_url,name:null==(t=Z.profile)?void 0:t.name}}),ne.value="",ue()}m(async()=>{var e,a,l;const t=await _({path:{issue_no:M.params.issue_no.toString()}});if("error"===(null==(e=t.data)?void 0:e.status))return P.error(null==(a=t.data)?void 0:a.message);ae.value=(null==(l=t.data)?void 0:l.data)||{},await async function(){var e,a,l;if(oe.value)return;te.value++,le.value=!0;const t=await b({path:{issue_no:M.params.issue_no.toString()},query:{page:1,per_page:9999}});se.value.push(...(null==(e=t.data)?void 0:e.data.data)||[]),le.value=!1,oe.value=(null==(a=t.data)?void 0:a.data.current_page)===(null==(l=t.data)?void 0:l.data.last_page),ue()}()});const de=g(()=>({low:ee("Low"),medium:ee("Medium"),high:ee("High")})),ce=g(()=>({in_progress:ee("Processing"),completed:ee("Completed")}));return(e,u)=>(d(),x(a,{"header-title":e.$t("Ticket Details"),"toggle-header":!1,"show-footer":!1},{default:h(()=>[k(n,{class:"mx-auto p-4 md:p-10 space-y-10 h-full"},{default:h(()=>[c("div",q,[c("div",F,[k(R,{to:"/user/tickets"})]),k(y(T),null,{default:h(()=>[k(y(A),{accordion:"","default-expanded-names":"info"},{default:h(()=>[k(y(D),{title:e.$t("Ticket Information"),name:"info"},{default:h(()=>[k(y(L),{size:"small",bordered:""},{default:h(()=>[k(y(U),{label:e.$t("Ticket Number")},{default:h(()=>[j(N(ae.value.issue_no),1)]),_:1},8,["label"]),k(y(U),{label:e.$t("Ticket Title")},{default:h(()=>[j(N(ae.value.title),1)]),_:1},8,["label"]),k(y(U),{label:e.$t("Ticket Level")},{default:h(()=>[j(N(de.value[ae.value.level]),1)]),_:1},8,["label"]),k(y(U),{label:e.$t("Ticket Status")},{default:h(()=>[j(N(ce.value[ae.value.status]),1)]),_:1},8,["label"]),k(y(U),{label:e.$t("Creation Time")},{default:h(()=>[j(N(y(l)(ae.value.created_at).format("L")),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["title"])]),_:1})]),_:1}),k(y(T),{class:"grow w-full overflow-hidden","content-class":"flex flex-col overflow-hidden"},{default:h(()=>[k(y(B),{ref_key:"infiniteScrollRef",ref:re,class:"grow w-full"},{default:h(()=>[le.value?(d(),x(y(H),{key:0,size:"small",class:"w-full my-10"})):$("",!0),(d(!0),i(S,null,C(se.value,e=>{var a;return d(),i(S,null,[e.user.id==(null==(a=y(Z).profile)?void 0:a.id)?(d(),i("div",G,[c("div",K,[c("p",null,[c("span",O,N(y(l)(e.created_at).fromNow()),1),j(" "+N(e.user.name),1)]),c("p",Q,N(e.content),1)]),k(y(o),{class:"shrink-0",round:"",src:y(r).getUserAvatar(e.user.avatar_url)},null,8,["src"])])):(d(),i("div",W,[k(y(o),{class:"shrink-0",round:"",src:y(r).getUserAvatar(e.user.avatar_url)},null,8,["src"]),c("div",X,[c("p",null,[j(N(e.user.name)+" ",1),c("span",E,N(y(l)(e.created_at).fromNow()),1)]),c("p",J,N(e.content),1)])]))],64)}),256))]),_:1},512),c("div",Y,[k(y(t),{value:ne.value,"onUpdate:value":u[0]||(u[0]=e=>ne.value=e),size:"large",type:"textarea",autosize:{minRows:1,maxRows:4},class:"w-full",placeholder:"completed"===ae.value.status?e.$t("Ticket Completed"):e.$t("Please describe your problem"),disabled:"completed"===ae.value.status},{suffix:h(()=>[k(y(z),{strong:"",secondary:"",circle:"",type:"primary",size:"small",onClick:ie,disabled:"completed"===ae.value.status||""==ne.value},{icon:h(()=>[k(y(s),{size:14,component:y(V)},null,8,["component"])]),_:1},8,["disabled"])]),_:1},8,["value","placeholder","disabled"])])]),_:1})])]),_:1})]),_:1},8,["header-title"]))}});export{Z as default};
