import{d as e,bW as a,aO as l,m as t,a as u,c as r,o as i,s,z as o,v as d,f as n,h as c,af as v,n as p,b as f,B as h,A as m,y,bX as b,e as g,I as k,i as z,g as C,F as V,bV as _,u as S,bS as w}from"./index-DKzf3TMO.js";import{a as $,f as q,g as x,k as M,l as P}from"./Layout.vue_vue_type_script_setup_true_lang-BRRcuvRl.js";const U={class:"flex items-center w-full"},I=["src"],E=e({__name:"CaptchaInput",props:a({disabled:{type:Boolean,default:!1},size:{type:String,default:()=>"medium"}},{captcha:{default:""},captchaModifiers:{},captchaKey:{default:""},captchaKeyModifiers:{}}),emits:["update:captcha","update:captchaKey"],setup(e){const a=e,k=l(e,"captcha"),z=l(e,"captchaKey"),{t:C}=t(),V=$(),_=u(""),S=u(!1),w=u(!1),M=u(0),P=r(()=>{switch(a.size){case"small":return"28px";case"large":return"40px";default:return"34px"}}),E=async(e=!1)=>{try{S.value=!0,w.value=!1,e||(M.value=0);const l=(await b()).data;if(!(l&&l.data&&l.data.img))throw new Error("Invalid response structure");{const e=(a=l.data.img)?a.startsWith("data:image/")?a:`data:image/png;base64,${a}`:"";_.value=e,z.value=l.data.key,k.value="",M.value=0}}catch(l){if(M.value<3&&!e)return M.value++,void setTimeout(()=>E(!0),1e3);w.value=!0,V.error(C("Failed to load captcha"))}finally{S.value=!1}var a},B=()=>{w.value=!1},K=()=>{V.error(C("Failed to load captcha image")),_.value="",w.value=!0};return i(()=>{E()}),(e,l)=>(g(),s(o(q),null,{default:d(()=>[n("div",U,[c(o(x),{value:k.value,"onUpdate:value":l[0]||(l[0]=e=>k.value=e),placeholder:e.$t("Please enter captcha"),disabled:a.disabled,size:a.size,class:"flex-1"},null,8,["value","placeholder","disabled","size"]),n("div",{class:p(["ml-2 flex items-center cursor-pointer",{"opacity-50":S.value}]),onClick:l[2]||(l[2]=()=>E(!1)),style:v({height:P.value})},[_.value?(g(),f("div",{key:0,class:"overflow-hidden rounded-md border border-[#d9d9d9] dark:border-[#383838] h-full bg-gray-50 dark:bg-gray-800",style:v({minHeight:P.value,minWidth:"80px"})},[n("img",{src:_.value,alt:"captcha",class:"h-full w-full object-contain",style:v({maxHeight:P.value,minHeight:P.value,display:"block"}),onLoad:B,onError:K,loading:"eager"},null,44,I)],4)):(g(),s(o(h),{key:1,onClick:l[1]||(l[1]=()=>E(!1)),loading:S.value,size:a.size,class:"h-full"},{default:d(()=>[m(y(w.value||M.value>0?e.$t("Retry"):e.$t("Load Captcha")),1)]),_:1},8,["loading","size"]))],6)])]),_:1}))}}),B=e({__name:"EmailVerifyInput",props:a({event:{type:String,required:!0},size:{type:String,default:()=>"medium"},modelValue:{type:String,default:void 0},disabled:{type:Boolean,default:!1},requireVerify:{type:Boolean,default:!0}},{email:{default:""},emailModifiers:{},code:{default:""},codeModifiers:{}}),emits:["update:email","update:code"],setup(e){const a=e,i=l(e,"email"),n=l(e,"code"),v=u(""),p=u("");k(()=>a.modelValue,e=>{e&&e!==i.value&&(i.value=e)},{immediate:!0});const{t:b}=t(),S=$(),w=u(b("Send Email Verification Code")),P=u(!1),U=r(()=>a.modelValue&&a.modelValue.length>0||i.value.length>0),I=async()=>{var e;const l=a.modelValue||i.value.toString();if(!U.value)return S.error(b("Please enter your email first"));if(!v.value)return S.error(b("Please enter captcha"));if(!p.value)return S.error(b("Captcha key is missing, please refresh the captcha"));const t=await _({body:{event:a.event,email:l,captcha:v.value,captcha_key:p.value}});"success"===(null==(e=t.data)?void 0:e.status)?(()=>{let e=60;P.value=!0;const a=setInterval(()=>{e--,w.value=b("Resend after {seconds} seconds",{seconds:e}),e<=0&&(P.value=!1,w.value=b("Send Email Verification Code"),clearInterval(a))},1e3)})():S.error(t.data.message)};return(l,t)=>a.disabled?z(l.$slots,"default",{key:0,sendVerifyCode:I,btnDisabled:P.value,btnText:w.value}):(g(),f(V,{key:1},[c(o(M),{label:l.$t("Email"),"show-require-mark":""},{default:d(()=>[c(o(q),null,{default:d(()=>[c(o(x),{value:i.value,"onUpdate:value":t[0]||(t[0]=e=>i.value=e),"input-props":{type:"email",required:!0},placeholder:l.$t("Please enter your email"),size:a.size},null,8,["value","placeholder","size"])]),_:1})]),_:1},8,["label"]),e.requireVerify?(g(),f(V,{key:0},[U.value?(g(),s(o(M),{key:0,label:l.$t("Captcha"),"show-require-mark":""},{default:d(()=>[c(E,{captcha:v.value,"onUpdate:captcha":t[1]||(t[1]=e=>v.value=e),"captcha-key":p.value,"onUpdate:captchaKey":t[2]||(t[2]=e=>p.value=e),size:a.size},null,8,["captcha","captcha-key","size"])]),_:1},8,["label"])):C("",!0),v.value?(g(),s(o(M),{key:1,label:l.$t("Email Verification Code"),"show-require-mark":""},{default:d(()=>[c(o(x),{value:n.value,"onUpdate:value":t[3]||(t[3]=e=>n.value=e),"input-props":{required:!0},placeholder:l.$t("Please enter the email verification code"),size:a.size},{suffix:d(()=>[c(o(h),{text:"",type:"info",onClick:I,disabled:P.value||!a.modelValue&&!i.value||U.value&&!v.value},{default:d(()=>[m(y(w.value),1)]),_:1},8,["disabled"])]),_:1},8,["value","placeholder","size"])]),_:1},8,["label"])):C("",!0)],64)):C("",!0)],64))}}),K=e({__name:"PhoneVerifyInput",props:a({event:{type:String,required:!0},size:{type:String,default:()=>"medium"},modelValue:{type:String,default:void 0},modelValueCountryCode:{type:String,default:void 0},disabled:{type:Boolean,default:!1},requireVerify:{type:Boolean,default:!0}},{countryCode:{default:"cn"},countryCodeModifiers:{},phone:{default:""},phoneModifiers:{},code:{default:""},codeModifiers:{}}),emits:["update:countryCode","update:phone","update:code"],setup(e){const a=e,i=l(e,"countryCode"),n=l(e,"phone"),v=l(e,"code"),p=u(""),b=u("");k(()=>a.modelValue,e=>{e&&e!==n.value&&(n.value=e)},{immediate:!0}),k(()=>a.modelValueCountryCode,e=>{e&&e!==i.value&&(i.value=e)},{immediate:!0});const{t:_}=t(),U=$(),I=S(),B=u(_("Send SMS Verification Code")),K=u(!1),j=r(()=>a.modelValue&&a.modelValue.length>0||n.value.length>0),F=I.getSelectOptionCountryCodes(),H=e=>{var a,l;return(null==(l=null==(a=e.option.label)?void 0:a.toString())?void 0:l.match(/^\+\d+/))||""},L=async()=>{var e;const l=a.modelValue||n.value.toString(),t=a.modelValueCountryCode||i.value.toString();if(!j.value)return U.error(_("Please enter your mobile number first"));if(!p.value)return U.error(_("Please enter captcha"));if(!b.value)return U.error(_("Captcha key is missing, please refresh the captcha"));const u=await w({body:{event:a.event,country_code:t,phone:l,captcha:p.value,captcha_key:b.value}});"success"===(null==(e=u.data)?void 0:e.status)?(()=>{let e=60;K.value=!0;const a=setInterval(()=>{e--,B.value=_("Resend after {seconds} seconds",{seconds:e}),e<=0&&(K.value=!1,B.value=_("Send SMS Verification Code"),clearInterval(a))},1e3)})():U.error(u.data.message)};return(l,t)=>a.disabled?z(l.$slots,"default",{key:0,sendVerifyCode:L,btnDisabled:K.value,btnText:B.value}):(g(),f(V,{key:1},[c(o(M),{label:l.$t("Mobile Number"),"show-require-mark":""},{default:d(()=>[c(o(q),null,{default:d(()=>[c(o(P),{options:o(F),"render-tag":H,"consistent-menu-width":!1,value:i.value,"onUpdate:value":t[0]||(t[0]=e=>i.value=e),class:"w-40",size:a.size,filterable:"",placeholder:l.$t("Select Country")},null,8,["options","value","size","placeholder"]),c(o(x),{value:n.value,"onUpdate:value":t[1]||(t[1]=e=>n.value=e),placeholder:l.$t("Please enter your mobile number"),"input-props":{required:!0},size:a.size},null,8,["value","placeholder","size"])]),_:1})]),_:1},8,["label"]),e.requireVerify?(g(),f(V,{key:0},[j.value?(g(),s(o(M),{key:0,label:l.$t("Captcha"),"show-require-mark":""},{default:d(()=>[c(E,{captcha:p.value,"onUpdate:captcha":t[2]||(t[2]=e=>p.value=e),"captcha-key":b.value,"onUpdate:captchaKey":t[3]||(t[3]=e=>b.value=e),size:a.size},null,8,["captcha","captcha-key","size"])]),_:1},8,["label"])):C("",!0),p.value?(g(),s(o(M),{key:1,label:l.$t("SMS Verification Code"),"show-require-mark":""},{default:d(()=>[c(o(x),{value:v.value,"onUpdate:value":t[4]||(t[4]=e=>v.value=e),"input-props":{required:!0},placeholder:l.$t("Please enter the SMS verification code"),size:a.size},{suffix:d(()=>[c(o(h),{text:"",type:"info",onClick:L,disabled:K.value||!a.modelValue&&!n.value||j.value&&!p.value},{default:d(()=>[m(y(B.value),1)]),_:1},8,["disabled"])]),_:1},8,["value","placeholder","size"])]),_:1},8,["label"])):C("",!0)],64)):C("",!0)],64))}});export{B as _,K as a,E as b};
