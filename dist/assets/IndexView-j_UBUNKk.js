import{_ as e}from"./Content.vue_vue_type_script_setup_true_lang-CGEjm_tA.js";import{g as l,s as a,v as t,a as s,n as o,_ as r,l as i,j as n,k as d,w as u,x as c}from"./Layout.vue_vue_type_script_setup_true_lang-BRRcuvRl.js";import{u as p,l as v}from"./album-DkuRp1Yw.js";import{_ as f,a as m,b as h,c as b,d as y,e as g,f as _}from"./PhotoSelect.vue_vue_type_script_setup_true_lang-CFkFFKqv.js";import{d as w,m as x,a as k,I as S,s as $,z as j,am as A,v as P,f as C,g as z,h as L,b as U,F as q,x as T,e as E,ak as D,y as F,o as I,B as M,u as N,an as O,A as H,ao as B}from"./index-DKzf3TMO.js";import{N as K}from"./InfiniteScroll-BYFnNaBd.js";import{N as R}from"./Spin-DZKmp4ei.js";import"./WaterfallLayout-B-kJbIBO.js";import"./DeleteOutlined-Daecp8an.js";import"./composables-B9wCYdts.js";import"./Popconfirm-BfiBX2TP.js";const G={class:"flex flex-col space-y-4"},V={class:"flex justify-between w-full border-b pb-2 dark:border-b-gray-600"},W=["onClick"],J={class:"h-16 w-16 rounded-lg overflow-hidden shrink-0"},Q=["src"],X={key:1,class:"flex grow items-center justify-center h-full bg-gray-100 dark:bg-gray-700"},Y={class:"flex flex-col justify-center ml-4 overflow-hidden"},Z={key:0,class:"truncate text-lg"},ee={class:"truncate text-gray-500"},le={key:0,class:"flex justify-center py-10"},ae=w({__name:"AlbumSelector",props:{title:{type:String,required:!1,default:"Select Album"}},emits:["onSelect"],setup(e,{expose:t,emit:s}){const o=p(),{t:r}=x(),i=e,n=s,d=k(!1),u=k("");function c(){d.value=!1}function f(){o.isLoading||(o.setPage(o.page+1),o.fetchAlbums())}return S(()=>u.value,v.debounce(()=>{o.resetAlbums({q:u})},500)),t({open:function(){o.resetAlbums(),d.value=!0},close:c}),(e,t)=>(E(),$(j(A),{show:d.value,"onUpdate:show":t[1]||(t[1]=e=>d.value=e),title:i.title,preset:"card",size:"small",bordered:!1,class:"container m-4 md:mx-auto md:my-10 max-w-screen-md overflow-hidden"},{default:P(()=>[C("div",G,[C("div",V,[L(j(l),{placeholder:e.$t("Search Albums"),bordered:!1,value:u.value,"onUpdate:value":t[0]||(t[0]=e=>u.value=e)},null,8,["placeholder","value"])]),j(o).isLoading||0!==j(o).albums.length?z("",!0):(E(),$(j(a),{key:0,class:"py-8",description:e.$t("No albums available")},null,8,["description"])),L(j(K),{class:"max-h-[400px]",onLoad:f},{default:P(()=>[(E(!0),U(q,null,T(j(o).albums,l=>(E(),U("div",{class:"flex p-2 mb-2 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800",onClick:e=>function(e){var l;o.toggleSelect((null==(l=e.id)?void 0:l.toString())||""),n("onSelect",o.selections),c()}(l)},[C("div",J,[l.covers&&l.covers.length>0?(E(),U("img",{key:0,class:"rounded-lg w-full h-full object-cover",alt:"album cover",src:l.covers[0]},null,8,Q)):(E(),U("div",X,[L(j(D),{icon:"fa-solid fa-images",class:"text-gray-500",size:"xl"})]))]),C("div",Y,[l.name?(E(),U("div",Z,F(l.name),1)):z("",!0),C("div",ee,F(e.$t("{count} items",{count:l.photo_count})),1)])],8,W))),256)),j(o).isLoading?(E(),U("div",le,[L(j(R),{size:25})])):z("",!0)]),_:1})])]),_:1},8,["show","title"]))}}),te=w({__name:"PhotoToAlbum",setup(e){const l=t(),a=k(null),o=s(),{t:r}=x();function i(){var e;null==(e=a.value)||e.open()}function n(e){l.selectedToAlbum(e).then(()=>{o.success(r("Added successfully"))}).catch(e=>{o.error(r("Failed to add to album"))})}return I(()=>{l.setAlbumSelectorRef(a.value)}),(e,l)=>(E(),U(q,null,[L(ae,{ref_key:"albumSelectorRef",ref:a,title:e.$t("Add to Album"),onOnSelect:n},null,8,["title"]),L(j(M),{tertiary:"",circle:"",size:"small",type:"default",title:e.$t("Add to Album"),onClick:i},{icon:P(()=>[L(j(D),{icon:"fa-solid fa-plus"})]),_:1},8,["title"])],64))}}),se=w({__name:"PhotoShare",setup(e){const{t:l}=x(),a=t();return(e,l)=>(E(),$(j(M),{tertiary:"",circle:"",size:"small",type:"default",title:e.$t("Share"),onClick:l[0]||(l[0]=e=>j(a).setShareModalActive(!0))},{icon:P(()=>[L(j(D),{icon:"fa-solid fa-share-nodes"})]),_:1},8,["title"]))}}),oe={class:"flex items-center justify-between space-x-2 sticky top-0 z-[4] bg-gray-100 border-b border-transparent dark:bg-[var(--n-color)] dark:border-b-gray-800 p-2 w-full"},re={class:"flex justify-end space-x-2 grow md:grow-0 md:w-2/3"},ie={class:"flex flex-col"},ne={class:"space-y-4 p-2"},de={class:"flex flex-col space-y-4"},ue={key:0,class:"flex justify-end"},ce={key:1,class:"flex justify-between space-x-2"},pe=w({__name:"IndexView",setup(a){const p=N(),w=t(),{t:z}=x(),q=s(),T=k(""),K=k({type:"photo",ids:[],content:"",password:"",expired_at:null}),R={},G=e=>{const l=e.target;100+l.scrollTop+l.clientHeight>=l.scrollHeight&&(w.isLoading||(w.setPage(w.page+1),w.fetchPhotos()))};function V(e){(e.ctrlKey||e.metaKey)&&"a"===e.key&&(e.preventDefault(),w.selectAll())}const W=[{label:z("Newest"),value:"latest"},{label:z("Oldest"),value:"oldest"}],J=k({q:"",storage_id:null,order_by:"latest"});function Q(){w.resetPhotos({storage_id:J.value.storage_id,q:`sort:${J.value.order_by} ${J.value.q}`})}function X(){if(0===w.selections.length)return void q.warning(z("Please select photos first"));const e={...K.value};if(e.ids=w.selections.map(e=>e.id),e.expired_at){const l=new Date(e.expired_at);e.expired_at=l.toISOString().slice(0,19).replace("T"," ")}B({body:e}).then(e=>{var l,a,t;if("error"===(null==(l=e.data)?void 0:l.status))return q.error(null==(a=e.data)?void 0:a.message);T.value=`${window.location.origin}/shares/${null==(t=e.data)?void 0:t.data.slug}`}).catch(()=>{q.error(z("Failed to create share"))})}function Y(){c.copyText(T.value).then(()=>{q.success(z("Copy successful"))}).catch(()=>{q.error(z("Copy failed"))})}return S(()=>w.shareModalActive,e=>{e&&(T.value="",K.value={type:"photo",ids:[],content:"",password:"",expired_at:null})}),S(J,v.debounce(()=>Q(),500),{deep:!0}),I(()=>{Q(),window.addEventListener("keydown",V)}),O(()=>{window.removeEventListener("keydown",V)}),(a,t)=>(E(),$(r,{"toggle-header":!1,"show-footer":!1,"header-title":`${j(w).selections.length>0?a.$t("{count} items selected",{count:j(o).format(j(w).selections.length)}):a.$t("Photo Management")}`,"on-scroll":G},{default:P(()=>[L(e,{class:"max-w-full bg-white dark:bg-[var(--n-color)]"},{default:P(()=>{var e;return[C("div",oe,[t[7]||(t[7]=C("div",null,null,-1)),C("div",re,[L(j(l),{value:J.value.q,"onUpdate:value":t[0]||(t[0]=e=>J.value.q=e),class:"max-w-44",placeholder:a.$t("Enter keywords to search..."),clearable:""},null,8,["value","placeholder"]),L(j(i),{class:"max-w-52",filterable:"",clearable:"",placeholder:a.$t("Storage Filter"),value:J.value.storage_id,"onUpdate:value":t[1]||(t[1]=e=>J.value.storage_id=e),options:(null==(e=j(p).group)?void 0:e.storages)||[],"label-field":"name","value-field":"id"},null,8,["placeholder","value","options"]),L(j(i),{class:"w-32 shrink-0",placeholder:a.$t("Sort"),options:W,value:J.value.order_by,"onUpdate:value":t[2]||(t[2]=e=>J.value.order_by=e)},null,8,["placeholder","value"])])]),C("div",ie,[C("div",ne,[L(f)]),L(m,null,{default:P(()=>[L(h),L(b),L(y),L(g),L(se),L(te),L(_)]),_:1})])]}),_:1}),L(j(A),{show:j(w).shareModalActive,"onUpdate:show":t[6]||(t[6]=e=>j(w).shareModalActive=e),title:a.$t("Share Photos"),preset:"card",size:"small",bordered:!1,class:"max-w-screen-sm mx-4 md:mx-auto z-50"},{action:P(()=>[T.value?(E(),U("div",ce,[L(j(l),{class:"grow select-all","default-value":T.value,readonly:""},null,8,["default-value"]),L(j(M),{tertiary:"",type:"primary",class:"shrink-0",onClick:Y},{icon:P(()=>[L(j(D),{icon:"fa-solid fa-copy"})]),_:1})])):(E(),U("div",ue,[L(j(M),{tertiary:"",onClick:X},{default:P(()=>[H(F(a.$t("Create Share Link")),1)]),_:1})]))]),default:P(()=>[C("div",de,[L(j(n),{model:K.value,rules:R,disabled:Boolean(T.value)},{default:P(()=>[L(j(d),{label:a.$t("Share Description"),path:"content"},{default:P(()=>[L(j(l),{resizable:"",type:"textarea",value:K.value.content,"onUpdate:value":t[3]||(t[3]=e=>K.value.content=e)},null,8,["value"])]),_:1},8,["label"]),L(j(d),{label:a.$t("Password"),path:"password"},{default:P(()=>[L(j(l),{type:"password",value:K.value.password,"onUpdate:value":t[4]||(t[4]=e=>K.value.password=e)},null,8,["value"])]),_:1},8,["label"]),L(j(d),{label:a.$t("Expiration Time"),path:"expired_at"},{default:P(()=>[L(j(u),{value:K.value.expired_at,"onUpdate:value":t[5]||(t[5]=e=>K.value.expired_at=e),type:"datetime",class:"w-full",placeholder:a.$t("Select Expiration Time"),"is-date-disabled":e=>e<Date.now(),clearable:""},null,8,["value","placeholder","is-date-disabled"])]),_:1},8,["label"])]),_:1},8,["model","disabled"])])]),_:1},8,["show","title"])]),_:1},8,["header-title"]))}});export{pe as default};
